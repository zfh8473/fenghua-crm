# Story 3.1: ÂÆ¢Êà∑ÂàõÂª∫ÂíåÁÆ°ÁêÜÔºàÊåâËßíËâ≤Ôºâ

Status: done

<!-- Note: Validation is optional. Run validate-create-story for quality check before dev-story. -->

## Story

As a **ÂâçÁ´Ø‰∏ìÂëò/ÂêéÁ´Ø‰∏ìÂëò/ÊÄªÁõë/ÁÆ°ÁêÜÂëò**,
I want **ÂàõÂª∫„ÄÅÁºñËæëÂíåÂà†Èô§ÂÆ¢Êà∑ËÆ∞ÂΩï**,
So that **ÊàëÂèØ‰ª•ÁÆ°ÁêÜÊàëË¥üË¥£ÁöÑÂÆ¢Êà∑‰ø°ÊÅØÔºåÂª∫Á´ãÂíåÁª¥Êä§ÂÆ¢Êà∑ÂÖ≥Á≥ª**.

## Acceptance Criteria

1. **Given** ÂâçÁ´Ø‰∏ìÂëòÂ∑≤ÁôªÂΩïÁ≥ªÁªü
   **When** ÂâçÁ´Ø‰∏ìÂëòËÆøÈóÆÂÆ¢Êà∑ÁÆ°ÁêÜÈ°µÈù¢
   **Then** Á≥ªÁªüÂè™ÊòæÁ§∫ÈááË¥≠ÂïÜÁ±ªÂûãÁöÑÂÆ¢Êà∑Ôºàcustomer_type = 'BUYER'Ôºâ
   **And** Á≥ªÁªü‰∏çÊòæÁ§∫‰æõÂ∫îÂïÜÁ±ªÂûãÁöÑÂÆ¢Êà∑
   **And** ÂâçÁ´Ø‰∏ìÂëòÂèØ‰ª•ÁÇπÂáª"ÂàõÂª∫Êñ∞ÈááË¥≠ÂïÜ"ÊåâÈíÆ

2. **Given** ÂêéÁ´Ø‰∏ìÂëòÂ∑≤ÁôªÂΩïÁ≥ªÁªü
   **When** ÂêéÁ´Ø‰∏ìÂëòËÆøÈóÆÂÆ¢Êà∑ÁÆ°ÁêÜÈ°µÈù¢
   **Then** Á≥ªÁªüÂè™ÊòæÁ§∫‰æõÂ∫îÂïÜÁ±ªÂûãÁöÑÂÆ¢Êà∑Ôºàcustomer_type = 'SUPPLIER'Ôºâ
   **And** Á≥ªÁªü‰∏çÊòæÁ§∫ÈááË¥≠ÂïÜÁ±ªÂûãÁöÑÂÆ¢Êà∑
   **And** ÂêéÁ´Ø‰∏ìÂëòÂèØ‰ª•ÁÇπÂáª"ÂàõÂª∫Êñ∞‰æõÂ∫îÂïÜ"ÊåâÈíÆ

3. **Given** ÊÄªÁõëÊàñÁÆ°ÁêÜÂëòÂ∑≤ÁôªÂΩïÁ≥ªÁªü
   **When** ÊÄªÁõëÊàñÁÆ°ÁêÜÂëòËÆøÈóÆÂÆ¢Êà∑ÁÆ°ÁêÜÈ°µÈù¢
   **Then** Á≥ªÁªüÊòæÁ§∫ÊâÄÊúâÁ±ªÂûãÁöÑÂÆ¢Êà∑ÔºàÈááË¥≠ÂïÜÂíå‰æõÂ∫îÂïÜÔºâ
   **And** Á≥ªÁªüÊèê‰æõÂÆ¢Êà∑Á±ªÂûãÁ≠õÈÄâÂäüËÉΩÔºàÂÖ®ÈÉ®/ÈááË¥≠ÂïÜ/‰æõÂ∫îÂïÜÔºâ
   **And** ÊÄªÁõëÊàñÁÆ°ÁêÜÂëòÂèØ‰ª•ÁÇπÂáª"ÂàõÂª∫Êñ∞ÂÆ¢Êà∑"ÊåâÈíÆ

4. **Given** Áî®Êà∑ÁÇπÂáª"ÂàõÂª∫Êñ∞ÂÆ¢Êà∑"
   **When** Á≥ªÁªüÊòæÁ§∫ÂÆ¢Êà∑ÂàõÂª∫Ë°®Âçï
   **Then** Ë°®ÂçïÂåÖÂê´ÂøÖÂ°´Â≠óÊÆµÔºöÂÆ¢Êà∑ÂêçÁß∞„ÄÅÂÆ¢Êà∑‰ª£Á†Å„ÄÅÂÆ¢Êà∑Á±ªÂûã
   **And** Ë°®ÂçïÂåÖÂê´ÂèØÈÄâÂ≠óÊÆµÔºöÂú∞ÂùÄ„ÄÅËÅîÁ≥ªÊñπÂºè„ÄÅË°å‰∏ö„ÄÅËßÑÊ®°„ÄÅÂ§áÊ≥®Á≠â
   **And** ÂâçÁ´Ø‰∏ìÂëòÂè™ËÉΩÈÄâÊã©"ÈááË¥≠ÂïÜ"Á±ªÂûãÔºàcustomer_type = 'BUYER'ÔºâÔºåÂêéÁ´Ø‰∏ìÂëòÂè™ËÉΩÈÄâÊã©"‰æõÂ∫îÂïÜ"Á±ªÂûãÔºàcustomer_type = 'SUPPLIER'ÔºâÔºåÊÄªÁõëÂíåÁÆ°ÁêÜÂëòÂèØ‰ª•ÈÄâÊã©‰ªªÊÑèÁ±ªÂûãÔºà'BUYER' Êàñ 'SUPPLIER'Ôºâ

5. **Given** Áî®Êà∑Â°´ÂÜôÂÆ¢Êà∑ÂàõÂª∫Ë°®Âçï
   **When** Áî®Êà∑Êèê‰∫§Ë°®ÂçïÔºåÊâÄÊúâÂøÖÂ°´Â≠óÊÆµÂ∑≤Â°´ÂÜô‰∏îÊ†ºÂºèÊ≠£Á°Æ
   **Then** Á≥ªÁªüÂàõÂª∫ÂÆ¢Êà∑ËÆ∞ÂΩïÂπ∂‰øùÂ≠òÂà∞ `companies` Ë°®
   **And** ÂÆ¢Êà∑‰ø°ÊÅØ‰øùÂ≠òÂà∞Êï∞ÊçÆÂ∫ìÔºåÂÆ¢Êà∑Á±ªÂûãÂ≠óÊÆµÔºàcustomer_typeÔºâÊ≠£Á°ÆËÆæÁΩÆ
   **And** Á≥ªÁªüÊòæÁ§∫ÊàêÂäüÊ∂àÊÅØ"ÂÆ¢Êà∑ÂàõÂª∫ÊàêÂäü"
   **And** Êñ∞ÂÆ¢Êà∑Âá∫Áé∞Âú®ÂÆ¢Êà∑ÂàóË°®‰∏≠
   **And** Á≥ªÁªüÊ†πÊçÆÁî®Êà∑ËßíËâ≤Ëá™Âä®ËøáÊª§ÊòæÁ§∫ÔºàÂâçÁ´Ø‰∏ìÂëòÂè™ÁúãÂà∞ÈááË¥≠ÂïÜÔºåÂêéÁ´Ø‰∏ìÂëòÂè™ÁúãÂà∞‰æõÂ∫îÂïÜÔºâ

6. **Given** Áî®Êà∑Â°´ÂÜôÂÆ¢Êà∑ÂàõÂª∫Ë°®Âçï
   **When** Áî®Êà∑Êèê‰∫§Ë°®ÂçïÔºå‰ΩÜÂøÖÂ°´Â≠óÊÆµÁº∫Â§±ÊàñÂÆ¢Êà∑‰ª£Á†ÅÊ†ºÂºè‰∏çÊ≠£Á°Æ
   **Then** Á≥ªÁªüÊòæÁ§∫È™åËØÅÈîôËØØÊ∂àÊÅØÔºàÂ¶Ç"ÂÆ¢Êà∑ÂêçÁß∞‰∏çËÉΩ‰∏∫Á©∫"„ÄÅ"ÂÆ¢Êà∑‰ª£Á†ÅÊ†ºÂºè‰∏çÊ≠£Á°Æ"Ôºâ
   **And** ÂÆ¢Êà∑‰∏çË¢´ÂàõÂª∫
   **And** Ë°®Âçï‰øùÊåÅÂ°´ÂÜôÁä∂ÊÄÅÔºåÂÖÅËÆ∏Áî®Êà∑‰øÆÊ≠£ÈîôËØØ

7. **Given** ÂÆ¢Êà∑Â∑≤Â≠òÂú®
   **When** Áî®Êà∑Âú®ÂÆ¢Êà∑ÂàóË°®‰∏≠ÈÄâÊã©ÂÆ¢Êà∑Âπ∂ÁÇπÂáª"ÁºñËæë"
   **Then** Á≥ªÁªüÊòæÁ§∫ÂÆ¢Êà∑ÁºñËæëË°®ÂçïÔºåÈ¢ÑÂ°´ÂÖÖÁé∞ÊúâÂÆ¢Êà∑‰ø°ÊÅØ
   **And** Áî®Êà∑Âè™ËÉΩÁºñËæëËá™Â∑±ËßíËâ≤ÊùÉÈôêËåÉÂõ¥ÂÜÖÁöÑÂÆ¢Êà∑
   **And** ÂâçÁ´Ø‰∏ìÂëò‰∏çËÉΩÁºñËæë‰æõÂ∫îÂïÜÔºåÂêéÁ´Ø‰∏ìÂëò‰∏çËÉΩÁºñËæëÈááË¥≠ÂïÜ
   **And** Áî®Êà∑Êèê‰∫§‰øÆÊîπÂêéÔºåÁ≥ªÁªüÊõ¥Êñ∞ÂÆ¢Êà∑‰ø°ÊÅØÂπ∂ÊòæÁ§∫ÊàêÂäüÊ∂àÊÅØ

8. **Given** ÂÆ¢Êà∑Â∑≤Â≠òÂú®‰∏îÊúâÂÖ≥ËÅîÁöÑ‰∫íÂä®ËÆ∞ÂΩï
   **When** Áî®Êà∑Â∞ùËØïÂà†Èô§ÂÆ¢Êà∑
   **Then** Á≥ªÁªüÊòæÁ§∫Á°ÆËÆ§ÂØπËØùÊ°Ü"Á°ÆÂÆöË¶ÅÂà†Èô§ÂÆ¢Êà∑ [ÂÆ¢Êà∑ÂêçÁß∞] ÂêóÔºü"
   **And** Á≥ªÁªüÊ£ÄÊü•ÂÆ¢Êà∑ÊòØÂê¶ÊúâÂÖ≥ËÅîÁöÑ‰∫íÂä®ËÆ∞ÂΩïÔºàÊü•ËØ¢ `product_customer_interactions` Ë°®Ôºâ
   **And** Â¶ÇÊûúÊúâÂÖ≥ËÅîËÆ∞ÂΩïÔºåÁ≥ªÁªüÊâßË°åËΩØÂà†Èô§ÔºàÊ†áËÆ∞ `deleted_at`ÔºâÔºå‰øùÁïôÂéÜÂè≤ËÆ∞ÂΩï
   **And** Â¶ÇÊûúÊó†ÂÖ≥ËÅîËÆ∞ÂΩïÔºåÁ≥ªÁªüÂèØ‰ª•ÊâßË°åÁ°¨Âà†Èô§ÔºàDELETE FROM companiesÔºâ
   **And** ÂÆ¢Êà∑‰ªéÂÆ¢Êà∑ÂàóË°®‰∏≠ÁßªÈô§ÔºàÊàñÊ†áËÆ∞‰∏∫ deletedÔºâ
   **And** Á≥ªÁªüÊòæÁ§∫ÊàêÂäüÊ∂àÊÅØ"ÂÆ¢Êà∑Âà†Èô§ÊàêÂäü"

## Tasks / Subtasks

- [x] Task 1: ÂêéÁ´ØÂÆ¢Êà∑ÊúçÂä°Ê®°Âùó (AC: #5, #6, #7, #8)
  - [x] ÂàõÂª∫ CustomersModuleÔºàÊàñ CompaniesModuleÔºâ‚úÖ
  - [x] ÂàõÂª∫ CustomersServiceÔºàÁÆ°ÁêÜÂÆ¢Êà∑ CRUD Êìç‰ΩúÔºâ‚úÖ
  - [x] ÂàõÂª∫ CustomersControllerÔºàÊèê‰æõÂÆ¢Êà∑ÁÆ°ÁêÜÁ´ØÁÇπÔºå‰ΩøÁî® @UseGuards(JwtAuthGuard)Ôºâ‚úÖ
  - [x] ÂÆûÁé∞ÂÆ¢Êà∑Êï∞ÊçÆÊ®°ÂûãÔºàDTOs: CreateCustomerDto, UpdateCustomerDto, CustomerResponseDto, CustomerQueryDtoÔºâ‚úÖ
  - [x] ÂÆûÁé∞ÂÆ¢Êà∑ÂàõÂª∫ÈÄªËæëÔºàÈ™åËØÅÂøÖÂ°´Â≠óÊÆµÔºåÈ™åËØÅÂÆ¢Êà∑‰ª£Á†ÅÊ†ºÂºèÔºå‰øùÂ≠òÂà∞ companies Ë°®Ôºâ‚úÖ
  - [x] ÂÆûÁé∞ÂÆ¢Êà∑Êõ¥Êñ∞ÈÄªËæëÔºàÈ™åËØÅÊùÉÈôêÔºåÊõ¥Êñ∞ updated_at Âíå updated_byÔºâ‚úÖ
  - [x] ÂÆûÁé∞ÂÆ¢Êà∑Âà†Èô§ÈÄªËæëÔºàÊ£ÄÊü•ÂÖ≥ËÅîËÆ∞ÂΩïÔºåËΩØÂà†Èô§ÊàñÁ°¨Âà†Èô§Ôºâ‚úÖ
  - [x] ÂÆûÁé∞ÂÆ¢Êà∑Êü•ËØ¢ÈÄªËæëÔºàÂàóË°®Êü•ËØ¢ÔºåÊîØÊåÅËøáÊª§ÂíåÂàÜÈ°µÔºåÈªòËÆ§ÊØèÈ°µ 20 Êù°Ôºâ‚úÖ

- [x] Task 2: Âü∫‰∫éËßíËâ≤ÁöÑÊï∞ÊçÆËøáÊª§ÈõÜÊàê (AC: #1, #2, #3, #5, #7)
  - [x] Âú® CustomersService ‰∏≠Ê≥®ÂÖ• PermissionService ‚úÖ
  - [x] ÂÆûÁé∞ËßíËâ≤ËøáÊª§ÈÄªËæëÔºà‰ΩøÁî® PermissionService.getDataAccessFilter()Ôºâ‚úÖ
  - [x] Âú®Êü•ËØ¢ÊñπÊ≥ï‰∏≠Â∫îÁî®Êï∞ÊçÆËøáÊª§ÔºàÊ†πÊçÆÁî®Êà∑ËßíËâ≤Ëá™Âä®Ê∑ªÂä† customer_type ËøáÊª§Êù°‰ª∂Ôºâ‚úÖ
  - [x] ÂâçÁ´Ø‰∏ìÂëòÔºöÂè™Êü•ËØ¢ customer_type = 'BUYER' ‚úÖ
  - [x] ÂêéÁ´Ø‰∏ìÂëòÔºöÂè™Êü•ËØ¢ customer_type = 'SUPPLIER' ‚úÖ
  - [x] ÊÄªÁõë/ÁÆ°ÁêÜÂëòÔºö‰∏çÊ∑ªÂä†ËøáÊª§Êù°‰ª∂ÔºàÂèØÊü•ÁúãÊâÄÊúâÔºâ‚úÖ
  - [x] Âú®ÂàõÂª∫/ÁºñËæë/Âà†Èô§Êìç‰Ωú‰∏≠È™åËØÅÊùÉÈôêÔºàÂâçÁ´Ø‰∏ìÂëò‰∏çËÉΩÂàõÂª∫/ÁºñËæë‰æõÂ∫îÂïÜÔºåÂêéÁ´Ø‰∏ìÂëò‰∏çËÉΩÂàõÂª∫/ÁºñËæëÈááË¥≠ÂïÜÔºâ‚úÖ

- [x] Task 3: Êï∞ÊçÆÂ∫ìÈõÜÊàê (AC: #5, #7, #8)
  - [x] Á°ÆËÆ§ companies Ë°®Â∑≤ÂàõÂª∫Ôºà‰ΩøÁî®ËøÅÁßªËÑöÊú¨ 006-create-companies-and-people-tables.sqlÔºâ‚úÖ
  - [x] **ÂàõÂª∫Êñ∞ËøÅÁßªËÑöÊú¨Ê∑ªÂä† customer_code Â≠óÊÆµ**ÔºàÂøÖÈúÄÔºåEpic Ë¶ÅÊ±ÇÂÆ¢Êà∑‰ª£Á†Å‰∏∫ÂøÖÂ°´Â≠óÊÆµÔºâ‚úÖ
    - [x] ÂàõÂª∫ËøÅÁßªËÑöÊú¨Ôºö`012-add-customer-code-to-companies.sql` ‚úÖ
    - [x] Ê∑ªÂä† `customer_code VARCHAR(50)` ÂàóÔºàËøÅÁßªËÑöÊú¨Â∑≤ÊâßË°åÔºâ‚úÖ
    - [x] ÂàõÂª∫ÂîØ‰∏ÄÁ¥¢ÂºïÔºö`CREATE UNIQUE INDEX idx_companies_customer_code ON companies(customer_code) WHERE deleted_at IS NULL`ÔºàËøÅÁßªËÑöÊú¨Â∑≤ÊâßË°åÔºâ‚úÖ
  - [x] ÂÆûÁé∞Êï∞ÊçÆÂ∫ìËøûÊé•Ôºà‰ΩøÁî® `pg.Pool`ÔºåÂèÇËÄÉ ProductsService.initializeDatabaseConnection() Ê®°ÂºèÔºâ‚úÖ
  - [x] ÂÆûÁé∞ÂÆ¢Êà∑ÂàõÂª∫ SQLÔºàINSERT INTO companiesÔºåÂåÖÂê´ customer_type Âíå customer_code Â≠óÊÆµÔºâ‚úÖ
  - [x] ÂÆûÁé∞ÂÆ¢Êà∑Êõ¥Êñ∞ SQLÔºàUPDATE companiesÔºåÊõ¥Êñ∞ updated_at Âíå updated_byÔºâ‚úÖ
  - [x] ÂÆûÁé∞ÂÆ¢Êà∑ËΩØÂà†Èô§ SQLÔºàUPDATE companies SET deleted_at = NOW()Ôºâ‚úÖ
  - [x] ÂÆûÁé∞ÂÆ¢Êà∑Á°¨Âà†Èô§ SQLÔºàDELETE FROM companies WHERE id = $1 AND Êó†ÂÖ≥ËÅîËÆ∞ÂΩïÔºâ‚úÖ
  - [x] ÂÆûÁé∞ÂÖ≥ËÅîËÆ∞ÂΩïÊ£ÄÊü•ÔºàÊü•ËØ¢ product_customer_interactions Ë°®ÔºåÊ£ÄÊü• customer_id ÂåπÈÖç‰∏î deleted_at IS NULL ÁöÑËÆ∞ÂΩïÔºâ‚úÖ

- [x] Task 4: ÂÆ¢Êà∑È™åËØÅÈÄªËæë (AC: #4, #6)
  - [x] ÂÆûÁé∞ÂÆ¢Êà∑ÂêçÁß∞È™åËØÅÔºàÂøÖÂ°´ÔºåÈïøÂ∫¶ÈôêÂà∂Ôºö1-255 Â≠óÁ¨¶Ôºâ‚úÖ (DTO validation)
  - [x] ÂÆûÁé∞ÂÆ¢Êà∑‰ª£Á†ÅÈ™åËØÅÔºàÂøÖÂ°´ÔºåÊ†ºÂºèÈ™åËØÅÔºöÂ≠óÊØçÊï∞Â≠óÁªÑÂêàÔºåÈïøÂ∫¶ÈôêÂà∂Ôºö1-50 Â≠óÁ¨¶ÔºåÂîØ‰∏ÄÊÄßÊ£ÄÊü•Ôºâ‚úÖ (DTO validation + service check)
  - [x] ÂÆûÁé∞ÂÆ¢Êà∑Á±ªÂûãÈ™åËØÅÔºàÂøÖÂ°´ÔºåÂÄºÂøÖÈ°ªÊòØ 'BUYER' Êàñ 'SUPPLIER'Ôºâ‚úÖ (DTO enum validation)
  - [x] ÂÆûÁé∞Âú∞ÂùÄÈ™åËØÅÔºàÂèØÈÄâÔºåÈïøÂ∫¶ÈôêÂà∂ÔºöÊúÄÂ§ß 1000 Â≠óÁ¨¶Ôºâ‚úÖ (DTO validation)
  - [x] ÂÆûÁé∞ËÅîÁ≥ªÊñπÂºèÈ™åËØÅÔºàÂèØÈÄâÔºåÊ†ºÂºèÈ™åËØÅÔºöÁîµËØù„ÄÅÈÇÆÁÆ±Á≠âÔºâ‚úÖ (DTO validation)
  - [x] ÂÆûÁé∞Ë°å‰∏öÈ™åËØÅÔºàÂèØÈÄâÔºåÈïøÂ∫¶ÈôêÂà∂ÔºöÊúÄÂ§ß 100 Â≠óÁ¨¶Ôºâ‚úÖ (DTO validation)
  - [x] ÂÆûÁé∞ËßÑÊ®°È™åËØÅÔºàÂèØÈÄâÔºåÊï¥Êï∞Á±ªÂûãÔºåËåÉÂõ¥Ôºö1-1000000Ôºâ‚úÖ (DTO validation)
  - [x] ÂÆûÁé∞Â§áÊ≥®È™åËØÅÔºàÂèØÈÄâÔºåÈïøÂ∫¶ÈôêÂà∂ÔºöÊúÄÂ§ß 5000 Â≠óÁ¨¶Ôºâ‚úÖ (DTO validation)

- [x] Task 5: ÂâçÁ´ØÂÆ¢Êà∑ÁÆ°ÁêÜÈ°µÈù¢ (AC: #1, #2, #3)
  - [x] ÂàõÂª∫ÂÆ¢Êà∑ÁÆ°ÁêÜÈ°µÈù¢ÁªÑ‰ª∂ (CustomerManagementPage.tsx) ‚úÖ
  - [x] ÂàõÂª∫ÂÆ¢Êà∑ÂàóË°®ÁªÑ‰ª∂ (CustomerList.tsx) ‚úÖ
  - [x] ÂÆûÁé∞ÂÆ¢Êà∑ÂàóË°®ÊòæÁ§∫ÔºàË°®Ê†ºÂΩ¢ÂºèÔºåÊòæÁ§∫ÂêçÁß∞„ÄÅÂÆ¢Êà∑‰ª£Á†Å„ÄÅÂÆ¢Êà∑Á±ªÂûã„ÄÅÂú∞ÂùÄ„ÄÅËÅîÁ≥ªÊñπÂºèÁ≠âÔºâ‚úÖ
  - [x] ÂÆûÁé∞"ÂàõÂª∫Êñ∞ÂÆ¢Êà∑"ÊåâÈíÆÔºàÊ†πÊçÆÁî®Êà∑ËßíËâ≤ÊòæÁ§∫‰∏çÂêåÊñáÊú¨ÔºöÂâçÁ´Ø‰∏ìÂëòÊòæÁ§∫"ÂàõÂª∫Êñ∞ÈááË¥≠ÂïÜ"ÔºåÂêéÁ´Ø‰∏ìÂëòÊòæÁ§∫"ÂàõÂª∫Êñ∞‰æõÂ∫îÂïÜ"ÔºåÊÄªÁõë/ÁÆ°ÁêÜÂëòÊòæÁ§∫"ÂàõÂª∫Êñ∞ÂÆ¢Êà∑"Ôºâ‚úÖ
  - [x] ÂÆûÁé∞ÂÆ¢Êà∑Á±ªÂûãÁ≠õÈÄâÂäüËÉΩÔºà‰ªÖÊÄªÁõë/ÁÆ°ÁêÜÂëòÂèØËßÅÔºåÊîØÊåÅÂÖ®ÈÉ®/ÈááË¥≠ÂïÜ/‰æõÂ∫îÂïÜÁ≠õÈÄâÔºâ‚úÖ
  - [x] ÂÆûÁé∞ÂÆ¢Êà∑ÂàóË°®ÂàÜÈ°µ ‚úÖ
  - [x] ÂÆûÁé∞Âü∫‰∫éËßíËâ≤ÁöÑÊï∞ÊçÆËøáÊª§ÔºàÂâçÁ´ØÊòæÁ§∫ÔºåÂêéÁ´Ø API Â∑≤ËøáÊª§Ôºâ‚úÖ

- [x] Task 6: ÂâçÁ´ØÂÆ¢Êà∑ÂàõÂª∫Ë°®Âçï (AC: #4, #5, #6)
  - [x] ÂàõÂª∫ÂÆ¢Êà∑ÂàõÂª∫Ë°®ÂçïÁªÑ‰ª∂ (CustomerCreateForm.tsx) ‚úÖ
  - [x] ÂÆûÁé∞ÂøÖÂ°´Â≠óÊÆµÔºöÂÆ¢Êà∑ÂêçÁß∞Ôºà1-255 Â≠óÁ¨¶Ôºâ„ÄÅÂÆ¢Êà∑‰ª£Á†ÅÔºàÊ†ºÂºèÈ™åËØÅÔºâ„ÄÅÂÆ¢Êà∑Á±ªÂûãÔºàÊ†πÊçÆÁî®Êà∑ËßíËâ≤ÈôêÂà∂ÈÄâÈ°πÔºâ‚úÖ
  - [x] ÂÆûÁé∞ÂèØÈÄâÂ≠óÊÆµÔºöÂú∞ÂùÄÔºàÊúÄÂ§ß 1000 Â≠óÁ¨¶Ôºâ„ÄÅËÅîÁ≥ªÊñπÂºè„ÄÅË°å‰∏öÔºàÊúÄÂ§ß 100 Â≠óÁ¨¶Ôºâ„ÄÅËßÑÊ®°ÔºàÊï¥Êï∞Ôºå1-1000000Ôºâ„ÄÅÂ§áÊ≥®ÔºàÊúÄÂ§ß 5000 Â≠óÁ¨¶Ôºâ‚úÖ
  - [x] ÂÆûÁé∞ÂÆ¢Êà∑Á±ªÂûãÂ≠óÊÆµÈôêÂà∂ÔºàÂâçÁ´Ø‰∏ìÂëòÂè™ËÉΩÈÄâÊã©"ÈááË¥≠ÂïÜ"ÔºåÂêéÁ´Ø‰∏ìÂëòÂè™ËÉΩÈÄâÊã©"‰æõÂ∫îÂïÜ"ÔºåÊÄªÁõë/ÁÆ°ÁêÜÂëòÂèØ‰ª•ÈÄâÊã©‰ªªÊÑèÁ±ªÂûãÔºâ‚úÖ
  - [x] ÂÆûÁé∞Ë°®ÂçïÈ™åËØÅÔºàÂâçÁ´ØÈ™åËØÅÔºöËá™ÂÆö‰πâÈ™åËØÅÈÄªËæëÔºåÂêéÁ´ØÈ™åËØÅÔºöDTO validationÔºâ‚úÖ
  - [x] ÂÆûÁé∞ÈîôËØØÊ∂àÊÅØÊòæÁ§∫ÔºàÊòæÁ§∫È™åËØÅÈîôËØØÂíå API ÈîôËØØÔºâ‚úÖ
  - [x] ÂÆûÁé∞ÊàêÂäüÊ∂àÊÅØÊòæÁ§∫ÔºàÂàõÂª∫ÊàêÂäüÂêéÊòæÁ§∫ÊèêÁ§∫Âπ∂Âà∑Êñ∞ÂàóË°®Ôºâ‚úÖ

- [x] Task 7: ÂâçÁ´ØÂÆ¢Êà∑ÁºñËæëË°®Âçï (AC: #7)
  - [x] ÂàõÂª∫ÂÆ¢Êà∑ÁºñËæëË°®ÂçïÁªÑ‰ª∂ (CustomerEditForm.tsx) ‚úÖ
  - [x] ÂÆûÁé∞Ë°®ÂçïÈ¢ÑÂ°´ÂÖÖÔºà‰ªéÂÆ¢Êà∑ËØ¶ÊÉÖÂä†ËΩΩÊï∞ÊçÆÔºâ‚úÖ
  - [x] ÂÆûÁé∞ÊùÉÈôêÈ™åËØÅÔºàÂâçÁ´ØÊ£ÄÊü•ÔºöÂâçÁ´Ø‰∏ìÂëò‰∏çËÉΩÁºñËæë‰æõÂ∫îÂïÜÔºåÂêéÁ´Ø‰∏ìÂëò‰∏çËÉΩÁºñËæëÈááË¥≠ÂïÜÔºâ‚úÖ
  - [x] ÂÆûÁé∞ÂÆ¢Êà∑Êõ¥Êñ∞ API Ë∞ÉÁî® ‚úÖ
  - [x] ÂÆûÁé∞ÊàêÂäüÊ∂àÊÅØÊòæÁ§∫ ‚úÖ

- [x] Task 8: ÂâçÁ´ØÂÆ¢Êà∑Âà†Èô§ÂäüËÉΩ (AC: #8)
  - [x] ÂÆûÁé∞Âà†Èô§Á°ÆËÆ§ÂØπËØùÊ°Ü ‚úÖ
  - [x] ÂÆûÁé∞ÂÖ≥ËÅîËÆ∞ÂΩïÊ£ÄÊü•ÔºàÂêéÁ´ØËá™Âä®Ê£ÄÊü•ÔºåÂâçÁ´ØÊòæÁ§∫ÊèêÁ§∫‰ø°ÊÅØÔºâ‚úÖ
  - [x] ÂÆûÁé∞Âà†Èô§ API Ë∞ÉÁî®ÔºàÊ£ÄÊü•ÂÖ≥ËÅîËÆ∞ÂΩïÔºåËΩØÂà†Èô§ÊàñÁ°¨Âà†Èô§Ôºâ‚úÖ
  - [x] ÂÆûÁé∞Âà†Èô§ÂêéÂàóË°®Âà∑Êñ∞ ‚úÖ
  - [x] ÂÆûÁé∞ÊàêÂäüÊ∂àÊÅØÊòæÁ§∫ ‚úÖ

- [x] Task 9: ÂâçÁ´ØÂÆ¢Êà∑ÊúçÂä°ÈõÜÊàê (AC: #1, #2, #3, #5, #7, #8)
  - [x] ÂàõÂª∫ÂÆ¢Êà∑ÊúçÂä° (customers.service.ts) - ÂâçÁ´Ø API Ë∞ÉÁî® ‚úÖ
  - [x] ÂÆûÁé∞ÂÆ¢Êà∑ÂàóË°®Êü•ËØ¢ API Ë∞ÉÁî®ÔºàÂåÖÂê´ËßíËâ≤ËøáÊª§ÔºåÊîØÊåÅÂàÜÈ°µÂíåÁ≠õÈÄâÔºâ‚úÖ
  - [x] ÂÆûÁé∞ÂÆ¢Êà∑ÂàõÂª∫ API Ë∞ÉÁî® ‚úÖ
  - [x] ÂÆûÁé∞ÂÆ¢Êà∑Êõ¥Êñ∞ API Ë∞ÉÁî® ‚úÖ
  - [x] ÂÆûÁé∞ÂÆ¢Êà∑Âà†Èô§ API Ë∞ÉÁî® ‚úÖ
  - [x] ÂÆûÁé∞ÂÆ¢Êà∑ËØ¶ÊÉÖÊü•ËØ¢ API Ë∞ÉÁî® ‚úÖ

- [x] Task 10: ÂÆ°ËÆ°Êó•ÂøóÈõÜÊàê (AC: #5, #7, #8)
  - [x] ÈõÜÊàê AuditServiceÔºàËÆ∞ÂΩïÂÆ¢Êà∑ÂàõÂª∫„ÄÅÊõ¥Êñ∞„ÄÅÂà†Èô§Êìç‰ΩúÔºâ‚úÖ
  - [x] ËÆ∞ÂΩïÊìç‰ΩúËÄÖ‰ø°ÊÅØÔºàcreated_by, updated_byÔºâ‚úÖ
  - [x] ËÆ∞ÂΩïÂèòÊõ¥ÂâçÂêéÂÄºÔºàÊõ¥Êñ∞ÂíåÂà†Èô§Êìç‰ΩúÔºâ‚úÖ

## Dev Notes

- **Relevant architecture patterns and constraints:**
  - **Native Stack Architecture:** Use custom backend (`fenghua-backend`) and frontend (`fenghua-frontend`) with direct PostgreSQL database access. No external dependencies.
  - **Database:** Use `companies` table (migration script: `fenghua-backend/migrations/006-create-companies-and-people-tables.sql`).
  - **Database Connection Pattern:** Reference `ProductsService.initializeDatabaseConnection()` pattern:
    - Initialize pool in constructor using `ConfigService` for `DATABASE_URL`
    - Implement `OnModuleDestroy` interface for cleanup
    - Use `pg.Pool` with max connections (typically 10)
    - See: `fenghua-backend/src/products/products.service.ts:36-54`
  - **Data Isolation:** Companies table uses `created_by` for user-level isolation (not workspace_id)
    - All queries should filter by user's allowed customer_type via PermissionService
    - No workspace_id needed - system uses created_by for data ownership
  - **Role-Based Data Filtering:** Use `PermissionService.getDataAccessFilter()` to automatically filter data based on user role:
    - Frontend Specialist: Only `customer_type = 'BUYER'`
    - Backend Specialist: Only `customer_type = 'SUPPLIER'`
    - Director/Admin: No filter (can access all)
  - **Customer Type Case Conversion:** Database stores uppercase ('BUYER', 'SUPPLIER'), but PermissionService returns lowercase ('buyer', 'supplier')
    - **Implementation:** Convert to uppercase before query: `const customerTypeUpper = dataFilter.customerType.toUpperCase()`
    - **Example:**
      ```typescript
      const dataFilter = await this.permissionService.getDataAccessFilter(token);
      if (dataFilter?.customerType) {
        const customerTypeUpper = dataFilter.customerType.toUpperCase(); // 'buyer' -> 'BUYER'
        query += ` AND customer_type = $${paramIndex}`;
        queryParams.push(customerTypeUpper);
        paramIndex++;
      }
      ```
  - **User ID Extraction:** Use `request.user.id` from JwtAuthGuard
    - JwtAuthGuard automatically attaches user to request: `request.user = { id, email, role, ... }`
    - In controller: `@Get() async findAll(@Req() req: Request) { const userId = req.user.id; }`
    - For created_by/updated_by: `const userId = req.user.id;` then use in SQL: `created_by = $1`
  - **Soft Delete:** Implement soft delete strategy (mark `deleted_at`) to preserve historical interaction records.
  - **Customer Type Constraint:** `customer_type` field must be 'BUYER' or 'SUPPLIER' (enforced by database CHECK constraint).
  - **Audit Logging:** Reuse existing `AuditService` from Story 1.4.
  - **Error Handling:** Use try-catch blocks, return appropriate HTTP status codes:
    - `BadRequestException` for validation errors
    - `NotFoundException` for missing resources
    - `ConflictException` for duplicate entries (e.g., duplicate customer_code)
    - See `ProductsService` for error handling examples

- **Source tree components to touch:**
  - `fenghua-backend/src/customers/` (or `companies/`): New module for customer management.
  - `fenghua-backend/migrations/006-create-companies-and-people-tables.sql`: Database migration (already created, verify execution).
  - `fenghua-backend/migrations/012-add-customer-code-to-companies.sql`: **Migration created** - Add customer_code field.
  - `fenghua-frontend/src/customers/`: New module for customer management UI.
  - `fenghua-backend/src/permission/permission.service.ts`: Reuse existing PermissionService for role-based filtering.
  - `fenghua-backend/src/products/products.service.ts`: Reference for database connection pattern and error handling.

- **Testing standards summary:**
  - Unit tests for `customers.service.ts`, `customers.controller.ts` (backend).
  - Unit tests for customer components (frontend).
  - Integration tests for customer CRUD endpoints with role-based filtering.
  - E2E tests for customer creation, editing, and deletion flows with different user roles.

### Project Structure Notes

- Alignment with unified project structure (paths, modules, naming)
- Custom code in `fenghua-backend` and `fenghua-frontend`
- **Detected Conflicts or Variances:**
  - **Database:** Use custom `companies` table instead of Twenty CRM Custom Objects API (as per architecture decision to remove Twenty dependency)
  - **Customer Type Values:** Use 'BUYER' and 'SUPPLIER' (uppercase) as per database schema, but PermissionService returns lowercase - need conversion
  - **Role-Based Filtering:** Must use PermissionService.getDataAccessFilter() in all queries to ensure data isolation

### References

- **Epic Definition:** [epics.md#Story 3.1](_bmad-output/epics.md#story-31-ÂÆ¢Êà∑ÂàõÂª∫ÂíåÁÆ°ÁêÜÊåâËßíËâ≤)
- **Architecture Data Model:** [api-integration-architecture.md](docs/api-integration-architecture.md)
- **Database Schema:** [database-schema-design.md#ÂÆ¢Êà∑Ë°®](docs/database-schema-design.md) - Note: Use `companies` table from migration 006
- **Migration Script:** [006-create-companies-and-people-tables.sql](../fenghua-backend/migrations/006-create-companies-and-people-tables.sql)
- **PermissionService:** [permission.service.ts](../fenghua-backend/src/permission/permission.service.ts) - Reuse existing permission service for role-based filtering
- **Previous Story Pattern:** [2-1-product-creation-and-management.md](2-1-product-creation-and-management.md) - Reference for CRUD implementation pattern

### Key Technical Details

- **Database Schema:**
  - Table: `companies`
  - Primary Key: `id` (UUID)
  - Required Fields: `name`, `customer_code` (VARCHAR(50), unique), `customer_type` ('BUYER' or 'SUPPLIER')
  - Optional Fields: `domain_name`, `address`, `city`, `state`, `country`, `postal_code`, `industry`, `employees`, `website`, `phone`, `notes`
  - Status Field: `deleted_at` (TIMESTAMP) - for soft delete
  - Audit Fields: `created_at`, `updated_at`, `created_by`, `updated_by`
  - Constraints:
    - `customer_type` CHECK constraint (must be 'BUYER' or 'SUPPLIER')
    - `customer_code` UNIQUE constraint (via index `idx_companies_customer_code`)
  - **Indexes (from migration 006):**
    - `idx_companies_name` - Use for name-based searches (automatically used in WHERE name LIKE ...)
    - `idx_companies_customer_type` - Automatically used in WHERE customer_type = ... queries
    - `idx_companies_deleted_at` - Automatically used in WHERE deleted_at IS NULL queries
    - `idx_companies_customer_code` - Use for customer_code lookups and uniqueness checks
  - **Note:** `customer_code` field requires new migration script (not in migration 006)

- **Role-Based Data Filtering:**
  - Use `PermissionService.getDataAccessFilter(token)` to get filter criteria
  - Returns `{ customerType: 'buyer' }`, `{ customerType: 'supplier' }`, or `null` (no filter)
  - **Important:** Database stores uppercase ('BUYER', 'SUPPLIER'), but PermissionService returns lowercase ('buyer', 'supplier') - need conversion
  - Apply filter in all queries: `WHERE customer_type = $1 AND deleted_at IS NULL`
  - Apply filter in create/update operations: Validate user can only create/edit their allowed customer type

- **Customer Code Validation:**
  - Format: Alphanumeric characters, 1-50 characters
  - Uniqueness: Must be unique globally (enforced by unique index `idx_companies_customer_code`)
  - Validation: Use regex `/^[a-zA-Z0-9]{1,50}$/` for format validation
  - **Database Migration:** Migration script created: `012-add-customer-code-to-companies.sql`
    ```sql
    ALTER TABLE companies ADD COLUMN IF NOT EXISTS customer_code VARCHAR(50);
    CREATE UNIQUE INDEX IF NOT EXISTS idx_companies_customer_code 
    ON companies(customer_code) WHERE deleted_at IS NULL;
    ```
    **Note:** Execute migration script before implementing customer creation functionality.

- **Soft Delete Strategy:**
  - Check for associated records in `product_customer_interactions` table
  - If associations exist: Set `deleted_at = NOW()` (soft delete)
  - If no associations: Can perform hard delete (DELETE FROM companies)
  - All queries must filter: `WHERE deleted_at IS NULL`

- **API Endpoints:**
  - `GET /api/customers` - List customers (with role-based filtering, pagination, search)
  - `GET /api/customers/:id` - Get customer details
  - `POST /api/customers` - Create customer (with role-based validation)
  - `PUT /api/customers/:id` - Update customer (with role-based validation)
  - `DELETE /api/customers/:id` - Delete customer (soft or hard delete based on associations)

- **Frontend Components:**
  - `CustomerManagementPage.tsx` - Main page component
  - `CustomerList.tsx` - Customer list display
  - `CustomerCreateForm.tsx` - Create form
  - `CustomerEditForm.tsx` - Edit form
  - `customers.service.ts` - API service

- **Previous Story Learnings:**
  - From Story 2.1: Use `pg.Pool` for database connection, implement soft delete strategy, reuse AuditService
  - From Story 2.8: Implement proper validation, use DTOs for request/response, implement pagination
  - **Database Connection Pattern:** 
    - Use dependency injection, initialize pool in service constructor
    - Reference: `ProductsService.initializeDatabaseConnection()` (lines 36-54)
    - Use `ConfigService` for `DATABASE_URL`, implement `OnModuleDestroy` for cleanup
  - **Error Handling Pattern:**
    - Use try-catch blocks, return appropriate HTTP status codes
    - `BadRequestException` for validation errors (e.g., invalid customer_code format)
    - `NotFoundException` for missing resources (e.g., customer not found)
    - `ConflictException` for duplicate entries (e.g., duplicate customer_code)
    - Reference: `ProductsService` error handling examples
  - **User ID Pattern:**
    - Extract from `request.user.id` (set by JwtAuthGuard)
    - Use for `created_by` and `updated_by` fields in SQL queries
    - Reference: `ProductsService` line 222 for userId extraction pattern

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4.5 (via Cursor)

### Debug Log References

N/A

### Completion Notes List

- All backend CRUD operations implemented with role-based filtering
- Database migration executed successfully (012-add-customer-code-to-companies.sql)
- Frontend components created with role-based UI restrictions
- Backward compatibility maintained: Controller supports both `/customers` and `/companies` routes
- All unit tests passing (10/10)
- Frontend route added to App.tsx and HomePage quick access

### File List

**Backend Files:**
- `fenghua-backend/src/companies/dto/create-customer.dto.ts` (NEW)
- `fenghua-backend/src/companies/dto/update-customer.dto.ts` (NEW)
- `fenghua-backend/src/companies/dto/customer-response.dto.ts` (NEW)
- `fenghua-backend/src/companies/dto/customer-query.dto.ts` (NEW)
- `fenghua-backend/src/companies/companies.service.ts` (MODIFIED - extended with full CRUD)
- `fenghua-backend/src/companies/companies.controller.ts` (MODIFIED - extended with all endpoints)
- `fenghua-backend/src/companies/companies-compat.controller.ts` (NEW - backward compatibility for /companies/:id route)
- `fenghua-backend/src/companies/companies.module.ts` (MODIFIED - added PermissionModule and AuditModule)
- `fenghua-backend/src/companies/companies.controller.spec.ts` (NEW - unit tests)
- `fenghua-backend/migrations/012-add-customer-code-to-companies.sql` (NEW - executed)

**Frontend Files:**
- `fenghua-frontend/src/customers/customers.service.ts` (NEW)
- `fenghua-frontend/src/customers/CustomerManagementPage.tsx` (NEW)
- `fenghua-frontend/src/customers/components/CustomerList.tsx` (NEW)
- `fenghua-frontend/src/customers/components/CustomerCreateForm.tsx` (NEW)
- `fenghua-frontend/src/customers/components/CustomerEditForm.tsx` (NEW)
- `fenghua-frontend/src/App.tsx` (MODIFIED - added /customers route and quick access)

**Story Files:**
- `_bmad-output/implementation-artifacts/stories/3-1-customer-creation-and-management.md` (MODIFIED)
- `_bmad-output/implementation-artifacts/sprint-status.yaml` (MODIFIED - status updated to done)

### Change Log

**2025-01-03: Story 3.1 Implementation Complete**
- Implemented full CRUD operations for customer management
- Added role-based data filtering (Frontend Specialist: BUYER only, Backend Specialist: SUPPLIER only, Director/Admin: all)
- Created database migration for customer_code field
- Implemented frontend components with role-based restrictions
- Added backward compatibility for `/companies/:id` route (via CompaniesCompatController)
- Fixed customer type filter bug (empty string ‚Üí undefined)
- Unified API URL pattern (VITE_API_BASE_URL || VITE_BACKEND_URL)
- Added frontend route and navigation
- All tests passing (10/10)

**2025-01-03: Code Review Fixes Applied**
- Created CompaniesCompatController for backward compatibility with existing product pages
- Added /customers route to App.tsx and HomePage quick access
- Fixed customer type filter empty string bug
- Unified API URL pattern across frontend services
- Completed story documentation (File List, Change Log, Code Review section)

## Senior Developer Review (AI)

**Review Date:** 2025-01-03  
**Reviewer:** AI Code Reviewer  
**Outcome:** Changes Requested ‚Üí Fixed

### Review Findings

**üî¥ HIGH SEVERITY (Fixed):**
1. **Breaking Change: Backward Compatibility** - Controller changed from `/companies` to `/customers`, breaking existing product pages that call `/api/companies/:id`
   - **Fix Applied:** Created separate `CompaniesCompatController` to handle `/companies/:id` route for backward compatibility
   - **Files:** `companies-compat.controller.ts` (NEW), `companies.module.ts` (updated to register both controllers)
   - **Status:** ‚úÖ Fixed

2. **Frontend Route Missing** - CustomerManagementPage not accessible via routing
   - **Fix Applied:** Added `/customers` route to App.tsx and quick access module
   - **Status:** ‚úÖ Fixed

**üü° MEDIUM SEVERITY (Fixed):**
3. **Customer Type Filter Bug** - Empty string passed to backend instead of undefined
   - **Fix Applied:** Updated onChange handler to convert empty string to undefined
   - **Status:** ‚úÖ Fixed

4. **API URL Inconsistency** - customers.service.ts only used VITE_BACKEND_URL
   - **Fix Applied:** Updated to use `VITE_API_BASE_URL || VITE_BACKEND_URL` pattern
   - **Status:** ‚úÖ Fixed

5. **Story Documentation Incomplete** - Dev Agent Record missing File List and Change Log
   - **Fix Applied:** Added complete File List and Change Log
   - **Status:** ‚úÖ Fixed

### Review Follow-ups (AI)

- [x] [AI-Review][HIGH] Add backward compatibility for `/companies/:id` route [companies-compat.controller.ts (NEW)]
- [x] [AI-Review][HIGH] Add frontend route for CustomerManagementPage [App.tsx]
- [x] [AI-Review][MEDIUM] Fix customer type filter empty string bug [CustomerManagementPage.tsx:225]
- [x] [AI-Review][MEDIUM] Unify API URL pattern [customers.service.ts:8]
- [x] [AI-Review][MEDIUM] Complete story documentation [3-1-customer-creation-and-management.md]

### Test Results

- ‚úÖ Backend unit tests: 10/10 passing
- ‚úÖ Linter: No errors
- ‚úÖ All fixes verified

**Backend Files:**
- `fenghua-backend/src/companies/dto/create-customer.dto.ts` (NEW)
- `fenghua-backend/src/companies/dto/update-customer.dto.ts` (NEW)
- `fenghua-backend/src/companies/dto/customer-response.dto.ts` (NEW)
- `fenghua-backend/src/companies/dto/customer-query.dto.ts` (NEW)
- `fenghua-backend/src/companies/companies.service.ts` (MODIFIED - extended with full CRUD)
- `fenghua-backend/src/companies/companies.controller.ts` (MODIFIED - extended with all endpoints, added backward compatibility)
- `fenghua-backend/src/companies/companies.module.ts` (MODIFIED - added PermissionModule and AuditModule)
- `fenghua-backend/src/companies/companies.controller.spec.ts` (NEW - unit tests)
- `fenghua-backend/migrations/012-add-customer-code-to-companies.sql` (NEW - executed)

**Frontend Files:**
- `fenghua-frontend/src/customers/customers.service.ts` (NEW)
- `fenghua-frontend/src/customers/CustomerManagementPage.tsx` (NEW)
- `fenghua-frontend/src/customers/components/CustomerList.tsx` (NEW)
- `fenghua-frontend/src/customers/components/CustomerCreateForm.tsx` (NEW)
- `fenghua-frontend/src/customers/components/CustomerEditForm.tsx` (NEW)
- `fenghua-frontend/src/App.tsx` (MODIFIED - added /customers route and quick access)

**Story Files:**
- `_bmad-output/implementation-artifacts/stories/3-1-customer-creation-and-management.md` (MODIFIED)
- `_bmad-output/implementation-artifacts/sprint-status.yaml` (MODIFIED - status updated to done)

### Change Log

**2025-01-03: Story 3.1 Implementation Complete**
- Implemented full CRUD operations for customer management
- Added role-based data filtering (Frontend Specialist: BUYER only, Backend Specialist: SUPPLIER only, Director/Admin: all)
- Created database migration for customer_code field
- Implemented frontend components with role-based restrictions
- Added backward compatibility for `/companies/:id` route
- Fixed customer type filter bug (empty string ‚Üí undefined)
- Unified API URL pattern (VITE_API_BASE_URL || VITE_BACKEND_URL)
- Added frontend route and navigation
- All tests passing

