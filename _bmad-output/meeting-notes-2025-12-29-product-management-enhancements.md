# 会议记录：产品管理模块功能增强讨论

**日期：** 2025-12-29  
**参与者：** Travis_z, John (PM), Winston (Architect), Amelia (Dev), Sally (UX), Mary (Analyst)  
**讨论主题：** 产品管理模块需求变更和技术实现方案

---

## 会议摘要

本次会议讨论了产品管理模块的三个重要功能增强需求：
1. 产品类别动态管理（从硬编码改为可维护）
2. 产品规格输入方式改进（从JSON文本改为表格形式）
3. 类别与HS编码双向联动机制

---

## 讨论内容

### 1. 产品类别管理功能

**需求描述：**
- 产品类别需要可以维护（动态管理，而非硬编码）
- 在产品管理页面添加类别管理模块
- 每个类别需要绑定HS编码（一对一关系）
- 创建产品时，选择类别自动填入HS编码，选择HS编码自动填入类别

**技术决策：**
- ✅ 创建新的数据库表 `product_categories`
- ✅ 类别名称和HS编码都设为唯一约束
- ✅ 使用软删除保留历史数据
- ✅ 删除前检查使用情况，已使用的类别无法删除
- ✅ 添加类别使用统计功能（显示有多少产品使用该类别）

**实施计划：**
- 创建新Story 2.8: 产品类别管理
- 更新Story 2.1: 添加类别-HS编码双向联动功能
- 优先级：高（在Story 2.2之前实现）

### 2. 产品规格输入方式改进

**需求描述：**
- 将产品规格从JSON文本输入改为表格形式
- 用户可以动态添加/删除行
- 每行包含属性名和属性值两个字段
- 更直观、易用的输入体验

**技术决策：**
- ✅ 创建可复用的 `SpecificationsTable` 组件
- ✅ 前端表格数据 ↔ JSON格式双向转换
- ✅ 后端存储格式保持不变（仍为JSONB）
- ✅ 实时检测重复属性名
- ✅ 空行自动清理（提交时）

**实施计划：**
- 更新Story 2.1: 添加规格表格化UI改进
- 创建独立的规格表格组件
- 无需修改后端API

### 3. 双向联动机制

**核心设计原则：**
- HS编码 ↔ 产品类别：一对一绑定，始终同步
- 用户选择任一字段，另一字段自动更新
- 系统保证一致性，不存在不匹配情况

**实现细节：**
- 选择类别 → 同步HS编码（同步操作）
- 输入HS编码 → 查询并同步类别（异步操作，使用防抖优化）
- 提供清晰的同步状态反馈

---

## 影响分析

### Epic 2 更新

**用户成果更新：**
- 原：管理员可以创建和管理产品，所有用户可以搜索和查看产品信息
- 新：管理员可以创建和管理产品，维护产品类别和HS编码映射关系，所有用户可以搜索和查看产品信息

**新增Story：**
- Story 2.8: 产品类别管理（高优先级）

**需要更新的Story：**
- Story 2.1: 产品创建和管理
  - 添加类别-HS编码双向联动AC
  - 添加规格表格化UI的AC
  - 更新类别选择逻辑（从硬编码改为动态查询）

### 数据库变更

**新增迁移脚本：**
- `009-create-product-categories-table.sql` - 创建类别表
- `010-seed-product-categories.sql` - 导入现有硬编码类别

**数据迁移：**
- 将现有的6个硬编码类别导入数据库
- 确保现有产品数据不受影响

---

## 实施优先级

1. **Phase 1（高优先级）**：产品类别管理基础功能
   - Story 2.8: 产品类别管理
   - 数据库迁移和基础CRUD

2. **Phase 2（高优先级）**：产品创建表单增强
   - 更新Story 2.1: 添加双向联动功能
   - 更新Story 2.1: 添加规格表格化UI

3. **Phase 3（中优先级）**：使用统计和优化
   - 类别使用统计显示
   - UI优化和用户体验提升

---

## 技术要点总结

### 后端实现
- 创建 `ProductCategoriesModule` 和完整CRUD服务
- 修改 `ProductsService` 以验证类别存在性
- 实现类别使用统计查询

### 前端实现
- 创建类别管理页面和组件
- 实现双向联动逻辑（防抖优化）
- 创建规格表格组件
- 更新产品创建/编辑表单

### 数据模型
- `product_categories` 表：id, name, hs_code, description, 审计字段
- 唯一约束：name, hs_code
- 软删除支持

---

## 下一步行动

1. ✅ 创建Story 2.8文档
2. ✅ 更新Story 2.1文档
3. ✅ 更新Epic 2描述
4. ✅ 更新sprint-status.yaml
5. ⏳ 开始实施Phase 1（等待开发资源）

---

## 备注

- 所有讨论内容已记录在Party Mode会话中
- 技术实现细节已由Winston和Amelia详细讨论
- UX设计建议已由Sally提供
- 产品规划已由John确认

---

**会议记录整理：** John (Product Manager)  
**审核：** Travis_z  
**日期：** 2025-12-29

