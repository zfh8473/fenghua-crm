# Story 8.7: 分析结果导出 - 手动测试指南

**Story:** 8.7 - 分析结果导出  
**测试日期：** 2025-01-XX  
**测试人员：** [测试人员姓名]

---

## 📋 测试概述

本测试指南用于验证 Story 8.7 的所有功能，包括：
- 统一导出服务
- CSV、Excel、PDF 导出
- 图表转图片功能
- 前端统一导出组件
- 错误处理和性能优化

---

## 🔐 前置条件

1. **用户权限：** 使用总监或管理员账户登录
2. **后端服务：** 确保后端服务正在运行（端口 3001）
3. **前端服务：** 确保前端服务正在运行（端口 3002 或 5173）
4. **测试数据：** 确保各分析页面有测试数据

---

## 📝 测试用例

### TC 1: 产品关联分析 - CSV 导出

**步骤：**
1. 登录系统（总监或管理员账户）
2. 导航到「产品关联分析」页面
3. 设置筛选条件（可选）：
   - 产品类别
   - 开始日期
   - 结束日期
4. 点击「导出」按钮
5. 在导出对话框中选择「CSV 格式（数据表格）」
6. 点击「导出」按钮

**预期结果：**
- ✅ 导出对话框正常显示
- ✅ 可以选择 CSV 格式
- ✅ 点击导出后，浏览器自动下载 CSV 文件
- ✅ 文件名格式：`产品关联分析_YYYY-MM-DD.csv`
- ✅ CSV 文件包含表头和数据行
- ✅ 表头为中文：产品ID、产品名称、产品类别等
- ✅ 数据与页面显示一致

**验证点：**
- [ ] 导出对话框显示正常
- [ ] CSV 文件下载成功
- [ ] 文件内容正确
- [ ] 中文表头显示正确

---

### TC 2: 产品关联分析 - Excel 导出

**步骤：**
1. 在「产品关联分析」页面
2. 点击「导出」按钮
3. 选择「Excel 格式（数据表格）」
4. 点击「导出」

**预期结果：**
- ✅ Excel 文件下载成功
- ✅ 文件名格式：`产品关联分析_YYYY-MM-DD.xlsx`
- ✅ Excel 文件可以正常打开
- ✅ 包含工作表，名称为「产品关联分析」
- ✅ 数据格式正确，包含所有列

**验证点：**
- [ ] Excel 文件下载成功
- [ ] 文件可以正常打开
- [ ] 工作表名称正确
- [ ] 数据完整

---

### TC 3: 产品关联分析 - PDF 导出

**步骤：**
1. 在「产品关联分析」页面
2. 点击「导出」按钮
3. 选择「PDF 格式（完整报告）」
4. 可选：勾选「包含图表」
5. 点击「导出」

**预期结果：**
- ✅ PDF 文件下载成功
- ✅ 文件名格式：`产品关联分析_YYYY-MM-DD.pdf`
- ✅ PDF 文件可以正常打开
- ✅ 包含标题：「产品关联分析报告」
- ✅ 包含导出时间和筛选条件
- ✅ 包含数据表格（带表头）
- ✅ 表格格式美观（表头背景色、交替行背景）

**验证点：**
- [ ] PDF 文件下载成功
- [ ] PDF 可以正常打开
- [ ] 标题和元数据正确
- [ ] 表格格式正确
- [ ] 中文字体显示正常

---

### TC 4: 产品关联分析 - 图表导出（PNG）

**步骤：**
1. 在「产品关联分析」页面
2. 确保页面显示「订单转化率趋势」图表
3. 点击「导出」按钮
4. 选择「PNG 图片（图表）」
5. 点击「导出」

**预期结果：**
- ✅ PNG 图片下载成功
- ✅ 文件名格式：`product-association_YYYY-MM-DD.png`
- ✅ 图片可以正常打开
- ✅ 图表清晰，包含所有元素（坐标轴、图例、数据点）

**验证点：**
- [ ] PNG 图片下载成功
- [ ] 图片清晰
- [ ] 图表元素完整

---

### TC 5: 客户分析 - 多格式导出

**步骤：**
1. 导航到「客户分析」页面
2. 设置筛选条件（客户类型、日期范围）
3. 测试以下导出格式：
   - CSV
   - Excel
   - PDF
   - PNG（客户流失率趋势图表）

**预期结果：**
- ✅ 所有格式导出成功
- ✅ 文件内容与页面数据一致
- ✅ 图表导出清晰

**验证点：**
- [ ] CSV 导出成功
- [ ] Excel 导出成功
- [ ] PDF 导出成功
- [ ] PNG 图表导出成功

---

### TC 6: 供应商分析 - 导出功能

**步骤：**
1. 导航到「供应商分析」页面
2. 测试 CSV、Excel、PDF 导出
3. 测试 PNG 图表导出（供应商合作频率趋势）

**预期结果：**
- ✅ 所有格式导出成功
- ✅ 数据正确

**验证点：**
- [ ] 所有格式导出成功
- [ ] 数据正确

---

### TC 7: 采购商分析 - 多图表导出

**步骤：**
1. 导航到「采购商分析」页面
2. 测试导出功能
3. 注意：此页面有 2 个图表（活跃度趋势、流失率趋势）

**预期结果：**
- ✅ 导出对话框显示「将导出 2 个图表」
- ✅ PNG/JPEG 导出时，2 个图表合并为一张图片
- ✅ 数据导出正常

**验证点：**
- [ ] 多图表导出提示正确
- [ ] 合并图片包含 2 个图表
- [ ] 数据导出正常

---

### TC 8: 业务趋势分析 - 导出功能

**步骤：**
1. 导航到「业务趋势分析」页面
2. 设置时间范围和指标
3. 测试所有导出格式

**预期结果：**
- ✅ 所有格式导出成功
- ✅ 趋势数据正确

**验证点：**
- [ ] 所有格式导出成功
- [ ] 趋势数据正确

---

### TC 9: 数据量限制测试

**步骤：**
1. 选择一个分析页面
2. 设置筛选条件，使数据量超过限制：
   - CSV/Excel: 超过 50,000 条
   - PDF: 超过 10,000 条
   - PNG/JPEG: 超过 1,000 条（图表数量）
3. 尝试导出

**预期结果：**
- ✅ 系统显示错误消息
- ✅ 错误消息友好，提示用户缩小范围
- ✅ 错误消息包含具体限制数量

**验证点：**
- [ ] 数据量限制检查生效
- [ ] 错误消息友好
- [ ] 包含恢复建议

---

### TC 10: 错误处理测试

**测试场景 1: 网络错误**
- 断开网络连接
- 尝试导出
- **预期：** 显示网络错误消息

**测试场景 2: 无效格式**
- 尝试使用不支持的格式（如果前端允许）
- **预期：** 显示格式错误消息

**测试场景 3: 权限错误**
- 使用非总监/管理员账户登录
- 尝试访问导出功能
- **预期：** 显示权限错误或按钮不可用

**验证点：**
- [ ] 网络错误处理正确
- [ ] 格式错误处理正确
- [ ] 权限检查正确

---

### TC 11: 导出对话框功能测试

**步骤：**
1. 打开任意分析页面
2. 点击「导出」按钮
3. 测试对话框功能：
   - 格式选择（单选按钮）
   - PDF 选项（包含图表复选框）
   - 取消按钮
   - 错误消息显示

**预期结果：**
- ✅ 对话框显示正常
- ✅ 所有选项可正常选择
- ✅ 取消按钮关闭对话框
- ✅ 错误消息正确显示

**验证点：**
- [ ] 对话框 UI 正常
- [ ] 选项选择正常
- [ ] 取消功能正常
- [ ] 错误显示正常

---

### TC 12: 导出文件命名测试

**步骤：**
1. 测试各分析类型的导出
2. 检查文件名格式

**预期结果：**
- ✅ 产品关联分析：`产品关联分析_YYYY-MM-DD.{ext}`
- ✅ 客户分析：`客户分析_YYYY-MM-DD.{ext}`
- ✅ 供应商分析：`供应商分析_YYYY-MM-DD.{ext}`
- ✅ 采购商分析：`采购商分析_YYYY-MM-DD.{ext}`
- ✅ 业务趋势分析：`业务趋势分析_YYYY-MM-DD.{ext}`

**验证点：**
- [ ] 文件名格式正确
- [ ] 包含日期
- [ ] 扩展名正确

---

## 🐛 已知问题

（测试过程中发现的问题记录在这里）

---

## ✅ 测试结果总结

### 测试通过率
- **总测试用例数：** 12
- **通过：** __ / 12
- **失败：** __ / 12
- **跳过：** __ / 12

### 功能状态
- ✅ CSV 导出：通过 / 失败
- ✅ Excel 导出：通过 / 失败
- ✅ PDF 导出：通过 / 失败
- ✅ PNG/JPEG 导出：通过 / 失败
- ✅ 错误处理：通过 / 失败
- ✅ 数据量限制：通过 / 失败

### 浏览器兼容性
- ✅ Chrome：通过 / 失败
- ✅ Firefox：通过 / 失败
- ✅ Safari：通过 / 失败
- ✅ Edge：通过 / 失败

---

## 📝 测试备注

（测试过程中的其他观察和备注）

---

## 🔄 回归测试

完成修复后，需要重新测试以下用例：
- [ ] TC 9: 数据量限制测试
- [ ] TC 10: 错误处理测试

---

**测试完成日期：** ___________  
**测试人员签名：** ___________

