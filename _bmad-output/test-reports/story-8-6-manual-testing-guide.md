# Story 8.6: 业务趋势分析 - 手动测试指南

**Story:** 8-6-business-trend-analysis  
**测试日期:** 2026-01-12  
**测试人员:** QA Team

---

## 测试环境准备

### 前置条件

1. **用户角色要求:**
   - 至少需要一个 `ADMIN` 或 `DIRECTOR` 角色的用户账号
   - 至少需要一个非 `ADMIN`/`DIRECTOR` 角色的用户账号（用于权限测试）

2. **测试数据要求:**
   - 系统中应存在产品-客户互动记录（`product_customer_interactions` 表）
   - 至少有一些互动记录的 `interaction_type` 为 `order_signed` 或 `order_completed`
   - 至少有一些互动记录的 `additional_info` JSONB 字段包含 `orderAmount` 或 `amount` 字段
   - 系统中应存在客户数据（`companies` 表），包含不同创建日期的客户（用于客户增长趋势测试）
   - 至少有一些历史数据（跨越多个时间周期，如多个月份）

3. **系统要求:**
   - 后端服务运行在 `http://localhost:3001`（或配置的端口）
   - 前端应用运行在 `http://localhost:5173`（或配置的端口）
   - 数据库连接正常
   - Redis 连接正常（可选，用于缓存测试）

4. **数据库迁移:**
   - 确保已运行迁移文件 `027-add-business-trend-analysis-indexes.sql`

---

## 测试用例

### TC1: 访问权限验证

**目标:** 验证只有 `ADMIN` 和 `DIRECTOR` 角色可以访问业务趋势分析页面

**步骤:**
1. 使用非 `ADMIN`/`DIRECTOR` 角色的用户登录系统
2. 尝试直接访问 `/dashboard/business-trend-analysis` URL
3. 观察页面显示

**预期结果:**
- 页面显示"只有总监和管理员可以访问此页面"的错误提示
- 非授权用户无法查看业务趋势分析数据

**实际结果:** [ ] 通过 / [ ] 失败

**备注:** 

---

### TC2: 业务趋势分析数据基础显示

**目标:** 验证业务趋势分析数据能够正确显示

**步骤:**
1. 使用 `ADMIN` 或 `DIRECTOR` 角色用户登录系统
2. 导航到"业务趋势分析"页面（通过侧边栏菜单或直接访问 `/dashboard/business-trend-analysis`）
3. 等待页面加载完成
4. 观察页面显示的内容

**预期结果:**
- 页面标题显示为"业务趋势分析"
- 显示筛选条件区域（开始日期、结束日期、时间粒度、指标选择）
- 显示趋势统计卡片（总订单量、新增客户数、总销售额、平均增长率）
- 显示业务趋势图表（折线图或面积图）
- 图表默认显示订单量、客户增长、销售额三个指标

**实际结果:** [ ] 通过 / [ ] 失败

**备注:** 

---

### TC3: 时间范围筛选

**目标:** 验证按时间范围筛选功能

**步骤:**
1. 在业务趋势分析页面，选择"开始日期"和"结束日期"
2. 选择一个时间范围（如最近3个月）
3. 观察图表数据变化
4. 清除日期筛选
5. 观察图表数据恢复

**预期结果:**
- 选择时间范围后，图表只显示该时间范围内的趋势数据
- 清除筛选后，图表显示默认时间范围（最近12个月）的数据

**实际结果:** [ ] 通过 / [ ] 失败

**备注:** 

---

### TC4: 时间粒度选择

**目标:** 验证时间粒度选择功能

**步骤:**
1. 在业务趋势分析页面，选择不同的时间粒度（按天、按周、按月、按季度、按年）
2. 观察图表数据变化
3. 验证每个时间粒度的数据聚合是否正确

**预期结果:**
- 选择"按天"后，图表按天显示数据点
- 选择"按周"后，图表按周显示数据点
- 选择"按月"后，图表按月显示数据点
- 选择"按季度"后，图表按季度显示数据点
- 选择"按年"后，图表按年显示数据点
- 数据聚合正确，每个周期显示该周期内的汇总数据

**实际结果:** [ ] 通过 / [ ] 失败

**备注:** 

---

### TC5: 指标选择

**目标:** 验证指标选择功能

**步骤:**
1. 在业务趋势分析页面，点击指标选择按钮（订单量、客户增长、销售额）
2. 取消选择某个指标（如"销售额"）
3. 观察图表数据变化
4. 重新选择该指标
5. 观察图表数据恢复

**预期结果:**
- 取消选择某个指标后，图表中不再显示该指标的折线
- 重新选择该指标后，图表中重新显示该指标的折线
- 至少需要选择一个指标（不能全部取消）

**实际结果:** [ ] 通过 / [ ] 失败

**备注:** 

---

### TC6: 趋势统计显示

**目标:** 验证趋势统计信息正确显示

**步骤:**
1. 查看业务趋势分析页面中的趋势统计卡片
2. 验证以下统计信息：
   - 总订单量
   - 新增客户数
   - 总销售额
   - 平均增长率

**预期结果:**
- 趋势统计卡片正确显示所有统计信息
- 统计数据与图表数据一致
- 增长率使用颜色编码（正增长=绿色，负增长=红色）

**实际结果:** [ ] 通过 / [ ] 失败

**备注:** 

---

### TC7: 增长率计算

**目标:** 验证环比和同比增长率计算正确

**步骤:**
1. 查看业务趋势图表中的数据点
2. 验证环比增长率（与上一期比较）
3. 验证同比增长率（与去年同期比较，如果数据足够）

**预期结果:**
- 环比增长率计算正确：`(本期 - 上期) / 上期 × 100%`
- 同比增长率计算正确：`(本期 - 去年同期) / 去年同期 × 100%`
- 增长率在图表工具提示中显示

**实际结果:** [ ] 通过 / [ ] 失败

**备注:** 

---

### TC8: 图表交互功能

**目标:** 验证图表交互功能

**步骤:**
1. 在业务趋势图表中，悬停在数据点上
2. 观察工具提示显示
3. 尝试缩放图表（如果支持）
4. 尝试点击图例（如果支持）

**预期结果:**
- 悬停数据点时，显示该周期的详细数据（订单量、客户增长、销售额等）
- 工具提示格式清晰易读
- 图表响应式设计，适配不同屏幕尺寸

**实际结果:** [ ] 通过 / [ ] 失败

**备注:** 

---

### TC9: 导出功能

**目标:** 验证导出功能正常工作

**步骤:**
1. 在业务趋势分析页面，点击"导出 CSV"按钮
2. 等待导出完成
3. 检查下载的CSV文件

**预期结果:**
- 点击"导出 CSV"后，按钮显示"导出中..."状态
- 导出完成后，自动下载CSV文件
- CSV文件名格式为：`业务趋势分析_{时间粒度}_YYYY-MM-DD.csv`
- CSV文件包含所有趋势数据，包括：
  - 时间周期
  - 订单量
  - 新增客户数
  - 销售额
  - 环比增长率
  - 同比增长率

**实际结果:** [ ] 通过 / [ ] 失败

**备注:** 

---

### TC10: 加载状态和错误处理

**目标:** 验证页面加载状态和错误处理

**步骤:**
1. 刷新业务趋势分析页面
2. 观察加载状态（骨架屏）
3. 如果后端服务停止，观察错误提示
4. 重启后端服务，观察页面恢复

**预期结果:**
- 页面加载时显示骨架屏
- 如果后端服务不可用，显示错误提示
- 错误提示包含"重试"按钮
- 点击"重试"按钮后，重新加载数据

**实际结果:** [ ] 通过 / [ ] 失败

**备注:** 

---

### TC11: 缓存功能（可选）

**目标:** 验证 Redis 缓存功能（如果 Redis 可用）

**步骤:**
1. 在业务趋势分析页面，执行一次查询
2. 立即再次执行相同的查询（不改变筛选条件）
3. 观察后端日志（如果可能）

**预期结果:**
- 第一次查询从数据库获取数据
- 第二次查询从 Redis 缓存获取数据（如果 Redis 可用）
- 缓存过期时间为 5 分钟

**实际结果:** [ ] 通过 / [ ] 失败

**备注:** 

---

### TC12: 大数据量性能

**目标:** 验证大数据量下的性能表现

**步骤:**
1. 选择较长的时间范围（如最近2年）
2. 选择较小的时间粒度（如按天）
3. 观察页面加载时间和响应速度

**预期结果:**
- 页面在合理时间内加载完成（< 5 秒）
- 图表渲染流畅，无卡顿
- 数据聚合在服务端完成，减少传输数据量

**实际结果:** [ ] 通过 / [ ] 失败

**备注:** 

---

## 测试结果汇总

### 测试执行统计

- **总测试用例数:** 12
- **通过:** [ ] 个
- **失败:** [ ] 个
- **跳过:** [ ] 个

### 功能验证

- [ ] TC1: 访问权限验证
- [ ] TC2: 业务趋势分析数据基础显示
- [ ] TC3: 时间范围筛选
- [ ] TC4: 时间粒度选择
- [ ] TC5: 指标选择
- [ ] TC6: 趋势统计显示
- [ ] TC7: 增长率计算
- [ ] TC8: 图表交互功能
- [ ] TC9: 导出功能
- [ ] TC10: 加载状态和错误处理
- [ ] TC11: 缓存功能（可选）
- [ ] TC12: 大数据量性能

### 发现的问题

**严重问题:**
- 无

**高优先级问题:**
- 无

**中优先级问题:**
- 无

**低优先级问题:**
- 无

### 测试结论

**总体评估:** [ ] 通过 / [ ] 失败 / [ ] 部分通过

**备注:**
- 

---

## 测试人员签名

**测试人员:** [填写姓名]  
**测试日期:** 2026-01-12  
**测试状态:** [ ] 完成

