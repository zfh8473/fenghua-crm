# Story 16.3 ç«¯åˆ°ç«¯æµ‹è¯•å¿«é€Ÿå¼€å§‹

**Story:** 16.3 - æ›¿æ¢ç”¨æˆ·å’Œè§’è‰²ç®¡ç†  
**åˆ›å»ºæ—¥æœŸï¼š** 2025-12-26

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ³• 1: ä½¿ç”¨æµ‹è¯•è„šæœ¬ï¼ˆæ¨èï¼‰

#### æ­¥éª¤ 1: è®¾ç½®ç™»å½•ä¿¡æ¯

```bash
# æ–¹å¼ 1: ä½¿ç”¨é‚®ç®±å’Œå¯†ç è‡ªåŠ¨ç™»å½•
export TEST_EMAIL='zfh8473@gmail.com'
export TEST_PASSWORD='your-password'

# æ–¹å¼ 2: æ‰‹åŠ¨ç™»å½•åè®¾ç½® tokenï¼ˆä»æµè§ˆå™¨ localStorage å¤åˆ¶ï¼‰
export TEST_TOKEN='your-jwt-token-here'
```

#### æ­¥éª¤ 2: è¿è¡Œæµ‹è¯•è„šæœ¬

```bash
cd /Users/travis_z/Documents/GitHub/fenghua-crm
bash _bmad-output/test-reports/story-16-3-e2e-test-complete.sh
```

**æµ‹è¯•è„šæœ¬å°†è‡ªåŠ¨ï¼š**
- âœ… æ£€æŸ¥æœåŠ¡çŠ¶æ€
- âœ… ç™»å½•è·å– tokenï¼ˆå¦‚æœè®¾ç½®äº†é‚®ç®±å’Œå¯†ç ï¼‰
- âœ… æµ‹è¯•æ‰€æœ‰ç”¨æˆ·ç®¡ç† API
- âœ… æµ‹è¯•æ‰€æœ‰è§’è‰²ç®¡ç† API
- âœ… æµ‹è¯•è¾“å…¥éªŒè¯
- âœ… ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š

---

### æ–¹æ³• 2: æ‰‹åŠ¨æµè§ˆå™¨æµ‹è¯•

#### æ­¥éª¤ 1: æ‰“å¼€æµè§ˆå™¨

è®¿é—®ï¼š`http://localhost:3005/login`

#### æ­¥éª¤ 2: ç™»å½•

- é‚®ç®±ï¼š`zfh8473@gmail.com`ï¼ˆæˆ–ä½ çš„ç®¡ç†å‘˜è´¦æˆ·ï¼‰
- å¯†ç ï¼šä½ çš„å¯†ç 
- ç‚¹å‡»"ç™»å½•"

#### æ­¥éª¤ 3: æµ‹è¯•ç”¨æˆ·ç®¡ç†

1. **æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨ï¼š**
   - å¯¼èˆªåˆ°ç”¨æˆ·ç®¡ç†é¡µé¢
   - æ£€æŸ¥ç”¨æˆ·åˆ—è¡¨æ˜¯å¦æ­£ç¡®æ˜¾ç¤º

2. **åˆ›å»ºç”¨æˆ·ï¼š**
   - ç‚¹å‡»"åˆ›å»ºæ–°ç”¨æˆ·"
   - å¡«å†™è¡¨å•å¹¶æäº¤
   - éªŒè¯ç”¨æˆ·æ˜¯å¦å‡ºç°åœ¨åˆ—è¡¨ä¸­

3. **æ›´æ–°ç”¨æˆ·ï¼š**
   - é€‰æ‹©ä¸€ä¸ªç”¨æˆ·ï¼Œç‚¹å‡»"ç¼–è¾‘"
   - ä¿®æ”¹ä¿¡æ¯å¹¶ä¿å­˜
   - éªŒè¯æ›´æ–°æ˜¯å¦æˆåŠŸ

4. **åˆ é™¤ç”¨æˆ·ï¼š**
   - é€‰æ‹©ä¸€ä¸ªç”¨æˆ·ï¼ˆä¸æ˜¯å½“å‰ç”¨æˆ·ï¼‰ï¼Œç‚¹å‡»"åˆ é™¤"
   - éªŒè¯ç”¨æˆ·æ˜¯å¦ä»åˆ—è¡¨ä¸­æ¶ˆå¤±

#### æ­¥éª¤ 4: æµ‹è¯•è§’è‰²ç®¡ç†

1. **æŸ¥çœ‹è§’è‰²ï¼š**
   - é€šè¿‡ API æˆ– UI æŸ¥çœ‹è§’è‰²åˆ—è¡¨

2. **åˆ†é…è§’è‰²ï¼š**
   - ç¼–è¾‘ç”¨æˆ·ï¼Œåˆ†é…è§’è‰²
   - éªŒè¯è§’è‰²æ˜¯å¦æ­£ç¡®åˆ†é…

---

### æ–¹æ³• 3: ä½¿ç”¨ API æµ‹è¯•å·¥å…·

#### ä½¿ç”¨ curl

```bash
# 1. ç™»å½•è·å– token
TOKEN=$(curl -s -X POST \
  -H "Content-Type: application/json" \
  -d '{"email":"zfh8473@gmail.com","password":"your-password"}' \
  http://localhost:3001/auth/login | jq -r '.token')

# 2. è·å–ç”¨æˆ·åˆ—è¡¨
curl -H "Authorization: Bearer $TOKEN" \
  http://localhost:3001/users

# 3. åˆ›å»ºç”¨æˆ·
curl -X POST \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "email": "newuser@example.com",
    "password": "password123",
    "firstName": "New",
    "lastName": "User",
    "role": "FRONTEND_SPECIALIST"
  }' \
  http://localhost:3001/users
```

#### ä½¿ç”¨ Postman

1. **å¯¼å…¥ API é›†åˆï¼š**
   - åˆ›å»ºæ–°çš„ Collection
   - æ·»åŠ æ‰€æœ‰ API ç«¯ç‚¹

2. **è®¾ç½®è®¤è¯ï¼š**
   - åœ¨ Collection çº§åˆ«è®¾ç½® Bearer Token
   - å…ˆè°ƒç”¨ç™»å½•æ¥å£è·å– token
   - å°† token è®¾ç½®ä¸ºç¯å¢ƒå˜é‡

3. **æ‰§è¡Œæµ‹è¯•ï¼š**
   - è¿è¡Œæ‰€æœ‰è¯·æ±‚
   - æ£€æŸ¥å“åº”çŠ¶æ€ç å’Œå†…å®¹

---

## ğŸ“‹ æµ‹è¯•æ£€æŸ¥æ¸…å•

### åŸºç¡€åŠŸèƒ½æµ‹è¯•

- [ ] æœåŠ¡è¿è¡Œæ­£å¸¸ï¼ˆåç«¯ + å‰ç«¯ï¼‰
- [ ] å¯ä»¥æˆåŠŸç™»å½•
- [ ] Token æ­£ç¡®å­˜å‚¨ï¼ˆlocalStorage: `fenghua_auth_token`ï¼‰

### ç”¨æˆ·ç®¡ç†æµ‹è¯•

- [ ] å¯ä»¥æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨
- [ ] å¯ä»¥æŒ‰è§’è‰²ç­›é€‰ç”¨æˆ·ï¼ˆå¦‚æœ UI æ”¯æŒï¼‰
- [ ] å¯ä»¥æœç´¢ç”¨æˆ·ï¼ˆå¦‚æœ UI æ”¯æŒï¼‰
- [ ] å¯ä»¥åˆ›å»ºæ–°ç”¨æˆ·
- [ ] é‡å¤é‚®ç®±éªŒè¯æ­£å¸¸å·¥ä½œ
- [ ] å¯ä»¥æ›´æ–°ç”¨æˆ·ä¿¡æ¯
- [ ] å¯ä»¥æ›´æ–°ç”¨æˆ·è§’è‰²
- [ ] å¯ä»¥è½¯åˆ é™¤ç”¨æˆ·
- [ ] è‡ªæˆ‘åˆ é™¤ä¿æŠ¤æ­£å¸¸å·¥ä½œ

### è§’è‰²ç®¡ç†æµ‹è¯•

- [ ] å¯ä»¥æŸ¥çœ‹è§’è‰²åˆ—è¡¨
- [ ] å¯ä»¥è·å–ç”¨æˆ·è§’è‰²
- [ ] å¯ä»¥åˆ†é…è§’è‰²ç»™ç”¨æˆ·
- [ ] å¯ä»¥ç§»é™¤ç”¨æˆ·è§’è‰²

### è¾“å…¥éªŒè¯æµ‹è¯•

- [ ] æœç´¢è¯é•¿åº¦éªŒè¯ï¼ˆæœ€å¤§ 100 å­—ç¬¦ï¼‰
- [ ] è§’è‰²ç­›é€‰é•¿åº¦éªŒè¯ï¼ˆæœ€å¤§ 50 å­—ç¬¦ï¼‰

---

## ğŸ” è°ƒè¯•æŠ€å·§

### æµè§ˆå™¨å¼€å‘è€…å·¥å…·

1. **Network æ ‡ç­¾é¡µï¼š**
   - æŸ¥çœ‹æ‰€æœ‰ API è¯·æ±‚
   - æ£€æŸ¥è¯·æ±‚å’Œå“åº”
   - æŸ¥çœ‹é”™è¯¯çŠ¶æ€ç 

2. **Console æ ‡ç­¾é¡µï¼š**
   - æŸ¥çœ‹ JavaScript é”™è¯¯
   - æŸ¥çœ‹æ—¥å¿—è¾“å‡º

3. **Application > Local Storageï¼š**
   - æ£€æŸ¥ `fenghua_auth_token` æ˜¯å¦å­˜åœ¨
   - æ£€æŸ¥ token å€¼

### å¸¸è§é—®é¢˜

1. **401 Unauthorizedï¼š**
   - æ£€æŸ¥ token æ˜¯å¦æ­£ç¡®
   - æ£€æŸ¥ token æ˜¯å¦è¿‡æœŸ
   - é‡æ–°ç™»å½•è·å–æ–° token

2. **403 Forbiddenï¼š**
   - æ£€æŸ¥ç”¨æˆ·è§’è‰²æ˜¯å¦ä¸º ADMIN
   - æ£€æŸ¥æƒé™è®¾ç½®

3. **404 Not Foundï¼š**
   - æ£€æŸ¥ API ç«¯ç‚¹æ˜¯å¦æ­£ç¡®
   - æ£€æŸ¥ç”¨æˆ· ID æ˜¯å¦å­˜åœ¨

---

## ğŸ“ æµ‹è¯•è®°å½•

æ‰§è¡Œæµ‹è¯•åï¼Œè¯·è®°å½•ï¼š

1. **æµ‹è¯•æ—¶é—´ï¼š** [æ—¶é—´]
2. **æµ‹è¯•ç¯å¢ƒï¼š** [ç¯å¢ƒä¿¡æ¯]
3. **æµ‹è¯•ç»“æœï¼š** [é€šè¿‡/å¤±è´¥]
4. **å‘ç°çš„é—®é¢˜ï¼š** [é—®é¢˜æè¿°]
5. **æˆªå›¾/æ—¥å¿—ï¼š** [é™„ä»¶è·¯å¾„]

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **æµ‹è¯•è®¡åˆ’ï¼š** `_bmad-output/test-reports/story-16-3-e2e-test-plan-2025-12-26.md`
- **æ‰‹åŠ¨æµ‹è¯•æŒ‡å—ï¼š** `_bmad-output/test-reports/story-16-3-e2e-test-manual-guide-2025-12-26.md`
- **æµ‹è¯•è„šæœ¬ï¼š** `_bmad-output/test-reports/story-16-3-e2e-test-complete.sh`
- **API æµ‹è¯•è„šæœ¬ï¼š** `_bmad-output/test-reports/story-16-3-e2e-test-api-script.sh`

---

**åˆ›å»ºæ—¶é—´ï¼š** 2025-12-26

