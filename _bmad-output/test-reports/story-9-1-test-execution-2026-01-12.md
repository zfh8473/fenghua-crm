# Story 9-1 手动测试执行记录

**Story：** 数据访问审计日志  
**测试日期：** 2026-01-12  
**测试者：** [待填写]  
**测试环境：** 开发环境

---

## 📋 测试前准备

### ✅ 环境检查清单

- [ ] 数据库迁移已完成
  - [x] 迁移 014: 创建 audit_logs 表
  - [x] 迁移 028: 添加数据访问审计字段
  - [x] 迁移 029: 添加 entity_id 索引
- [ ] 后端服务正在运行（http://localhost:3001）
- [ ] 前端服务正在运行（http://localhost:3005）
- [ ] 已准备测试用户账号（管理员、普通用户）
- [ ] 已准备测试数据（客户、产品、互动记录）

---

## 🧪 测试用例执行

### TC1: 数据访问操作自动记录（成功访问）

**测试时间：** _______________

**测试步骤：**
1. [ ] 以管理员身份登录系统
2. [ ] 访问客户详情页：`/customers/:id`
3. [ ] 访问产品详情页：`/products/:id`
4. [ ] 访问互动记录详情页：`/interactions/:id`

**预期结果：**
- [ ] 每个访问操作都在审计日志中记录
- [ ] 操作类型为 `DATA_ACCESS`
- [ ] 资源类型正确（CUSTOMER、PRODUCT、INTERACTION）
- [ ] 操作结果为 `SUCCESS`
- [ ] 包含用户ID、IP地址、用户代理、时间戳

**实际结果：**
```
[记录实际测试结果]
```

**测试状态：** ⬜ 通过 / ⬜ 失败 / ⬜ 阻塞

**备注：**
```
[记录任何问题或观察]
```

---

### TC2: 无权限访问记录

**测试时间：** _______________

**测试步骤：**
1. [ ] 以前端专员或后端专员身份登录系统
2. [ ] 尝试访问供应商客户详情页（应该被权限系统阻止）

**预期结果：**
- [ ] 审计日志中记录失败的访问操作
- [ ] 操作类型为 `DATA_ACCESS`
- [ ] 操作结果为 `FAILED`
- [ ] 失败原因包含"Permission denied"或类似信息

**实际结果：**
```
[记录实际测试结果]
```

**测试状态：** ⬜ 通过 / ⬜ 失败 / ⬜ 阻塞

**备注：**
```
[记录任何问题或观察]
```

---

### TC3: 审计日志查询和筛选

**测试时间：** _______________

**测试步骤：**
1. [ ] 以管理员身份登录
2. [ ] 访问 `/audit-logs` 页面
3. [ ] 测试按操作类型筛选：`action = DATA_ACCESS`
4. [ ] 测试按资源类型筛选：`entityType = CUSTOMER`
5. [ ] 测试按用户筛选：输入操作者邮箱
6. [ ] 测试按时间范围筛选：选择开始和结束日期
7. [ ] 测试分页功能（如果记录数 > 50）

**预期结果：**
- [ ] 所有筛选功能正常工作
- [ ] 筛选结果准确
- [ ] 分页控件显示正确的页数和总数

**实际结果：**
```
[记录实际测试结果]
```

**测试状态：** ⬜ 通过 / ⬜ 失败 / ⬜ 阻塞

**备注：**
```
[记录任何问题或观察]
```

---

### TC4: 审计日志详情查看

**测试时间：** _______________

**测试步骤：**
1. [ ] 访问 `/audit-logs` 页面
2. [ ] 点击任意一条审计日志记录

**预期结果：**
- [ ] 弹出详情对话框
- [ ] 显示所有字段：
  - [ ] 操作类型（中文标签）
  - [ ] 操作结果（成功/失败）
  - [ ] 资源类型（中文标签）
  - [ ] 资源ID
  - [ ] 用户ID
  - [ ] 操作者邮箱
  - [ ] 操作时间（格式化显示）
  - [ ] IP地址（如果可用）
  - [ ] 用户代理（如果可用）
  - [ ] 失败原因（如果操作失败）

**实际结果：**
```
[记录实际测试结果]
```

**测试状态：** ⬜ 通过 / ⬜ 失败 / ⬜ 阻塞

**备注：**
```
[记录任何问题或观察]
```

---

### TC5: 审计日志导出

**测试时间：** _______________

**测试步骤：**
1. [ ] 访问 `/audit-logs` 页面
2. [ ] 应用筛选条件（可选）
3. [ ] 点击"导出 CSV"按钮
4. [ ] 点击"导出 Excel"按钮

**预期结果：**
- [ ] CSV 文件成功下载
- [ ] Excel 文件成功下载
- [ ] 导出的文件包含所有必要字段
- [ ] 导出的数据与当前筛选条件匹配

**实际结果：**
```
[记录实际测试结果]
```

**测试状态：** ⬜ 通过 / ⬜ 失败 / ⬜ 阻塞

**备注：**
```
[记录任何问题或观察]
```

---

### TC6: 性能测试

**测试时间：** _______________

**测试步骤：**
1. [ ] 访问 `/audit-logs` 页面
2. [ ] 记录页面加载时间
3. [ ] 应用筛选条件，记录响应时间
4. [ ] 切换分页，记录响应时间
5. [ ] 访问客户/产品/互动记录详情页，记录响应时间

**预期结果：**
- [ ] 页面加载时间 < 2 秒
- [ ] 筛选响应时间 < 2 秒
- [ ] 分页响应时间 < 1 秒
- [ ] 业务操作响应时间正常（不受审计日志记录影响）

**实际结果：**
```
页面加载时间：______ 秒
筛选响应时间：______ 秒
分页响应时间：______ 秒
业务操作响应时间：______ 秒
```

**测试状态：** ⬜ 通过 / ⬜ 失败 / ⬜ 阻塞

**备注：**
```
[记录任何问题或观察]
```

---

### TC7: 错误处理

**测试时间：** _______________

**测试步骤：**
1. [ ] 访问 `/audit-logs` 页面（正常情况）
2. [ ] 尝试导出审计日志
3. [ ] 检查系统日志（如果有错误）

**预期结果：**
- [ ] 审计日志记录失败不影响主业务
- [ ] 前端显示友好的错误消息
- [ ] 错误信息记录到系统日志

**实际结果：**
```
[记录实际测试结果]
```

**测试状态：** ⬜ 通过 / ⬜ 失败 / ⬜ 阻塞

**备注：**
```
[记录任何问题或观察]
```

---

## 📊 测试结果总结

| 测试用例 | 状态 | 备注 |
|---------|------|------|
| TC1: 数据访问操作自动记录（成功） | ⬜ 通过 / ⬜ 失败 | |
| TC2: 无权限访问记录 | ⬜ 通过 / ⬜ 失败 | |
| TC3: 审计日志查询和筛选 | ⬜ 通过 / ⬜ 失败 | |
| TC4: 审计日志详情查看 | ⬜ 通过 / ⬜ 失败 | |
| TC5: 审计日志导出 | ⬜ 通过 / ⬜ 失败 | |
| TC6: 性能测试 | ⬜ 通过 / ⬜ 失败 | |
| TC7: 错误处理 | ⬜ 通过 / ⬜ 失败 | |

**通过率：** ___ / 7 (___%)

---

## 🐛 已知问题

[记录测试过程中发现的任何问题]

---

## ✅ 测试结论

**总体评估：** ⬜ 通过 / ⬜ 失败 / ⬜ 需要修复

**建议：**
```
[记录测试建议或下一步行动]
```

---

## 📝 测试人员签名

**测试人员：** _________________  
**日期：** _________________
