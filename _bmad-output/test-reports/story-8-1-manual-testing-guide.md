# Story 8.1: 业务仪表板概览 - 手动测试指南

**Story ID:** 8-1-business-dashboard-overview  
**测试日期:** 2026-01-11  
**测试人员:** [填写测试人员姓名]

## 测试环境

- **前端 URL:** http://localhost:3005 (或实际部署地址)
- **后端 URL:** http://localhost:3001 (或实际部署地址)
- **浏览器:** Chrome/Firefox/Safari (最新版本)
- **测试账号:**
  - 管理员账号: [填写管理员邮箱和密码]
  - 总监账号: [填写总监邮箱和密码]
  - 普通用户账号: [填写普通用户邮箱和密码]

## 测试前准备

1. ✅ 确保后端服务正在运行
2. ✅ 确保前端服务正在运行
3. ✅ 确保数据库连接正常
4. ✅ 确保 Redis 服务可用（可选，用于缓存测试）
5. ✅ 准备测试数据（客户、产品、互动记录）

---

## 测试用例 1: 仪表板加载速度测试 (AC2)

### 测试步骤

1. 使用管理员或总监账号登录系统
2. 打开浏览器开发者工具 (F12)
3. 切换到 **Network** 标签页
4. 清除网络请求记录
5. 点击侧边栏中的 **"业务仪表板"** 菜单项
6. 记录从点击到页面完全加载的时间

### 预期结果

- ✅ 页面应在 **3 秒内**完全加载并显示数据
- ✅ 显示骨架屏加载状态（Skeleton Loading）
- ✅ 关键指标卡片正确显示
- ✅ 图表正确渲染

### 实际结果

- 加载时间: _____ 秒
- 是否通过: [ ] 是 [ ] 否
- 备注: _________________________________

---

## 测试用例 2: 数据实时更新测试 (AC1)

### 测试步骤

1. 登录系统并访问业务仪表板
2. 记录当前显示的关键指标数值：
   - 客户总数: _____
   - 本月新增客户: _____
   - 本月新增互动: _____
3. 等待 **5 分钟**（或手动触发刷新）
4. 观察页面是否自动刷新数据
5. 检查数据是否更新（如果有新数据）

### 预期结果

- ✅ 数据每 5 分钟自动刷新一次
- ✅ 刷新时显示"数据可能不是最新的，正在刷新..."提示（如果有缓存数据）
- ✅ 页面不可见时停止轮询（切换到其他标签页后返回）

### 实际结果

- 自动刷新是否工作: [ ] 是 [ ] 否
- 刷新间隔是否正确: [ ] 是 [ ] 否
- 后台轮询是否停止: [ ] 是 [ ] 否
- 备注: _________________________________

---

## 测试用例 3: 响应式设计测试 (AC4)

### 测试步骤

1. 访问业务仪表板页面
2. 使用浏览器开发者工具调整视口大小：
   - **桌面 (1920x1080)**
   - **平板 (768x1024)**
   - **手机 (375x667)**
3. 检查以下内容：
   - 指标卡片布局是否适配
   - 图表是否响应式调整
   - 文字是否可读
   - 导航菜单是否正常显示

### 预期结果

- ✅ 桌面视图：4 列指标卡片布局
- ✅ 平板视图：2 列指标卡片布局
- ✅ 手机视图：1 列指标卡片布局
- ✅ 图表在不同尺寸下正确显示
- ✅ 所有文字清晰可读

### 实际结果

- 桌面视图: [ ] 通过 [ ] 失败
- 平板视图: [ ] 通过 [ ] 失败
- 手机视图: [ ] 通过 [ ] 失败
- 备注: _________________________________

---

## 测试用例 4: 关键指标显示测试 (AC3)

### 测试步骤

1. 访问业务仪表板
2. 检查所有关键指标卡片是否正确显示：
   - 客户总数
   - 采购商数量
   - 供应商数量
   - 产品总数
   - 互动记录总数
   - 本月新增客户数
   - 本月新增互动记录数
3. 验证数值是否正确（与数据库实际数据对比）

### 预期结果

- ✅ 所有 7 个指标卡片都显示
- ✅ 数值格式正确（使用千位分隔符）
- ✅ 数值与数据库实际数据一致
- ✅ 图标正确显示

### 实际结果

- 指标显示完整性: [ ] 通过 [ ] 失败
- 数值准确性: [ ] 通过 [ ] 失败
- 备注: _________________________________

---

## 测试用例 5: 图表可视化测试 (AC4)

### 测试步骤

1. 访问业务仪表板
2. 检查图表显示：
   - **本月新增趋势图**（折线图）
   - **客户类型分布图**（饼图）
3. 测试图表交互：
   - 鼠标悬停在图表上
   - 检查工具提示（Tooltip）是否显示
   - 检查图例是否可点击

### 预期结果

- ✅ 折线图正确显示本月新增客户和互动的趋势
- ✅ 饼图正确显示采购商和供应商的分布
- ✅ 鼠标悬停时显示详细数据
- ✅ 图表响应式设计，适配不同屏幕

### 实际结果

- 图表渲染: [ ] 通过 [ ] 失败
- 交互功能: [ ] 通过 [ ] 失败
- 响应式设计: [ ] 通过 [ ] 失败
- 备注: _________________________________

---

## 测试用例 6: 错误场景测试 (AC2)

### 6.1 API 失败测试

#### 测试步骤

1. 停止后端服务（或断开网络）
2. 访问业务仪表板
3. 观察错误处理

#### 预期结果

- ✅ 显示友好的错误消息
- ✅ 提供"重试"按钮
- ✅ 错误消息清晰易懂

#### 实际结果

- 错误处理: [ ] 通过 [ ] 失败
- 备注: _________________________________

### 6.2 网络错误测试

#### 测试步骤

1. 打开浏览器开发者工具
2. 切换到 **Network** 标签页
3. 选择 **Offline** 模式
4. 访问业务仪表板或刷新页面

#### 预期结果

- ✅ 显示网络错误提示
- ✅ 提供重试选项

#### 实际结果

- 网络错误处理: [ ] 通过 [ ] 失败
- 备注: _________________________________

### 6.3 权限错误测试

#### 测试步骤

1. 使用**普通用户**账号（非管理员/总监）登录
2. 尝试直接访问 `/dashboard` 路由
3. 观察页面显示

#### 预期结果

- ✅ 显示"只有总监和管理员可以访问此页面"提示
- ✅ 或自动重定向到首页

#### 实际结果

- 权限控制: [ ] 通过 [ ] 失败
- 备注: _________________________________

---

## 测试用例 7: 角色访问控制测试

### 测试步骤

1. 使用**管理员**账号登录
2. 检查侧边栏是否显示"业务仪表板"菜单项
3. 访问仪表板，验证可以正常查看
4. 登出，使用**总监**账号登录
5. 重复步骤 2-3
6. 登出，使用**普通用户**账号登录
7. 检查侧边栏是否**不显示**"业务仪表板"菜单项

### 预期结果

- ✅ 管理员可以看到并访问仪表板
- ✅ 总监可以看到并访问仪表板
- ✅ 普通用户**不能**看到仪表板菜单项
- ✅ 普通用户直接访问路由时被拒绝

### 实际结果

- 管理员访问: [ ] 通过 [ ] 失败
- 总监访问: [ ] 通过 [ ] 失败
- 普通用户限制: [ ] 通过 [ ] 失败
- 备注: _________________________________

---

## 测试用例 8: 性能优化测试

### 8.1 数据库索引测试

#### 测试步骤

1. 确认迁移文件 `021-add-dashboard-performance-indexes.sql` 已执行
2. 在数据库中检查索引是否存在：
   ```sql
   SELECT indexname FROM pg_indexes 
   WHERE tablename = 'companies' AND indexname = 'idx_companies_created_at';
   ```
3. 使用 `EXPLAIN ANALYZE` 检查查询性能

#### 预期结果

- ✅ 索引已创建
- ✅ 查询使用索引（在 EXPLAIN 结果中看到 Index Scan）

#### 实际结果

- 索引存在: [ ] 是 [ ] 否
- 查询性能: _____ 毫秒
- 备注: _________________________________

### 8.2 缓存测试（如果 Redis 可用）

#### 测试步骤

1. 确保 Redis 服务运行
2. 访问仪表板，记录首次加载时间
3. 刷新页面，记录第二次加载时间
4. 检查后端日志，确认使用了缓存

#### 预期结果

- ✅ 第二次加载明显快于首次（如果使用缓存）
- ✅ 后端日志显示"Returning cached dashboard overview"

#### 实际结果

- 首次加载: _____ 毫秒
- 缓存加载: _____ 毫秒
- 缓存是否工作: [ ] 是 [ ] 否
- 备注: _________________________________

### 8.3 图表懒加载测试

#### 测试步骤

1. 打开浏览器开发者工具
2. 切换到 **Network** 标签页
3. 清除网络请求
4. 访问仪表板
5. 观察图表组件是否延迟加载

#### 预期结果

- ✅ 图表组件使用懒加载（React.lazy）
- ✅ 初始加载时显示骨架屏
- ✅ 图表组件按需加载

#### 实际结果

- 懒加载是否工作: [ ] 是 [ ] 否
- 备注: _________________________________

---

## 测试用例 9: 数据预加载测试

### 测试步骤

1. 使用管理员或总监账号登录
2. 访问首页（非仪表板页面）
3. 打开浏览器开发者工具，切换到 **Network** 标签页
4. 等待 1-2 秒
5. 观察是否有对 `/api/dashboard/overview` 的预加载请求
6. 点击"业务仪表板"菜单项
7. 观察页面是否立即显示数据（使用预加载的缓存）

### 预期结果

- ✅ 在非仪表板页面时，后台预加载仪表板数据
- ✅ 点击仪表板菜单时，数据立即显示（从缓存）

### 实际结果

- 预加载是否工作: [ ] 是 [ ] 否
- 缓存是否生效: [ ] 是 [ ] 否
- 备注: _________________________________

---

## 测试用例 10: 错误边界测试

### 测试步骤

1. 访问业务仪表板
2. 打开浏览器开发者工具
3. 在控制台中手动触发错误（例如：`throw new Error('Test error')`）
4. 或修改图表组件代码使其抛出错误
5. 观察错误边界是否捕获错误

### 预期结果

- ✅ 错误边界捕获错误
- ✅ 显示友好的错误提示
- ✅ 提供"重试"按钮
- ✅ 开发环境下显示错误详情

### 实际结果

- 错误边界是否工作: [ ] 是 [ ] 否
- 备注: _________________________________

---

## 测试用例 11: 空数据处理测试

### 测试步骤

1. 创建一个测试环境，其中：
   - 没有客户数据
   - 没有产品数据
   - 没有互动记录
2. 访问业务仪表板
3. 观察图表显示

### 预期结果

- ✅ 图表显示"暂无数据"提示
- ✅ 不会出现错误或崩溃
- ✅ 指标卡片显示 0

### 实际结果

- 空数据处理: [ ] 通过 [ ] 失败
- 备注: _________________________________

---

## 测试总结

### 测试统计

- **总测试用例数:** 11
- **通过数:** _____
- **失败数:** _____
- **阻塞问题数:** _____

### 发现的问题

| 问题编号 | 严重程度 | 问题描述 | 复现步骤 | 状态 |
|---------|---------|---------|---------|------|
| 1 | | | | |
| 2 | | | | |
| 3 | | | | |

### 测试结论

- [ ] **通过** - 所有测试用例通过，可以发布
- [ ] **有条件通过** - 有轻微问题，但不影响主要功能
- [ ] **不通过** - 存在严重问题，需要修复

### 测试人员签名

**测试人员:** _________________  
**日期:** _________________  
**备注:** _________________________________

---

## 附录

### 性能基准

- **目标加载时间:** < 3 秒
- **实际平均加载时间:** _____ 秒
- **数据库查询时间:** _____ 毫秒
- **API 响应时间:** _____ 毫秒

### 浏览器兼容性

- [ ] Chrome (最新版本)
- [ ] Firefox (最新版本)
- [ ] Safari (最新版本)
- [ ] Edge (最新版本)

### 已知问题

1. 图表数据目前使用示例数据（基于本月总数估算），真实历史数据功能待开发
2. _________________________________
3. _________________________________

