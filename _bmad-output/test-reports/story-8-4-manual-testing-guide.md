# Story 8.4: 供应商分析 - 手动测试指南

**Story:** 8-4-supplier-analysis  
**测试日期:** 2026-01-12  
**测试人员:** QA Team

---

## 测试环境准备

### 前置条件

1. **用户角色要求:**
   - 至少需要一个 `ADMIN` 或 `DIRECTOR` 角色的用户账号
   - 至少需要一个非 `ADMIN`/`DIRECTOR` 角色的用户账号（用于权限测试）

2. **测试数据要求:**
   - 系统中应存在供应商数据（`companies` 表，`customer_type = 'SUPPLIER'`）
   - 系统中应存在产品-客户互动记录（`product_customer_interactions` 表）
   - 至少有一些互动记录的 `interaction_type` 为 `order_signed` 或 `order_completed`
   - 至少有一些互动记录的 `additional_info` JSONB 字段包含 `orderAmount` 或 `amount` 字段
   - 至少有一些产品数据（`products` 表），包含 `category` 字段

3. **系统要求:**
   - 后端服务运行在 `http://localhost:3001`（或配置的端口）
   - 前端应用运行在 `http://localhost:5173`（或配置的端口）
   - 数据库连接正常
   - Redis 连接正常（可选，用于缓存测试）

---

## 测试用例

### TC1: 访问权限验证

**目标:** 验证只有 `ADMIN` 和 `DIRECTOR` 角色可以访问供应商分析页面

**步骤:**
1. 使用非 `ADMIN`/`DIRECTOR` 角色的用户登录系统
2. 尝试直接访问 `/dashboard/supplier-analysis` URL
3. 观察页面显示

**预期结果:**
- 页面显示"只有总监和管理员可以访问此页面"的错误提示
- 非授权用户无法查看供应商分析数据

**实际结果:** [ ] 通过 / [ ] 失败

**备注:** 

---

### TC2: 供应商分析数据基础显示

**目标:** 验证供应商分析数据能够正确显示

**步骤:**
1. 使用 `ADMIN` 或 `DIRECTOR` 角色用户登录系统
2. 导航到"供应商分析"页面（通过侧边栏菜单或直接访问 `/dashboard/supplier-analysis`）
3. 等待页面加载完成
4. 观察页面显示的内容

**预期结果:**
- 页面标题显示为"供应商分析"
- 显示筛选条件区域（产品类别、开始日期、结束日期）
- 显示供应商合作频率趋势图
- 显示供应商分析表格，包含以下列：
  - 供应商名称（可点击跳转到供应商详情页）
  - 订单量
  - 订单金额（高价值供应商用绿色高亮显示）
  - 合作频率（单/天）
  - 最后合作日期
  - 距离最后合作天数
  - 合作稳定性（高/中/低/风险，使用颜色编码）
  - 生命周期价值
- 表格数据按订单金额降序排列（高价值供应商在前）

**实际结果:** [ ] 通过 / [ ] 失败

**备注:** 

---

### TC3: 产品类别筛选

**目标:** 验证按产品类别筛选功能

**步骤:**
1. 在供应商分析页面，在"产品类别"输入框中输入一个存在的产品类别名称
2. 观察表格数据变化
3. 清除产品类别筛选
4. 观察表格数据恢复

**预期结果:**
- 输入产品类别后，表格只显示与该类别产品相关的供应商
- 清除筛选后，表格显示所有供应商

**实际结果:** [ ] 通过 / [ ] 失败

**备注:** 

---

### TC4: 时间范围筛选

**目标:** 验证按时间范围筛选功能

**步骤:**
1. 在供应商分析页面，选择"开始日期"和"结束日期"
2. 选择一个时间范围（如最近3个月）
3. 观察表格数据变化
4. 清除日期筛选
5. 观察表格数据恢复

**预期结果:**
- 选择时间范围后，表格只显示在该时间范围内有合作的供应商
- 合作频率计算基于选择的时间范围
- 清除筛选后，表格显示所有供应商（默认使用最近12个月）

**实际结果:** [ ] 通过 / [ ] 失败

**备注:** 

---

### TC5: 合作稳定性评级计算

**目标:** 验证合作稳定性评级计算正确

**步骤:**
1. 查看供应商分析表格中的"合作稳定性"列
2. 验证以下情况：
   - 最近30天内有合作且合作频率 >= 0.1 单/天 → 显示"高"（绿色）
   - 最近60天内有合作（但不符合"高"条件）→ 显示"中"（蓝色）
   - 最近90天内有合作（但不符合"中"条件）→ 显示"低"（黄色）
   - 超过90天无合作 → 显示"风险"（红色）

**预期结果:**
- 稳定性评级计算正确
- 颜色编码正确显示

**实际结果:** [ ] 通过 / [ ] 失败

**备注:** 

---

### TC6: 合作频率计算

**目标:** 验证合作频率计算正确

**步骤:**
1. 查看供应商分析表格中的"合作频率"列
2. 验证以下情况：
   - 如果供应商有多个订单（> 1），合作频率 = (订单数 - 1) / (最后订单日期 - 第一订单日期) 天
   - 如果供应商只有1个订单或未指定时间范围，合作频率 = 订单数 / 时间范围天数

**预期结果:**
- 合作频率计算正确
- 显示格式为"X.XXXX 单/天"

**实际结果:** [ ] 通过 / [ ] 失败

**备注:** 

---

### TC7: 供应商合作趋势图

**目标:** 验证供应商合作趋势图正确显示

**步骤:**
1. 在供应商分析页面，查看"供应商合作频率趋势"图表
2. 观察图表显示
3. 修改时间范围筛选
4. 观察图表数据更新

**预期结果:**
- 图表正确显示供应商合作频率趋势
- 图表按时间（周或月）分组显示
- 如果时间范围 <= 90 天，使用周分组；否则使用月分组
- 图表数据随筛选条件更新

**实际结果:** [ ] 通过 / [ ] 失败

**备注:** 

---

### TC8: 分页功能

**目标:** 验证分页功能正常工作

**步骤:**
1. 在供应商分析页面，如果数据超过20条，观察分页控件
2. 点击"下一页"按钮
3. 观察表格数据变化
4. 点击"上一页"按钮
5. 观察表格数据恢复

**预期结果:**
- 如果数据超过20条，显示分页控件
- 分页控件显示当前页码和总页数
- 点击"下一页"后，显示下一页数据
- 点击"上一页"后，显示上一页数据
- 在第一页时，"上一页"按钮禁用
- 在最后一页时，"下一页"按钮禁用

**实际结果:** [ ] 通过 / [ ] 失败

**备注:** 

---

### TC9: 供应商名称跳转

**目标:** 验证点击供应商名称可以跳转到供应商详情页

**步骤:**
1. 在供应商分析表格中，点击一个供应商名称
2. 观察页面跳转

**预期结果:**
- 点击供应商名称后，页面跳转到 `/customers/{supplierId}` 详情页
- 供应商详情页正确显示该供应商的信息

**实际结果:** [ ] 通过 / [ ] 失败

**备注:** 

---

### TC10: 导出功能

**目标:** 验证导出功能正常工作

**步骤:**
1. 在供应商分析页面，点击"导出 CSV"按钮
2. 等待导出完成
3. 检查下载的CSV文件

**预期结果:**
- 点击"导出 CSV"后，按钮显示"导出中..."状态
- 导出完成后，自动下载CSV文件
- CSV文件名格式为：`供应商分析_YYYY-MM-DD.csv`
- CSV文件包含所有筛选后的供应商分析数据
- CSV文件包含以下列：
  - 供应商ID
  - 供应商名称
  - 订单量
  - 订单金额
  - 合作频率
  - 最后合作日期
  - 距离最后合作天数
  - 合作稳定性
  - 生命周期价值

**实际结果:** [ ] 通过 / [ ] 失败

**备注:** 

---

### TC11: 导出数据量限制

**目标:** 验证导出数据量限制功能

**步骤:**
1. 设置筛选条件，使数据量超过50000条（如果可能）
2. 点击"导出 CSV"按钮
3. 观察错误提示

**预期结果:**
- 如果数据量超过50000条，显示错误提示："导出数据量过大（X 条），请使用筛选条件缩小范围，或联系管理员使用异步导出功能"
- 导出操作被阻止

**实际结果:** [ ] 通过 / [ ] 失败

**备注:** 

---

### TC12: 加载状态和错误处理

**目标:** 验证加载状态和错误处理

**步骤:**
1. 在供应商分析页面，观察页面加载过程
2. 如果发生错误（如网络错误、权限错误），观察错误提示

**预期结果:**
- 页面加载时，显示骨架屏加载效果
- 如果发生网络错误，显示错误提示和"重试"按钮
- 如果发生权限错误，显示"您没有权限查看供应商分析"错误提示
- 点击"重试"按钮后，重新加载数据

**实际结果:** [ ] 通过 / [ ] 失败

**备注:** 

---

### TC13: 清除筛选功能

**目标:** 验证清除筛选功能

**步骤:**
1. 在供应商分析页面，设置多个筛选条件（产品类别、开始日期、结束日期）
2. 点击"清除筛选"按钮
3. 观察筛选条件和表格数据

**预期结果:**
- 点击"清除筛选"后，所有筛选条件被清除
- 表格数据恢复为默认状态（显示所有供应商，使用最近12个月的时间范围）

**实际结果:** [ ] 通过 / [ ] 失败

**备注:** 

---

### TC14: 导航菜单项

**目标:** 验证导航菜单项正确显示

**步骤:**
1. 使用 `ADMIN` 或 `DIRECTOR` 角色用户登录系统
2. 查看侧边栏导航菜单
3. 观察"供应商分析"菜单项

**预期结果:**
- 侧边栏导航菜单中显示"供应商分析"菜单项（图标：🏭）
- 只有 `ADMIN` 和 `DIRECTOR` 角色可以看到此菜单项
- 点击菜单项后，跳转到供应商分析页面

**实际结果:** [ ] 通过 / [ ] 失败

**备注:** 

---

## 性能测试

### PT1: 大数据量处理

**目标:** 验证系统能够处理大量供应商数据

**步骤:**
1. 准备大量供应商数据（> 1000 条）
2. 访问供应商分析页面
3. 观察页面加载时间和响应速度

**预期结果:**
- 页面加载时间 < 3 秒
- 分页功能正常工作
- 筛选和排序功能响应迅速

**实际结果:** [ ] 通过 / [ ] 失败

**备注:** 

---

### PT2: 缓存功能

**目标:** 验证Redis缓存功能（如果Redis可用）

**步骤:**
1. 访问供应商分析页面，等待数据加载完成
2. 刷新页面
3. 观察数据加载速度

**预期结果:**
- 如果Redis可用，第二次加载应该更快（从缓存读取）
- 缓存过期时间为5分钟

**实际结果:** [ ] 通过 / [ ] 失败

**备注:** 

---

## 测试总结

**测试日期:** 2026-01-12  
**测试人员:** [填写测试人员姓名]  
**总测试用例数:** 14  
**通过数:** [ ]  
**失败数:** [ ]  
**阻塞数:** [ ]  

**总体评估:** [ ] 通过 / [ ] 失败

**主要问题:**
1. 
2. 
3. 

**备注:**

