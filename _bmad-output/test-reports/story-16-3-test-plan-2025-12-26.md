# Story 16.3 测试计划

**Story:** 16.3 - 替换用户和角色管理  
**测试日期：** 2025-12-26  
**测试范围：** 用户和角色管理功能

---

## 📋 测试概述

本测试计划涵盖 Story 16.3 实现的所有用户和角色管理功能，包括：
- 用户 CRUD 操作
- 角色管理操作
- API 端点验证
- 前端功能验证

---

## 🧪 测试用例

### 1. 用户列表查询测试

#### 1.1 获取所有用户
- **测试步骤：**
  1. 使用管理员账户登录
  2. 访问用户管理页面
  3. 查看用户列表
- **预期结果：**
  - 显示所有用户（未删除的用户）
  - 每个用户显示：邮箱、姓名、角色、创建时间
  - 角色显示正确（包括 null 角色的处理）

#### 1.2 按角色筛选用户
- **测试步骤：**
  1. 在用户管理页面添加角色筛选功能（如果已实现）
  2. 选择特定角色（如 ADMIN）
  3. 查看筛选结果
- **预期结果：**
  - 只显示具有选定角色的用户
  - 筛选功能正常工作

#### 1.3 搜索用户
- **测试步骤：**
  1. 在用户管理页面添加搜索功能（如果已实现）
  2. 输入搜索关键词（邮箱或姓名）
  3. 查看搜索结果
- **预期结果：**
  - 显示匹配的用户
  - 搜索功能正常工作

### 2. 用户创建测试

#### 2.1 创建新用户（有效数据）
- **测试步骤：**
  1. 点击"创建新用户"按钮
  2. 填写表单：
     - 邮箱：`test-user-${Date.now()}@example.com`
     - 密码：`test123456`
     - 姓名：`测试` `用户`
     - 角色：`FRONTEND_SPECIALIST`
  3. 提交表单
- **预期结果：**
  - 用户创建成功
  - 显示成功消息
  - 用户出现在用户列表中
  - 用户具有正确的角色

#### 2.2 创建用户（重复邮箱）
- **测试步骤：**
  1. 尝试使用已存在的邮箱创建用户
  2. 提交表单
- **预期结果：**
  - 显示错误消息："User with email ... already exists"
  - 用户未创建

#### 2.3 创建用户（无效密码）
- **测试步骤：**
  1. 尝试使用少于 6 个字符的密码创建用户
  2. 提交表单
- **预期结果：**
  - 显示验证错误
  - 用户未创建

### 3. 用户更新测试

#### 3.1 更新用户信息
- **测试步骤：**
  1. 选择一个用户，点击"编辑"
  2. 修改姓名和角色
  3. 提交表单
- **预期结果：**
  - 用户信息更新成功
   - 显示成功消息
   - 用户列表中的信息已更新
   - 角色已更新

#### 3.2 更新用户角色
- **测试步骤：**
  1. 选择一个用户，点击"编辑"
  2. 修改角色（如从 `FRONTEND_SPECIALIST` 改为 `ADMIN`）
  3. 提交表单
- **预期结果：**
  - 角色更新成功
  - 用户列表中的角色已更新
  - 审计日志记录角色变更

#### 3.3 更新用户（不修改密码）
- **测试步骤：**
  1. 选择一个用户，点击"编辑"
  2. 修改姓名，密码字段留空
  3. 提交表单
- **预期结果：**
  - 用户信息更新成功
  - 密码未修改

### 4. 用户删除测试

#### 4.1 软删除用户
- **测试步骤：**
  1. 选择一个用户（不是当前登录用户）
  2. 点击"删除"按钮
  3. 确认删除
- **预期结果：**
  - 用户被软删除（`deleted_at` 字段已设置）
  - 用户从列表中消失
  - 显示成功消息

#### 4.2 尝试删除自己
- **测试步骤：**
  1. 尝试删除当前登录的用户
  2. 点击"删除"按钮
- **预期结果：**
  - 显示错误消息："不能删除自己的账户"
  - 用户未被删除
  - 删除按钮被禁用

### 5. 角色列表查询测试

#### 5.1 获取所有角色
- **测试步骤：**
  1. 调用 `getAllRoles()` API（如果前端有使用）
  2. 或通过后端 API 直接测试：`GET /roles`
- **预期结果：**
  - 返回所有角色列表
  - 包含：ADMIN, DIRECTOR, FRONTEND_SPECIALIST, BACKEND_SPECIALIST
  - 每个角色包含 id, name, description

### 6. 角色分配测试

#### 6.1 分配角色给用户
- **测试步骤：**
  1. 选择一个没有角色的用户（或选择一个用户）
  2. 编辑用户，分配角色（如 `ADMIN`）
  3. 提交表单
- **预期结果：**
  - 角色分配成功
  - 用户具有新角色
  - 审计日志记录角色变更

#### 6.2 更换用户角色
- **测试步骤：**
  1. 选择一个已有角色的用户
  2. 编辑用户，更换角色（如从 `FRONTEND_SPECIALIST` 改为 `BACKEND_SPECIALIST`）
  3. 提交表单
- **预期结果：**
  - 旧角色被移除
  - 新角色被分配
  - 用户只有一个角色（最新分配的角色）

### 7. 角色移除测试

#### 7.1 移除用户角色
- **测试步骤：**
  1. 调用 `removeRole()` API（如果前端有使用）
  2. 或通过后端 API 直接测试：`PUT /roles/users/:userId/remove`
- **预期结果：**
  - 用户角色被移除
  - 用户不再有角色（`role` 为 `null`）
  - 审计日志记录角色移除

---

## 🔧 测试工具和方法

### 后端 API 测试

可以使用以下工具进行 API 测试：
- **Postman** 或 **curl** - 直接测试 API 端点
- **supertest** - 集成测试（如果已实现）

### 前端功能测试

- **浏览器手动测试** - 访问用户管理页面，执行操作
- **浏览器开发者工具** - 检查网络请求和响应

### 数据库验证

- **直接查询数据库** - 验证数据是否正确存储
- **检查审计日志** - 验证角色变更是否记录

---

## 📝 测试执行记录

测试执行记录将在实际测试时填写。

---

## ✅ 测试通过标准

- 所有测试用例通过
- 无功能缺陷
- 无性能问题
- 用户体验良好

---

**创建时间：** 2025-12-26

