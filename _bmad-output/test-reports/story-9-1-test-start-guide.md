# Story 9-1 æµ‹è¯•å¯åŠ¨æŒ‡å—

**Storyï¼š** æ•°æ®è®¿é—®å®¡è®¡æ—¥å¿—  
**æ—¥æœŸï¼š** 2026-01-12

---

## âœ… æµ‹è¯•ç¯å¢ƒå‡†å¤‡å®Œæˆ

### æ•°æ®åº“è¿ç§»çŠ¶æ€
- âœ… è¿ç§» 014: åˆ›å»º audit_logs è¡¨ - **å·²å®Œæˆ**
- âœ… è¿ç§» 028: æ·»åŠ æ•°æ®è®¿é—®å®¡è®¡å­—æ®µ - **å·²å®Œæˆ**
- âœ… è¿ç§» 029: æ·»åŠ  entity_id ç´¢å¼• - **å·²å®Œæˆ**

### ä»£ç å®ç°çŠ¶æ€
- âœ… åç«¯æ‹¦æˆªå™¨å·²å®ç°å¹¶åº”ç”¨
- âœ… åç«¯æœåŠ¡å·²å®ç°
- âœ… å‰ç«¯é¡µé¢å·²å®ç°
- âœ… è®¾è®¡ Token å·²ç»Ÿä¸€

---

## ğŸš€ å¯åŠ¨æœåŠ¡è¿›è¡Œæµ‹è¯•

### æ­¥éª¤ 1: å¯åŠ¨åç«¯æœåŠ¡

**æ‰“å¼€ç»ˆç«¯ 1ï¼š**
```bash
cd /Users/travis_z/Documents/GitHub/fenghua-crm/fenghua-backend
npm run start:dev
```

**ç­‰å¾…åç«¯å¯åŠ¨å®Œæˆï¼š**
- åº”è¯¥çœ‹åˆ°ï¼š`Nest application successfully started`
- æœåŠ¡è¿è¡Œåœ¨ï¼šhttp://localhost:3001

**éªŒè¯åç«¯ï¼š**
```bash
curl http://localhost:3001/api/health
```

---

### æ­¥éª¤ 2: å¯åŠ¨å‰ç«¯æœåŠ¡

**æ‰“å¼€ç»ˆç«¯ 2ï¼š**
```bash
cd /Users/travis_z/Documents/GitHub/fenghua-crm/fenghua-frontend
npm run dev
```

**ç­‰å¾…å‰ç«¯å¯åŠ¨å®Œæˆï¼š**
- åº”è¯¥çœ‹åˆ°ï¼š`Local: http://localhost:3005`
- æœåŠ¡è¿è¡Œåœ¨ï¼šhttp://localhost:3005

---

## ğŸ§ª å¼€å§‹æµ‹è¯•

### æµ‹è¯•æµç¨‹

1. **è®¿é—®å‰ç«¯åº”ç”¨**
   - æ‰“å¼€æµè§ˆå™¨ï¼šhttp://localhost:3005
   - ä½¿ç”¨ç®¡ç†å‘˜è´¦å·ç™»å½•

2. **ç”Ÿæˆå®¡è®¡æ—¥å¿—æ•°æ®**
   - è®¿é—®å®¢æˆ·è¯¦æƒ…é¡µï¼ˆç”Ÿæˆä¸€æ¡å®¡è®¡æ—¥å¿—ï¼‰
   - è®¿é—®äº§å“è¯¦æƒ…é¡µï¼ˆç”Ÿæˆä¸€æ¡å®¡è®¡æ—¥å¿—ï¼‰
   - è®¿é—®äº’åŠ¨è®°å½•è¯¦æƒ…é¡µï¼ˆç”Ÿæˆä¸€æ¡å®¡è®¡æ—¥å¿—ï¼‰

3. **æŸ¥çœ‹å®¡è®¡æ—¥å¿—**
   - è®¿é—®ï¼šhttp://localhost:3005/audit-logs
   - éªŒè¯åˆšæ‰çš„æ“ä½œæ˜¯å¦è¢«è®°å½•

4. **æµ‹è¯•ç­›é€‰åŠŸèƒ½**
   - æŒ‰æ“ä½œç±»å‹ç­›é€‰ï¼š`DATA_ACCESS`
   - æŒ‰èµ„æºç±»å‹ç­›é€‰ï¼š`CUSTOMER`ã€`PRODUCT`ã€`INTERACTION`
   - æŒ‰æ—¶é—´èŒƒå›´ç­›é€‰

5. **æµ‹è¯•è¯¦æƒ…æŸ¥çœ‹**
   - ç‚¹å‡»ä»»æ„ä¸€æ¡å®¡è®¡æ—¥å¿—è®°å½•
   - éªŒè¯è¯¦æƒ…å¯¹è¯æ¡†æ˜¾ç¤ºå®Œæ•´ä¿¡æ¯

6. **æµ‹è¯•å¯¼å‡ºåŠŸèƒ½**
   - ç‚¹å‡»"å¯¼å‡º CSV"æŒ‰é’®
   - ç‚¹å‡»"å¯¼å‡º Excel"æŒ‰é’®

---

## ğŸ“‹ æµ‹è¯•æ£€æŸ¥æ¸…å•

### åŠŸèƒ½æµ‹è¯•
- [ ] TC1: æ•°æ®è®¿é—®æ“ä½œè‡ªåŠ¨è®°å½•ï¼ˆæˆåŠŸè®¿é—®ï¼‰
- [ ] TC2: æ— æƒé™è®¿é—®è®°å½•
- [ ] TC3: å®¡è®¡æ—¥å¿—æŸ¥è¯¢å’Œç­›é€‰
- [ ] TC4: å®¡è®¡æ—¥å¿—è¯¦æƒ…æŸ¥çœ‹
- [ ] TC5: å®¡è®¡æ—¥å¿—å¯¼å‡º
- [ ] TC6: æ€§èƒ½æµ‹è¯•
- [ ] TC7: é”™è¯¯å¤„ç†

### éªŒè¯ç‚¹
- [ ] å®¡è®¡æ—¥å¿—è‡ªåŠ¨è®°å½•
- [ ] ç­›é€‰åŠŸèƒ½æ­£å¸¸
- [ ] åˆ†é¡µåŠŸèƒ½æ­£å¸¸
- [ ] è¯¦æƒ…æŸ¥çœ‹æ­£å¸¸
- [ ] å¯¼å‡ºåŠŸèƒ½æ­£å¸¸
- [ ] æ€§èƒ½è¡¨ç°è‰¯å¥½

---

## ğŸ” éªŒè¯æ•°æ®åº“è®°å½•

**æŸ¥è¯¢æœ€è¿‘çš„å®¡è®¡æ—¥å¿—ï¼š**
```bash
psql "postgresql://neondb_owner:npg_9EkbDI3AiLGT@ep-calm-glade-ahzfobn1-pooler.c-3.us-east-1.aws.neon.tech/fenghua-crm-dev?sslmode=require&channel_binding=require" -c "SELECT action, entity_type, entity_id, (metadata->>'operationResult') as operation_result, user_id, ip_address, timestamp FROM audit_logs WHERE action = 'DATA_ACCESS' ORDER BY timestamp DESC LIMIT 5;"
```

**éªŒè¯ç´¢å¼•ï¼š**
```bash
psql "postgresql://neondb_owner:npg_9EkbDI3AiLGT@ep-calm-glade-ahzfobn1-pooler.c-3.us-east-1.aws.neon.tech/fenghua-crm-dev?sslmode=require&channel_binding=require" -c "SELECT indexname, indexdef FROM pg_indexes WHERE tablename = 'audit_logs' AND indexname LIKE '%entity%' ORDER BY indexname;"
```

---

## ğŸ“ è®°å½•æµ‹è¯•ç»“æœ

è¯·å°†æµ‹è¯•ç»“æœè®°å½•åˆ°ï¼š
- **è¯¦ç»†è®°å½•ï¼š** `_bmad-output/test-reports/story-9-1-test-execution-2026-01-12.md`
- **å¿«é€Ÿå‚è€ƒï¼š** `_bmad-output/test-reports/story-9-1-test-quick-start.md`

---

## ğŸ¯ æµ‹è¯•ç›®æ ‡

**ä¸»è¦éªŒè¯ï¼š**
1. âœ… æ•°æ®è®¿é—®æ“ä½œè‡ªåŠ¨è®°å½•åˆ°å®¡è®¡æ—¥å¿—
2. âœ… å®¡è®¡æ—¥å¿—å¯ä»¥æŸ¥è¯¢å’Œç­›é€‰
3. âœ… å®¡è®¡æ—¥å¿—è¯¦æƒ…å¯ä»¥æŸ¥çœ‹
4. âœ… å®¡è®¡æ—¥å¿—å¯ä»¥å¯¼å‡º
5. âœ… æ€§èƒ½è¡¨ç°è‰¯å¥½

**éªŒæ”¶æ ‡å‡†ï¼š**
- AC1: æ•°æ®è®¿é—®æ“ä½œè‡ªåŠ¨è®°å½• âœ…
- AC2: å®¡è®¡æ—¥å¿—æŸ¥è¯¢å’Œæ˜¾ç¤º âœ…
- AC3: å®¡è®¡æ—¥å¿—è¯¦æƒ…æŸ¥çœ‹ âœ…
- AC4: æ€§èƒ½ä¼˜åŒ– âœ…

---

**å‡†å¤‡å¥½åï¼Œè¯·å¯åŠ¨æœåŠ¡å¹¶å¼€å§‹æµ‹è¯•ï¼**
