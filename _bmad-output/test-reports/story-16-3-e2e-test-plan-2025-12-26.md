# Story 16.3 端到端测试计划

**Story:** 16.3 - 替换用户和角色管理  
**测试日期：** 2025-12-26  
**测试类型：** 端到端测试（E2E）

---

## 📋 测试概述

本测试计划涵盖 Story 16.3 实现的所有用户和角色管理功能的端到端测试，从用户界面到数据库的完整流程验证。

---

## 🎯 测试目标

验证以下完整流程：
1. 用户登录和认证
2. 用户列表查询（包含筛选和搜索）
3. 用户创建
4. 用户更新
5. 用户删除（软删除）
6. 角色管理（查看、分配、移除）

---

## 🧪 测试环境准备

### 前置条件

1. **后端服务运行：**
   - 服务地址：`http://localhost:3001`
   - 数据库连接正常
   - 迁移脚本已执行

2. **前端服务运行：**
   - 服务地址：`http://localhost:3005`（或配置的端口）
   - 可以访问后端 API

3. **数据库状态：**
   - 数据库已初始化
   - 角色数据已导入（`008-seed-roles.sql`）
   - 至少有一个管理员账户

4. **测试账户：**
   - 管理员账户：`zfh8473@gmail.com`（或配置的管理员账户）
   - 管理员密码：已知密码

---

## 📝 测试用例

### 测试用例 1: 用户登录

**步骤：**
1. 访问前端登录页面：`http://localhost:3005/login`
2. 输入管理员邮箱和密码
3. 点击登录按钮

**预期结果：**
- ✅ 登录成功
- ✅ 跳转到主页面或用户管理页面
- ✅ Token 存储在 localStorage（键名：`fenghua_auth_token`）

**验证点：**
- 检查浏览器 localStorage 中是否有 `fenghua_auth_token`
- 检查页面是否跳转
- 检查是否有错误消息

---

### 测试用例 2: 查看用户列表

**步骤：**
1. 登录系统
2. 导航到用户管理页面
3. 查看用户列表

**预期结果：**
- ✅ 显示所有用户（未删除的用户）
- ✅ 每个用户显示：邮箱、姓名、角色、创建时间
- ✅ 角色显示正确（包括 null 角色的处理，显示"无角色"）

**验证点：**
- 用户列表是否正确显示
- 角色信息是否正确
- 创建时间格式是否正确

---

### 测试用例 3: 按角色筛选用户

**步骤：**
1. 在用户管理页面
2. 选择角色筛选（如 ADMIN）
3. 查看筛选结果

**预期结果：**
- ✅ 只显示具有选定角色的用户
- ✅ 筛选功能正常工作

**验证点：**
- 筛选结果是否正确
- 筛选器是否正常工作

---

### 测试用例 4: 搜索用户

**步骤：**
1. 在用户管理页面
2. 在搜索框输入关键词（邮箱或姓名）
3. 查看搜索结果

**预期结果：**
- ✅ 显示匹配的用户
- ✅ 搜索功能正常工作

**验证点：**
- 搜索结果是否正确
- 搜索功能是否正常工作

---

### 测试用例 5: 创建新用户

**步骤：**
1. 在用户管理页面点击"创建新用户"
2. 填写表单：
   - 邮箱：`test-user-${Date.now()}@example.com`
   - 密码：`test123456`
   - 姓名：`测试` `用户`
   - 角色：`FRONTEND_SPECIALIST`
3. 提交表单

**预期结果：**
- ✅ 用户创建成功
- ✅ 显示成功消息
- ✅ 用户出现在用户列表中
- ✅ 用户具有正确的角色

**验证点：**
- 创建是否成功
- 用户信息是否正确
- 角色是否正确分配

---

### 测试用例 6: 创建用户（重复邮箱）

**步骤：**
1. 尝试使用已存在的邮箱创建用户
2. 提交表单

**预期结果：**
- ✅ 显示错误消息："User with email ... already exists"
- ✅ 用户未创建

**验证点：**
- 错误消息是否正确
- 用户是否未创建

---

### 测试用例 7: 更新用户信息

**步骤：**
1. 选择一个用户，点击"编辑"
2. 修改姓名和角色
3. 提交表单

**预期结果：**
- ✅ 用户信息更新成功
- ✅ 显示成功消息
- ✅ 用户列表中的信息已更新
- ✅ 角色已更新

**验证点：**
- 更新是否成功
- 信息是否正确更新
- 角色是否正确更新

---

### 测试用例 8: 更新用户角色

**步骤：**
1. 选择一个用户，点击"编辑"
2. 修改角色（如从 `FRONTEND_SPECIALIST` 改为 `ADMIN`）
3. 提交表单

**预期结果：**
- ✅ 角色更新成功
- ✅ 用户列表中的角色已更新

**验证点：**
- 角色是否正确更新
- 用户列表是否显示新角色

---

### 测试用例 9: 软删除用户

**步骤：**
1. 选择一个用户（不是当前登录用户）
2. 点击"删除"按钮
3. 确认删除

**预期结果：**
- ✅ 用户被软删除
- ✅ 用户从列表中消失
- ✅ 显示成功消息

**验证点：**
- 用户是否从列表中消失
- 数据库中 `deleted_at` 字段是否已设置

---

### 测试用例 10: 尝试删除自己

**步骤：**
1. 尝试删除当前登录的用户
2. 点击"删除"按钮

**预期结果：**
- ✅ 显示错误消息："不能删除自己的账户"
- ✅ 用户未被删除
- ✅ 删除按钮被禁用（或显示错误）

**验证点：**
- 错误消息是否正确
- 用户是否未被删除

---

### 测试用例 11: 查看角色列表

**步骤：**
1. 访问角色管理页面（如果存在）
2. 或通过 API 直接测试：`GET /roles`

**预期结果：**
- ✅ 返回所有角色列表
- ✅ 包含：ADMIN, DIRECTOR, FRONTEND_SPECIALIST, BACKEND_SPECIALIST
- ✅ 每个角色包含 id, name, description

**验证点：**
- 角色列表是否正确
- 角色信息是否完整

---

### 测试用例 12: 分配角色给用户

**步骤：**
1. 选择一个没有角色的用户（或选择一个用户）
2. 编辑用户，分配角色（如 `ADMIN`）
3. 提交表单

**预期结果：**
- ✅ 角色分配成功
- ✅ 用户具有新角色
- ✅ 用户列表中的角色已更新

**验证点：**
- 角色是否正确分配
- 用户列表是否显示新角色

---

## 🔧 测试工具和方法

### 手动测试

1. **浏览器测试：**
   - 使用 Chrome/Firefox 浏览器
   - 打开开发者工具（F12）
   - 检查 Network 标签页查看 API 请求
   - 检查 Console 标签页查看错误信息
   - 检查 Application > Local Storage 查看 token

2. **API 测试：**
   - 使用 Postman 或 curl 直接测试 API
   - 验证 API 响应格式
   - 验证错误处理

3. **数据库验证：**
   - 直接查询数据库验证数据
   - 检查 `users` 表
   - 检查 `user_roles` 表
   - 检查 `roles` 表

---

## 📊 测试执行记录

测试执行记录将在实际测试时填写。

---

## ✅ 测试通过标准

- 所有测试用例通过
- 无功能缺陷
- 无性能问题
- 用户体验良好
- 错误处理正确

---

**创建时间：** 2025-12-26

