# Story 7-5 测试计划：自定义字段导出

**Story:** 7-5 自定义字段导出  
**日期:** 2025-01-08  
**测试类型:** 功能测试、集成测试

---

## 测试环境

- **后端服务:** http://localhost:3001
- **前端服务:** http://localhost:5173
- **测试账户:** 管理员账户（总监或管理员角色）

---

## 测试用例

### TC1: 字段查询 API 端点

**目标:** 验证字段定义 API 端点正常工作

**步骤:**
1. 使用管理员账户登录
2. 测试 GET `/api/export/fields/customer`
3. 测试 GET `/api/export/fields/product`
4. 测试 GET `/api/export/fields/interaction`
5. 测试 GET `/api/export/fields/invalid` (应该返回 400)

**预期结果:**
- 所有有效端点返回 200 状态码
- 返回的字段列表包含所有必需字段（fieldName, displayName, category, isRequired, dataType）
- 客户字段包含：基本信息、联系信息、业务信息、系统信息类别
- 产品字段包含：基本信息、详细信息、状态信息、系统信息类别
- 互动记录字段包含：关联信息、互动信息、系统信息、附件信息类别
- 无效端点返回 400 错误

---

### TC2: 前端字段选择界面

**目标:** 验证字段选择组件正常显示和交互

**步骤:**
1. 访问导出页面 (`/export`)
2. 选择不同的数据类型（客户、产品、互动记录）
3. 验证字段列表是否正确加载
4. 验证字段按类别分组显示
5. 验证默认选择所有字段
6. 测试字段搜索功能
7. 测试全选/全不选功能
8. 测试按类别全选/全不选功能
9. 测试字段展开/折叠功能

**预期结果:**
- 选择数据类型后，字段列表自动加载
- 字段按类别正确分组
- 默认所有字段被选中
- 搜索功能可以过滤字段
- 全选/全不选功能正常工作
- 类别级别的全选/全不选功能正常工作
- 类别可以展开和折叠

---

### TC3: 文件大小估算

**目标:** 验证文件大小估算功能

**步骤:**
1. 在导出页面选择数据类型和格式
2. 选择不同数量的字段
3. 观察文件大小估算的变化
4. 切换不同的导出格式（JSON、CSV、Excel）
5. 验证估算值是否合理

**预期结果:**
- 选择字段后显示文件大小估算
- 选择更多字段时，估算值增加
- 不同格式的估算值不同（JSON > Excel > CSV）
- 估算值格式正确（B、KB、MB）

---

### TC4: 字段过滤导出 - JSON 格式

**目标:** 验证 JSON 格式导出只包含选定字段

**步骤:**
1. 选择数据类型：客户
2. 选择导出格式：JSON
3. 选择部分字段（例如：name, customerCode, email）
4. 启动导出
5. 等待导出完成
6. 下载并打开导出文件
7. 验证文件只包含选定的字段
8. 验证字段顺序与选择顺序一致

**预期结果:**
- 导出文件只包含选定的字段
- 字段顺序与用户选择顺序一致
- JSON 文件格式正确，可以正常解析

---

### TC5: 字段过滤导出 - CSV 格式

**目标:** 验证 CSV 格式导出只包含选定字段，列标题使用中文名称

**步骤:**
1. 选择数据类型：产品
2. 选择导出格式：CSV
3. 选择部分字段（例如：name, hsCode, category, status）
4. 启动导出
5. 等待导出完成
6. 下载并打开导出文件（使用 Excel 或文本编辑器）
7. 验证文件只包含选定的字段列
8. 验证列标题使用中文名称（如"产品名称"而不是"name"）
9. 验证列顺序与选择顺序一致

**预期结果:**
- 导出文件只包含选定的字段列
- 列标题使用中文名称
- 列顺序与用户选择顺序一致
- CSV 文件可以在 Excel 中正常打开

---

### TC6: 字段过滤导出 - Excel 格式

**目标:** 验证 Excel 格式导出只包含选定字段，列标题使用中文名称

**步骤:**
1. 选择数据类型：互动记录
2. 选择导出格式：Excel
3. 选择部分字段（例如：interactionType, interactionDate, description, status）
4. 启动导出
5. 等待导出完成
6. 下载并打开导出文件
7. 验证文件只包含选定的字段列
8. 验证列标题使用中文名称
9. 验证列顺序与选择顺序一致
10. 验证工作表名称正确（"互动记录"）

**预期结果:**
- 导出文件只包含选定的字段列
- 列标题使用中文名称
- 列顺序与用户选择顺序一致
- Excel 文件可以正常打开
- 工作表名称正确

---

### TC7: 导出所有字段（默认行为）

**目标:** 验证不选择字段时导出所有字段（向后兼容）

**步骤:**
1. 选择数据类型：客户
2. 选择导出格式：JSON
3. 不修改字段选择（保持全选状态）
4. 启动导出
5. 等待导出完成
6. 下载并打开导出文件
7. 验证文件包含所有可用字段

**预期结果:**
- 导出文件包含所有可用字段
- 功能与 Story 7-4 保持一致（向后兼容）

---

### TC8: 字段顺序保持

**目标:** 验证字段顺序与用户选择顺序一致

**步骤:**
1. 选择数据类型：产品
2. 选择导出格式：CSV
3. 按特定顺序选择字段（例如：status, name, hsCode, category）
4. 启动导出
5. 等待导出完成
6. 下载并打开导出文件
7. 验证列顺序与选择顺序一致

**预期结果:**
- 导出文件中的字段顺序与用户选择顺序完全一致

---

### TC9: 错误处理

**目标:** 验证错误处理机制

**步骤:**
1. 测试未登录状态下访问字段查询端点（应该返回 401）
2. 测试非管理员账户访问导出功能（应该返回 403）
3. 测试选择空字段列表时导出（应该允许，导出空文件或所有字段）

**预期结果:**
- 未登录时返回 401 错误
- 非管理员账户返回 403 错误
- 空字段列表的处理合理（建议导出所有字段或显示警告）

---

## 测试检查清单

- [ ] TC1: 字段查询 API 端点
- [ ] TC2: 前端字段选择界面
- [ ] TC3: 文件大小估算
- [ ] TC4: 字段过滤导出 - JSON 格式
- [ ] TC5: 字段过滤导出 - CSV 格式
- [ ] TC6: 字段过滤导出 - Excel 格式
- [ ] TC7: 导出所有字段（默认行为）
- [ ] TC8: 字段顺序保持
- [ ] TC9: 错误处理

---

## 已知问题

- 无

---

## 测试结果

**测试日期:** ___________  
**测试人员:** ___________  
**总体结果:** ⬜ 通过  ⬜ 部分通过  ⬜ 失败

**备注:**
___________________________________________________


