# 基础设施决策文档

**日期：** 2025-12-26  
**项目：** fenghua-crm  
**状态：** 决策中  
**最后更新：** 2025-12-26

---

## 文档目的

本文档记录 fenghua-crm 项目的基础设施关键决策，包括：
- 数据库架构和部署时机
- 应用服务器选择
- 多区域部署策略
- 文件存储方案
- Twenty CRM 绑定评估
- 解耦策略

---

## 1. 数据库架构决策

### 1.1 数据库平台

**决策：** PostgreSQL 16（由 Twenty CRM 提供）

**理由：**
- Twenty CRM 使用 PostgreSQL
- 生产就绪，支持 RLS（Row Level Security）
- TypeORM 集成良好
- 符合架构文档要求

**版本：** 最新稳定版本（由 Twenty CRM 支持）

---

### 1.2 数据库架构方案

#### 方案 A：共享数据库（当前推荐）

**架构：**
```
┌─────────────────────────────────┐
│   PostgreSQL (共享)              │
│                                 │
│   ┌─────────────────────────┐  │
│   │ Twenty CRM 数据         │  │
│   │ - Companies (客户)      │  │
│   │ - Contacts (联系人)     │  │
│   │ - Users (用户)          │  │
│   │ - WorkspaceMembers      │  │
│   └─────────────────────────┘  │
│                                 │
│   ┌─────────────────────────┐  │
│   │ fenghua-crm 定制表      │  │
│   │ - products (产品)        │  │
│   │ - interactions (互动记录)│  │
│   │ - custom_business_data   │  │
│   └─────────────────────────┘  │
└─────────────────────────────────┘
```

**优点：**
- ✅ 数据关联方便（可以直接 JOIN）
- ✅ 事务处理简单（同一事务）
- ✅ 性能好（数据库查询，无网络延迟）
- ✅ 数据一致性有保障（外键约束）

**缺点：**
- ⚠️ 需要访问 Twenty 数据库
- ⚠️ 与 Twenty CRM 耦合（数据库层面）
- ⚠️ 升级 Twenty 可能影响定制表

**适用场景：**
- MVP 阶段
- 数据关联频繁
- 性能要求高（< 500ms API 响应）

---

#### 方案 B：独立数据库

**架构：**
```
┌─────────────────────┐         ┌─────────────────────┐
│ Twenty PostgreSQL   │         │ fenghua PostgreSQL  │
│                     │         │                     │
│ - Companies         │         │ - products          │
│ - Contacts          │         │ - interactions      │
│ - Users             │         │ - custom_data        │
│ - WorkspaceMembers  │         │                     │
└─────────────────────┘         └─────────────────────┘
         │                               │
         └─────────── API ──────────────┘
```

**优点：**
- ✅ 完全隔离
- ✅ 易于备份和恢复
- ✅ 可以独立升级
- ✅ 不受 Twenty CRM 数据库变更影响

**缺点：**
- ❌ 数据关联复杂（需要通过 API）
- ❌ 无法使用数据库 JOIN
- ❌ 事务处理复杂（需要补偿事务/Saga 模式）
- ❌ 性能影响（API 调用 vs 数据库查询）
- ❌ 数据一致性风险（需要应用层保证）

**技术影响：**

1. **数据关联复杂度**
   ```sql
   -- 当前（共享数据库）:
   SELECT p.*, c.name 
   FROM products p 
   JOIN companies c ON p.customer_id = c.id;
   
   -- 独立数据库后:
   -- 需要先调用 Twenty API 获取 customer 信息
   -- 在应用层做关联
   ```

2. **事务处理**
   - 当前：可以在同一事务中操作 Twenty 数据和定制数据
   - 独立后：无法跨数据库事务，需要实现补偿事务

3. **性能影响**
   - 当前：数据库查询（毫秒级）
   - 独立后：API 调用（网络延迟 + 处理时间，可能 10-100ms）
   - 需要实现缓存层减少 API 调用

**适用场景：**
- 需要完全解耦
- 数据合规要求（完全隔离）
- 未来可能替换 Twenty CRM

---

### 1.3 数据库搭建时机

**决策：** 立即开始定制表设计，在 Epic 2（产品管理）开始前完成

**时间线：**
- **现在（Story 1.2-1.4）：** 使用 Twenty CRM 现有数据库（用户管理）
- **Epic 2 前（1-2 周）：** 创建定制表结构（products, interactions）
- **Epic 2 开始：** 使用定制表进行产品管理开发

**实施步骤：**
1. 设计定制表结构（products, interactions）
2. 创建数据库迁移脚本
3. 在开发环境测试
4. 部署到生产环境

**理由：**
- 用户管理（Story 1.2-1.4）可以使用 Twenty CRM 现有表
- 产品管理（Epic 2）需要定制表
- 提前建立数据模型，避免后期迁移成本

---

### 1.4 数据库决策总结

**当前决策：** 方案 A（共享数据库）

**理由：**
1. MVP 阶段，专注于功能开发
2. 数据关联频繁（产品-客户-互动）
3. 性能要求（< 500ms API 响应）
4. 已投入开发时间

**未来考虑解耦的时机：**
- 用户量 > 100
- 需要替换 Twenty CRM
- 数据合规要求（完全隔离）
- 性能瓶颈（API 调用成为瓶颈）

**解耦准备：**
- 保持 API 集成架构（便于未来解耦）
- 避免直接数据库访问（通过 API）
- 设计数据同步机制（如果未来需要）

---

## 2. 应用服务器选择

### 2.1 前端部署

#### 选项 A：Vercel（推荐 - 美国用户）

**优点：**
- ✅ 快速部署，零配置
- ✅ 全球 CDN，自动优化
- ✅ 免费额度充足（个人项目）
- ✅ 支持 React、Next.js 等

**缺点：**
- ⚠️ 中国用户访问可能较慢（需要国内 CDN）
- ⚠️ Serverless 函数有冷启动问题

**适用场景：**
- 主要用户在美国
- 需要快速部署
- 预算有限

---

#### 选项 B：阿里云/腾讯云 CDN（推荐 - 中国用户）

**优点：**
- ✅ 中国用户访问速度快
- ✅ 符合国内合规要求
- ✅ 价格合理

**缺点：**
- ⚠️ 需要备案（如果使用国内服务器）
- ⚠️ 配置相对复杂

**适用场景：**
- 主要用户在中国
- 需要符合国内合规要求

---

#### 选项 C：Cloudflare Pages（推荐 - 全球用户）

**优点：**
- ✅ 全球 CDN，速度快
- ✅ 免费额度充足
- ✅ 支持多区域部署
- ✅ 无需备案

**缺点：**
- ⚠️ 中国用户访问可能受限（需要国内镜像）

**适用场景：**
- 全球用户分布
- 需要快速部署

---

### 2.2 后端部署

#### 选项 A：Railway（推荐）

**优点：**
- ✅ 支持 NestJS 长期运行
- ✅ 自动部署，零配置
- ✅ 支持 PostgreSQL 数据库
- ✅ 价格合理（$5-20/月）

**缺点：**
- ⚠️ 中国用户访问可能较慢

**适用场景：**
- 需要快速部署
- 预算有限
- 主要用户在美国

---

#### 选项 B：Render

**优点：**
- ✅ 支持 NestJS
- ✅ 自动部署
- ✅ 支持 PostgreSQL
- ✅ 免费额度（有限制）

**缺点：**
- ⚠️ 免费额度有限
- ⚠️ 中国用户访问可能较慢

---

#### 选项 C：阿里云 ECS / 腾讯云 CVM（推荐 - 中国用户）

**优点：**
- ✅ 中国用户访问速度快
- ✅ 符合国内合规要求
- ✅ 完全控制

**缺点：**
- ⚠️ 需要自己维护
- ⚠️ 需要备案

**适用场景：**
- 主要用户在中国
- 需要完全控制
- 有运维团队

---

#### 选项 D：AWS ECS / Google Cloud Run

**优点：**
- ✅ 全球部署
- ✅ 高可用性
- ✅ 企业级支持

**缺点：**
- ⚠️ 价格较高
- ⚠️ 配置复杂

**适用场景：**
- 企业级应用
- 需要高可用性
- 预算充足

---

### 2.3 应用服务器决策总结

**推荐方案（根据用户分布）：**

**场景 1：主要用户在中国**
```
前端：阿里云/腾讯云 CDN
后端：阿里云 ECS / 腾讯云 CVM
数据库：阿里云 RDS PostgreSQL
```

**场景 2：主要用户在美国**
```
前端：Vercel / Cloudflare Pages
后端：Railway / Render
数据库：Railway PostgreSQL / Supabase
```

**场景 3：全球用户分布**
```
前端：Cloudflare Pages（全球 CDN）
后端：Railway（美国）+ 阿里云 ECS（中国镜像）
数据库：主数据库（美国）+ 只读副本（中国）
```

**当前建议：**
- 需要先明确用户分布（中国 vs 美国）
- MVP 阶段可以使用单一区域部署
- 根据用户反馈决定是否需要多区域部署

---

## 3. 多区域部署策略

### 3.1 问题分析

**挑战：**
- 中国用户访问美国服务器可能较慢
- 美国用户访问中国服务器可能受限
- 需要处理数据同步和一致性

### 3.2 部署方案

#### 方案 A：单一区域部署（MVP 阶段）

**架构：**
```
所有用户 → 单一区域服务器（美国或中国）
```

**优点：**
- ✅ 简单，成本低
- ✅ 易于维护
- ✅ 数据一致性有保障

**缺点：**
- ⚠️ 部分用户访问可能较慢
- ⚠️ 可能受网络限制影响

**适用场景：**
- MVP 阶段
- 用户主要集中在一个区域
- 预算有限

---

#### 方案 B：多区域部署（Growth 阶段）

**架构：**
```
中国用户 → 中国服务器（阿里云）
美国用户 → 美国服务器（Railway）
         ↓
    数据同步（主从复制或 API 同步）
```

**优点：**
- ✅ 全球用户访问速度快
- ✅ 符合各地合规要求

**缺点：**
- ❌ 复杂度高
- ❌ 成本增加
- ❌ 需要处理数据同步

**实施策略：**
1. 主数据库（美国）
2. 只读副本（中国）
3. 应用层路由（根据用户地理位置）

---

### 3.3 多区域部署决策

**当前决策：** 方案 B（多区域部署）- **更新：需要同时服务中国和美国用户**

**理由：**
- ✅ 主要用户在中国，但需要服务美国用户
- ✅ 中国用户访问美国服务器可能较慢或受限
- ✅ 美国用户访问中国服务器可能受限
- ✅ 需要提供良好的用户体验给两地用户

**区域选择分析：**

#### 选项 1：单一区域 - 新加坡（不推荐）

**架构：**
```
所有用户 → 新加坡服务器
```

**延迟分析：**
- 中国用户：~100-150ms（中等）
- 美国用户：~200-250ms（较慢）

**优点：**
- ✅ 单一区域，简单
- ✅ 对两地用户都有一定可用性

**缺点：**
- ❌ 对两地用户都不是最优（延迟较高）
- ❌ 中国用户可能仍需要翻墙（取决于网络）
- ❌ 美国用户延迟较高

**结论：** 不推荐，延迟对两地用户都不理想

---

#### 选项 2：多区域部署（推荐）

**架构：**
```
中国用户 → 中国/香港服务器（阿里云/腾讯云）
美国用户 → 美国服务器（Railway/AWS）
         ↓
    数据同步（Neon 分支或主从复制）
```

**延迟分析：**
- 中国用户：~20-50ms（快）
- 美国用户：~20-50ms（快）

**优点：**
- ✅ 两地用户访问速度都很快
- ✅ 符合各地合规要求
- ✅ 可以独立扩展

**缺点：**
- ❌ 复杂度较高
- ❌ 成本增加（两套基础设施）
- ❌ 需要处理数据同步

**实施策略：**
1. **数据库：** Neon 主数据库（美国）+ 只读副本或分支（中国）
2. **后端：** 中国服务器（阿里云 ECS）+ 美国服务器（Railway）
3. **前端：** Cloudflare Pages（全球 CDN）+ 阿里云 CDN（中国加速）
4. **数据同步：** Neon 分支功能或主从复制

---

#### 选项 3：单一区域 + CDN（折中方案）

**架构：**
```
所有用户 → 美国服务器（Railway）
         ↓
    全球 CDN（Cloudflare）
```

**延迟分析：**
- 中国用户：~150-200ms（CDN 加速后）
- 美国用户：~20-50ms（快）

**优点：**
- ✅ 简单，成本低
- ✅ CDN 可以加速中国用户访问
- ✅ 易于维护

**缺点：**
- ❌ 中国用户延迟仍较高
- ❌ 可能受网络限制影响

**结论：** MVP 阶段可以考虑，但长期需要多区域部署

---

### 3.4 区域选择决策（更新）

**推荐方案：** 选项 2（多区域部署）

**理由：**
1. **主要用户在中国**，需要提供快速访问
2. **美国用户也需要服务**，不能牺牲美国用户体验
3. **Neon 支持多区域和分支功能**，便于数据同步
4. **长期成本效益**，用户体验优先

**实施时间线：**
- **MVP 阶段（1-2 个月）：** 可以使用选项 3（单一区域 + CDN）
- **Growth 阶段（3-6 个月）：** 迁移到选项 2（多区域部署）

**Neon 区域选择：**
- **主数据库：** 美国区域（`aws-us-east-1` 或 `aws-us-west-2`）
- **中国副本/分支：** 如果 Neon 支持亚洲区域，使用亚洲区域；否则使用主数据库 + 中国应用服务器缓存

**应用服务器区域：**
- **中国：** 阿里云 ECS（北京/上海/深圳）
- **美国：** Railway / Render（美国区域）

**前端 CDN：**
- **全球：** Cloudflare Pages（全球 CDN）
- **中国加速：** 阿里云 CDN（中国用户专用）

---

### 3.5 关于新加坡区域的说明

**问题：** 是否应该选择新加坡区域？

**分析：**
- 新加坡区域对亚洲用户友好，但：
  - 中国用户访问仍可能需要翻墙（取决于网络）
  - 美国用户延迟较高（~200ms）
  - 不是最优选择

**结论：**
- ❌ **不推荐单一新加坡区域**
- ✅ **推荐多区域部署**（中国 + 美国）
- ✅ **如果必须单一区域，选择美国 + CDN**（MVP 阶段）

---

## 4. 文件存储方案

### 4.1 需求分析

**存储内容：**
- 供应商现场照片
- 产品照片
- 视频文件
- 文档附件

**特点：**
- 文件大小：照片（1-10MB），视频（10-100MB）
- 访问频率：中等（查看产品时访问）
- 存储期限：长期（业务数据）

---

### 4.2 存储方案

#### 方案 A：云对象存储（推荐）

**架构：**
```
应用服务器 → 云对象存储（OSS/S3）
         ↓
    数据库只存储文件 URL 和元数据
```

**中国用户：**
- **阿里云 OSS**（推荐）
  - 价格：¥0.12/GB/月（标准存储）
  - 流量：¥0.50/GB（国内）
  - 优点：速度快，价格合理，符合国内合规

- **腾讯云 COS**
  - 价格：¥0.118/GB/月
  - 流量：¥0.50/GB（国内）
  - 优点：与腾讯云生态集成

**美国用户：**
- **AWS S3**（推荐）
  - 价格：$0.023/GB/月（标准存储）
  - 流量：$0.09/GB（出站）
  - 优点：全球可用，可靠性高

- **Cloudflare R2**
  - 价格：$0.015/GB/月
  - 流量：免费（出站）
  - 优点：价格低，无出站费用

**优点：**
- ✅ 可扩展性强
- ✅ 成本低（按需付费）
- ✅ 可靠性高（多副本）
- ✅ 支持 CDN 加速

**缺点：**
- ⚠️ 需要处理文件上传逻辑
- ⚠️ 需要管理访问权限

---

#### 方案 B：数据库存储（不推荐）

**架构：**
```
应用服务器 → PostgreSQL BLOB 字段
```

**缺点：**
- ❌ 数据库体积快速增长
- ❌ 备份和恢复慢
- ❌ 性能影响（大文件查询）
- ❌ 成本高（数据库存储比对象存储贵）

**不推荐理由：**
- 不符合最佳实践
- 影响数据库性能
- 成本高

---

#### 方案 C：本地文件系统（不推荐）

**架构：**
```
应用服务器 → 本地文件系统
```

**缺点：**
- ❌ 无法扩展
- ❌ 单点故障
- ❌ 备份复杂
- ❌ 不适合云部署

---

### 4.3 文件存储决策

**决策：** 方案 A（云对象存储）

**实施细节：**

1. **存储策略：**
   - 照片：标准存储（热数据）
   - 视频：标准存储或低频访问存储（根据访问频率）
   - 文档：标准存储

2. **访问控制：**
   - 私有存储 + 签名 URL（临时访问链接）
   - 基于用户角色的访问控制
   - 文件大小限制（单文件 < 50MB）

3. **成本优化：**
   - 根据访问频率选择存储类型
   - 使用 CDN 加速（减少流量费用）
   - 定期清理未使用的文件

4. **数据库设计：**
   ```sql
   CREATE TABLE file_attachments (
     id UUID PRIMARY KEY,
     file_name VARCHAR(255),
     file_url TEXT,  -- 对象存储 URL
     file_size BIGINT,
     file_type VARCHAR(50),
     storage_provider VARCHAR(50),  -- 'aliyun_oss', 'aws_s3', etc.
     created_at TIMESTAMP,
     created_by UUID,
     FOREIGN KEY (created_by) REFERENCES users(id)
   );
   ```

**当前建议：**
- MVP 阶段：使用阿里云 OSS（如果主要用户在中国）或 AWS S3（如果主要用户在美国）
- 根据用户分布选择存储提供商
- 未来可以考虑多区域存储（主存储 + 镜像）

---

## 5. Twenty CRM 绑定评估

### 5.1 当前绑定分析

**绑定程度：中等**

#### 强绑定（难以解耦）：
1. **认证系统**
   - 使用 Twenty CRM 的 JWT 认证
   - `auth.service.ts` 调用 `getLoginTokenFromCredentials` mutation
   - Token 验证通过 `currentUser` query
   - **影响：** 如果 Twenty CRM 不可用，用户无法登录

2. **客户数据**
   - 客户数据（Companies）存储在 Twenty CRM
   - 核心业务数据依赖 Twenty CRM
   - **影响：** 核心业务功能依赖 Twenty CRM

#### 中等绑定（可以解耦但成本高）：
1. **数据模型**
   - 使用 Twenty CRM Custom Objects（产品、互动记录）
   - **影响：** 数据模型受 Twenty CRM 的 Custom Objects API 限制

2. **数据库**
   - 当前：共享 PostgreSQL 数据库
   - **影响：** 需要访问 Twenty CRM 数据库

#### 弱绑定（容易解耦）：
1. **产品数据**
   - 可以完全独立
   - **影响：** 低

2. **互动记录**
   - 可以完全独立
   - **影响：** 低

---

### 5.2 解耦策略

#### 策略 A：保持当前架构（推荐 - MVP 阶段）

**理由：**
- ✅ 已投入开发时间
- ✅ 性能要求（< 500ms API 响应）
- ✅ 数据关联频繁（产品-客户-互动）
- ✅ 开发效率高

**风险缓解：**
- ✅ API 集成架构（不修改 Twenty 代码）
- ✅ 定制代码完全独立
- ✅ 可以独立部署和升级

---

#### 策略 B：逐步解耦（Growth 阶段）

**时机：**
- 用户量 > 100
- 需要替换 Twenty CRM
- 数据合规要求（完全隔离）
- 性能瓶颈（API 调用成为瓶颈）

**实施步骤：**
1. 实现数据同步机制（客户数据同步到本地）
2. 实现独立认证系统（如果 Twenty CRM 不可用）
3. 迁移到独立数据库
4. 实现补偿事务（Saga 模式）

---

### 5.3 解耦评估文档

**需要记录：**
1. 当前绑定点清单
2. 解耦成本和收益
3. 解耦触发条件（何时需要解耦）
4. 解耦实施计划（如果决定解耦）

**解耦成本估算：**
- 开发成本：2-3 周重构 + 持续维护
- 性能成本：API 调用延迟 + 缓存基础设施
- 运维成本：两个数据库的监控和维护

---

## 6. Fork + 私有化部署评估

### 6.1 Fork 代码的可行性

**技术上：完全可行**
- ✅ Fork 代码是标准做法
- ✅ 可以深度定制
- ✅ 性能更好（直接数据库访问）

**合规上：取决于使用场景**
- ⚠️ 内部使用：可能不需要开源（需法律确认）
- ❌ 对外服务：必须开源所有修改（AGPL-3.0 要求）

**维护上：成本较高**
- ⚠️ 需要跟踪 Twenty 更新
- ⚠️ 需要处理合并冲突
- ⚠️ 需要维护 fork

---

### 6.2 Fork 方案评估

#### 优点：
1. **完全控制代码**
   - 可以深度定制 Twenty CRM
   - 可以修改核心功能
   - 不受 API 限制

2. **性能优势**
   - 直接数据库访问（无需 API 调用）
   - 可以优化查询性能
   - 可以添加数据库索引

3. **功能集成**
   - 定制功能可以直接集成到 Twenty
   - 统一的用户界面
   - 无需处理跨系统认证

#### 缺点：
1. **升级成本高**
   ```
   每次 Twenty 更新：
   ├─ 需要合并上游更改
   ├─ 需要解决冲突
   ├─ 需要测试兼容性
   └─ 可能需要重构定制代码
   ```

2. **维护负担**
   - 需要跟踪 Twenty 的更新
   - 需要维护 fork
   - 需要处理安全补丁

3. **许可证风险**
   - 如果对外提供服务，必须开源所有修改
   - 可能暴露专有业务逻辑

---

### 6.3 Fork 决策

**当前决策：不建议 fork**

**理由：**
1. 当前 API 集成架构已满足需求
2. 如果对外服务，fork 后必须开源（失去专有优势）
3. 维护成本高（需要专门团队维护 fork）

**如果必须 fork（深度定制需求）：**
1. 明确使用场景（内部 vs 对外）
2. 咨询法律专业人士（确认许可证要求）
3. 建立升级和维护流程
4. 考虑商业许可证（如果可以获取）

---

## 7. 决策总结

### 7.1 当前决策（MVP 阶段）

| 决策项 | 决策 | 理由 |
|--------|------|------|
| 数据库架构 | 独立数据库（Neon PostgreSQL） | 完全控制，无外部依赖 |
| 数据库搭建时机 | Epic 2 前 | 提前建立数据模型 |
| 前端部署 | Vercel | Serverless，全球 CDN，零配置 |
| 后端部署 | Vercel API Routes | Serverless，无需 Docker，成本低 |
| 多区域部署 | 单一区域 | MVP 阶段，用户量小 |
| 文件存储 | 云对象存储 | 可扩展，成本低 |
| Twenty CRM 绑定 | **已移除** | 支持 Vercel 部署，简化架构，移除集成问题 |
| Fork + 私有化 | 不适用 | 已移除 Twenty CRM 依赖 |

---

### 7.2 重构决策记录（2025-12-26）

**决策：移除 Twenty CRM 依赖，使用原生技术栈**

**决策日期：** 2025-12-26  
**决策原因：**
1. **部署限制**：Twenty CRM 需要 Docker 容器，无法部署到 Vercel
2. **集成问题**：每次开发都遇到集成问题，影响开发效率
3. **心理负担**：感觉是"累赘"，影响开发动力
4. **长期收益**：移除依赖后，开发速度提升，部署简化

**新架构：**
- 认证：NextAuth.js / JWT（Vercel 原生支持）
- 用户管理：自建服务（Prisma + PostgreSQL）
- 客户管理：自建服务（Prisma + PostgreSQL）
- 数据库：Neon PostgreSQL（Serverless）
- 部署：Vercel（前端 + API Routes）

**迁移计划：** 6-8 周  
**参考文档：** `_bmad-output/refactoring-plan-remove-twenty-dependency-2025-12-26.md`

---

### 7.3 未来考虑（Growth 阶段）

| 决策项 | 触发条件 | 考虑方案 |
|--------|----------|----------|
| 多区域部署 | 用户分布在不同区域 | 主从复制 + 应用层路由 |
| 性能优化 | 用户量 > 1000 | 数据库索引优化，缓存策略 |
| 扩展功能 | 业务需求增长 | 基于新架构自由扩展 |

---

## 8. 下一步行动

### 8.1 立即行动（1-2 周）

1. **明确用户分布**
   - 调查主要用户区域（中国 vs 美国）
   - 决定部署区域

2. **数据库设计**
   - 设计定制表结构（products, interactions）
   - 创建数据库迁移脚本

3. **文件存储准备**
   - 选择存储提供商（根据用户分布）
   - 实现文件上传功能

---

### 8.2 短期行动（1-2 个月）

1. **部署基础设施**
   - 部署应用服务器
   - 配置数据库
   - 配置文件存储

2. **监控和优化**
   - 监控性能指标
   - 优化数据库查询
   - 优化文件存储成本

---

### 8.3 长期规划（3-6 个月）

1. **评估解耦需求**
   - 评估用户量增长
   - 评估性能瓶颈
   - 评估合规要求

2. **准备解耦方案**
   - 设计数据同步机制
   - 设计独立认证系统
   - 准备解耦实施计划

---

## 9. 参考文档

- [原生技术栈架构](api-integration-architecture.md) - 当前架构文档
- [架构文档](../_bmad-output/architecture.md)
- [重构计划](../_bmad-output/refactoring-plan-remove-twenty-dependency-2025-12-26.md)
- [环境设置指南](environment-setup-guide.md)
- [快速开始指南](quick-start-guide.md)

**历史文档（已归档）：**
- [Twenty CRM 相关文档](../docs/archive/twenty-crm/README.md) - 历史参考

---

## 10. 更新记录

| 日期 | 更新内容 | 更新人 |
|------|----------|--------|
| 2025-12-26 | 创建文档，记录基础设施决策 | Party Mode 讨论 |
| 2025-12-26 | 更新决策：移除 Twenty CRM 依赖，使用原生技术栈 | Party Mode 讨论 |

---

**文档状态：** 已决策  
**当前架构：** 原生技术栈（NestJS + PostgreSQL + NextAuth.js）  
**部署方案：** Vercel（前端 + API Routes）  
**下次审查：** 根据项目进展和用户反馈

