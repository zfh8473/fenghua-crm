# 基础设施实施时间表

**日期：** 2025-12-26  
**项目：** fenghua-crm  
**状态：** 进行中  
**最后更新：** 2025-12-26

---

## 文档目的

本文档提供基础设施配置和开发的详细时间表，确保在 Epic 2（产品管理）开始前完成必要的准备工作。

---

## 总体时间线

```
本周（2025-12-26 至 2025-12-29）
├─ Story 1.3 review 反馈（1-2 天）
├─ 定制表设计（1-2 天）← 并行
└─ 数据库迁移脚本（1 天）← 并行

下周（2025-12-30 至 2026-01-05）
├─ 部署定制表到开发环境（1 天）
├─ 测试数据关联（1 天）
└─ 开始 Epic 2 Story 2.1（表已就绪）

2-3 周后（2026-01-06 至 2026-01-19）
└─ 生产部署配置（MVP 发布前）
```

---

## 详细时间表

### 阶段 1：立即开始（本周：2025-12-26 至 2025-12-29）

#### 任务 1.1：完成 Story 1.3 Review 反馈

**时间：** 1-2 天  
**优先级：** 高  
**负责人：** 开发团队

**任务清单：**
- [ ] 审查代码审查报告
- [ ] 修复 High 优先级问题
- [ ] 修复 Medium 优先级问题
- [ ] 更新测试用例
- [ ] 重新运行测试
- [ ] 更新 Story 状态为 `done`

**依赖：** 无  
**阻塞：** 无

---

#### 任务 1.2：定制表设计（并行进行）

**时间：** 1-2 天  
**优先级：** 高  
**负责人：** 架构师 + 开发团队

**任务清单：**
- [x] 创建数据库表结构设计文档（已完成）
- [ ] 评审表结构设计
- [ ] 确认字段定义
- [ ] 确认索引策略
- [ ] 确认业务规则
- [ ] 确认与 Twenty CRM 表的关联关系

**依赖：** 无  
**阻塞：** 无  
**输出：** `docs/database-schema-design.md`

---

#### 任务 1.3：创建数据库迁移脚本（并行进行）

**时间：** 1 天  
**优先级：** 高  
**负责人：** 开发团队

**任务清单：**
- [ ] 创建 TypeORM migration 文件
- [ ] 实现 products 表创建
- [ ] 实现 product_customer_interactions 表创建
- [ ] 实现 file_attachments 表创建
- [ ] 创建索引
- [ ] 创建触发器（自动更新时间戳）
- [ ] 编写回滚脚本
- [ ] 在开发环境测试迁移

**依赖：** 任务 1.2（表设计）  
**阻塞：** 无  
**输出：** 
- `fenghua-backend/src/migrations/XXXXXX-create-products-table.ts`
- `fenghua-backend/src/migrations/XXXXXX-create-interactions-table.ts`
- `fenghua-backend/src/migrations/XXXXXX-create-attachments-table.ts`

---

#### 任务 1.4：文件存储方案设计（可选，并行进行）

**时间：** 1 天  
**优先级：** 中  
**负责人：** 架构师

**任务清单：**
- [ ] 明确用户分布（中国 vs 美国）
- [ ] 选择存储提供商（根据用户分布）
- [ ] 设计文件上传 API
- [ ] 设计文件访问控制（签名URL）
- [ ] 设计文件大小限制策略
- [ ] 创建文件存储服务接口

**依赖：** 无  
**阻塞：** 无  
**输出：** 文件存储方案设计文档

---

### 阶段 2：Epic 2 前准备（下周：2025-12-30 至 2026-01-05）

#### 任务 2.1：部署定制表到开发环境

**时间：** 1 天  
**优先级：** 高  
**负责人：** 开发团队

**任务清单：**
- [ ] 备份开发环境数据库
- [ ] 运行数据库迁移脚本
- [ ] 验证表结构
- [ ] 验证索引创建
- [ ] 验证触发器创建
- [ ] 测试数据插入
- [ ] 测试数据查询
- [ ] 记录迁移日志

**依赖：** 任务 1.3（迁移脚本）  
**阻塞：** Epic 2 开始

---

#### 任务 2.2：测试数据关联

**时间：** 1 天  
**优先级：** 高  
**负责人：** 开发团队

**任务清单：**
- [ ] 测试 products 表与 companies 表的关联（通过 API）
- [ ] 测试 product_customer_interactions 表与 products 表的关联
- [ ] 测试 product_customer_interactions 表与 companies 表的关联
- [ ] 测试复合查询（产品-客户-互动）
- [ ] 测试索引性能
- [ ] 测试软删除功能
- [ ] 创建测试数据脚本

**依赖：** 任务 2.1（表部署）  
**阻塞：** Epic 2 开始

---

#### 任务 2.3：开始 Epic 2 Story 2.1（产品创建和管理）

**时间：** 持续  
**优先级：** 高  
**负责人：** 开发团队

**任务清单：**
- [ ] 创建产品管理模块（backend）
- [ ] 创建产品管理组件（frontend）
- [ ] 实现产品 CRUD 操作
- [ ] 实现产品搜索功能
- [ ] 实现产品状态管理
- [ ] 编写单元测试
- [ ] 编写集成测试

**依赖：** 任务 2.1, 2.2（表已就绪）  
**阻塞：** 无

---

### 阶段 3：生产部署准备（2-3 周后：2026-01-06 至 2026-01-19）

#### 任务 3.1：选择应用服务器

**时间：** 1 天  
**优先级：** 中  
**负责人：** 架构师 + PM

**任务清单：**
- [ ] 明确用户分布（中国 vs 美国）
- [ ] 选择前端部署方案（Vercel / 阿里云 CDN）
- [ ] 选择后端部署方案（Railway / 阿里云 ECS）
- [ ] 评估成本
- [ ] 创建部署配置

**依赖：** 用户分布数据  
**阻塞：** 生产部署

---

#### 任务 3.2：配置文件存储

**时间：** 1-2 天  
**优先级：** 中  
**负责人：** 开发团队

**任务清单：**
- [ ] 创建云存储账户（根据用户分布）
- [ ] 配置存储桶
- [ ] 实现文件上传服务
- [ ] 实现签名URL生成
- [ ] 实现文件访问控制
- [ ] 测试文件上传
- [ ] 测试文件访问

**依赖：** 任务 3.1（应用服务器选择）  
**阻塞：** Epic 4（互动记录附件上传）

---

#### 任务 3.3：生产环境部署

**时间：** 2-3 天  
**优先级：** 高（MVP 发布前）  
**负责人：** 开发团队 + DevOps

**任务清单：**
- [ ] 配置生产环境变量
- [ ] 部署 Twenty CRM
- [ ] 部署 fenghua-backend
- [ ] 部署 fenghua-frontend
- [ ] 运行数据库迁移
- [ ] 配置监控和日志
- [ ] 配置备份策略
- [ ] 性能测试
- [ ] 安全测试

**依赖：** 任务 3.1, 3.2  
**阻塞：** MVP 发布

---

## 关键里程碑

| 里程碑 | 日期 | 状态 | 说明 |
|--------|------|------|------|
| 表设计完成 | 2025-12-27 | ✅ 完成 | 数据库表结构设计文档已创建 |
| 迁移脚本完成 | 2025-12-28 | ⏳ 进行中 | 创建数据库迁移脚本 |
| 表部署完成 | 2025-12-31 | ⏳ 待开始 | 部署定制表到开发环境 |
| Epic 2 开始 | 2026-01-02 | ⏳ 待开始 | 开始产品管理开发 |
| 生产部署 | 2026-01-19 | ⏳ 待开始 | MVP 发布前完成 |

---

## 风险与缓解

### 风险 1：表设计需要调整

**风险描述：** 在实施过程中发现表设计需要调整

**缓解措施：**
- 提前评审表设计
- 与开发团队讨论
- 预留调整时间（1 天缓冲）

**影响：** 低（设计阶段可以调整）

---

### 风险 2：迁移脚本执行失败

**风险描述：** 数据库迁移脚本执行失败

**缓解措施：**
- 在开发环境充分测试
- 准备回滚脚本
- 备份数据库

**影响：** 中（可能延迟 Epic 2 开始）

---

### 风险 3：用户分布不明确

**风险描述：** 无法确定主要用户区域，影响部署方案选择

**缓解措施：**
- 先使用单一区域部署（美国或中国）
- 根据用户反馈调整
- 预留多区域部署方案

**影响：** 低（可以后续调整）

---

## 资源需求

### 人员

- **架构师：** 1 人（表设计、方案选择）
- **开发团队：** 2-3 人（迁移脚本、测试、开发）
- **DevOps：** 1 人（生产部署，可选）

### 时间

- **阶段 1：** 3-4 天
- **阶段 2：** 2-3 天
- **阶段 3：** 4-5 天

**总计：** 9-12 天

---

## 下一步行动

### 立即行动（今天）

1. ✅ 创建数据库表结构设计文档（已完成）
2. ⏳ 开始创建数据库迁移脚本
3. ⏳ 完成 Story 1.3 review 反馈

### 本周完成

1. 完成数据库迁移脚本
2. 完成 Story 1.3 review
3. 评审表设计

### 下周完成

1. 部署定制表到开发环境
2. 测试数据关联
3. 开始 Epic 2 Story 2.1

---

## 参考文档

- [数据库表结构设计](database-schema-design.md)
- [基础设施决策文档](infrastructure-decisions.md)
- [架构文档](../_bmad-output/architecture.md)

---

## 更新记录

| 日期 | 更新内容 | 更新人 |
|------|----------|--------|
| 2025-12-26 | 创建时间表文档 | 开发团队 |

---

**文档状态：** 进行中  
**下次审查：** 每周更新

