# Epic 19：回滚策略与「效果不好」验收标准

**Story：** 19.6  
**用途：** 任一批次（19.2–19.5、19.7）若被判定「效果不好」，可按本文档执行回滚与验证；各批 PR 须链接到本文档的回滚步骤与验证清单。

---

## 一、回滚单位

| 批次 | Story | 回滚单位 | 说明 |
|------|-------|----------|------|
| 批次一 | 19.2 | 单独 PR | 仪表盘与分析页 |
| 批次二 | 19.3 | 单独 PR | 主业务列表/表单/详情（客户、产品、互动、类别、附件、`Input`、`Table` 等） |
| 批次三 | 19.4 | 单独 PR | 登录、首页、导航与布局（`LoginPage`、`App` 首页、`MainLayout`、`TopNavigation`、`HomeModuleIcons`） |
| 批次四 | 19.5 | 单独 PR | 管理类与设置类（用户、审计、日志、设置、导入、导出、备份、恢复、监控、GDPR） |
| Follow-up | 19.7 | 单独 PR | 回退键、三列表编辑/删除统一、互动页按钮卡片合并 |

**支撑型（无单独页面回滚）：**

- **19.1**：设计 Token、`MASTER`、`tailwind`/`theme`；回滚 19.2–19.5/19.7 时**不**回滚 19.1，否则会影响所有批次。
- **19.6**：本文档；无页面改动，无需回滚。

---

## 二、回滚步骤

对**该批 PR 的 merge commit** 执行：

### 2.1 执行 revert

```bash
# 替换 <merge-commit> 为该批 PR 合并后的 commit hash
git revert <merge-commit> --no-edit
git push
```

若该 PR 含多个 squash 后的 commit，对**该 PR 对应的合并 commit** 执行一次 `git revert` 即可。

### 2.2 重新部署

- 按现有流程（如 push 后 CI/CD 自动部署，或手动部署到 Railway/其他）重新部署前端。
- 确认部署完成、服务可用。

### 2.3 验证（按「三、验证清单」）

- 打开该批**受影响页面**，按 **三、验证清单** 中对应批次做一次冒烟；确认功能与视觉与该批合并**前**一致。
- 其余批次（未 revert 的）保持当前优化后状态，不受影响。

---

## 三、验证清单（revert 后冒烟用）

按批检查以下项；全部通过即可视为回滚成功。

### 19.2 仪表盘与分析

- [ ] ` /` 或首页进入「业务仪表盘」，图表、指标卡、分析表正常展示
- [ ] 产品关联分析、客户分析、供应商分析、采购商分析、业务趋势分析 页可访问、图表与表格正常
- [ ] 主导航、侧栏 正常，无错位或样式错乱

### 19.3 主业务列表/表单/详情

- [ ] 客户管理：列表、搜索、详情、编辑/创建 可正常使用
- [ ] 产品管理：列表、详情、创建/编辑、类别 可正常使用
- [ ] 互动记录：列表、详情、创建/编辑、评论 可正常使用
- [ ] 通用：`Input`、`Table`、按钮、表单校验 表现正常，无控制台报错

### 19.4 登录、首页、导航与布局

- [ ] 登录页可访问，登录流程正常
- [ ] 首页（`/`）快捷入口、欢迎区 正常
- [ ] 侧栏导航：折叠/展开、高亮、跳转 正常
- [ ] 顶栏（若存在）：Logo、用户、登出 正常

### 19.5 管理类与设置类

- [ ] 用户管理：列表、创建/编辑 正常
- [ ] 审计日志、系统日志、错误日志：筛选、列表、分页 正常
- [ ] 系统设置：Tabs、系统功能入口、设置表单、数据保留 可访问与保存
- [ ] 导入（客户/产品/互动）、导出、备份状态、数据恢复、系统监控、GDPR 导出/删除 入口可访问，主流程可用

### 19.7 列表操作统一、回退与互动页布局

- [ ] 用户/产品/客户 列表：编辑、删除 按钮存在且可操作（或按权限隐藏）
- [ ] 具备「上一级」的详情/表单页：有返回列表入口，点击可回到列表
- [ ] 互动记录页：标题与「批量导入」「记录新互动」在同一卡片；筛选区在单独卡片

---

## 四、「效果不好」的判定

### 4.1 裁定人

- **产品负责人** 或 **Epic 发起人** 有权裁定某批次为「效果不好」并决定是否回滚。

### 4.2 可选的触发条件（满足其一或综合判断即可考量）

- 内部或客户**反馈明确变差**（如观感、易用性、性能）
- **关键任务完成率或错误率** 较优化前变差（若有埋点或支持数据）
- **观感或可访问性** 不如优化前（对比如优化前截图/录屏）
- 负责人**综合判断不达预期**（与业务目标、品牌、体验目标不符）

### 4.3 与回滚的关系

- 判定为「效果不好」后，**可**按本文档**二、回滚步骤**与**三、验证清单**执行回滚；是否回滚由裁定人决定。
- revert 后，该批所涉页面在功能与视觉上恢复为该批合并**前**状态；**其余已合并批次不受影响**。

---

## 五、验收与存档

### 5.1 存档路径

- **推荐：** `_bmad-output/epic-19-screenshots/` 或 `docs/design-system/screenshots/`
- 可按批分子目录，如：`_bmad-output/epic-19-screenshots/19-2/`、`19-3/` …

### 5.2 命名约定

- **截图：** `<页面或模块名>-before-<YYYY-MM-DD>.png`、`<页面或模块名>-after-<YYYY-MM-DD>.png`
- **录屏：** `<页面或模块名>-before|after-<YYYY-MM-DD>.mp4`（约 10–20 秒）

### 5.3 内容与时机

- **每批**：关键页面各 1～2 张/段；**优化前**在該批合并前存，「**优化后**」在该批合并后存。
- **用途：** 供「效果不好」判定时对比；回滚前后对比，确认回滚成功。

---

## 六、各批 PR 须注明的回滚信息

在各实施批次的 **PR 描述** 中建议注明：

1. **本批 Story**：19.2 / 19.3 / 19.4 / 19.5 / 19.7
2. **回滚说明**：对本次 PR 的 **merge commit** 执行 `git revert <merge-commit>`，推分支并重新部署；按 [epic-19-rollback-and-acceptance.md](./epic-19-rollback-and-acceptance.md) 中**三、验证清单**对应批次做冒烟。
3. **本文档链接**：[docs/design-system/epic-19-rollback-and-acceptance.md](./epic-19-rollback-and-acceptance.md)

---

## 七、与现有流程的衔接

- **page-optimization-guide** 第八、九节已引用本文档；各批在「步骤 7：提交与回滚信息」中须链接到本文档。
- 若某批被判定「效果不好」并决定回滚：按**二、回滚步骤**执行后，该批页面恢复为合并前状态，**其余已合并批次不受影响**。
