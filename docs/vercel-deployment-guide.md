# Vercel éƒ¨ç½²æŒ‡å—

**æ—¥æœŸï¼š** 2026-01-14  
**é¡¹ç›®ï¼š** fenghua-crm  
**ç›®æ ‡ï¼š** å°†é¡¹ç›®éƒ¨ç½²åˆ° Vercel å¹³å°

---

## ğŸ“‹ ç›®å½•

1. [éƒ¨ç½²æ¶æ„](#éƒ¨ç½²æ¶æ„)
2. [å‰ç½®è¦æ±‚](#å‰ç½®è¦æ±‚)
3. [æ•°æ®åº“å’ŒRedisé…ç½®](#æ•°æ®åº“å’Œredisé…ç½®)
4. [ç¯å¢ƒå˜é‡é…ç½®](#ç¯å¢ƒå˜é‡é…ç½®)
5. [å‰ç«¯éƒ¨ç½²æ­¥éª¤](#å‰ç«¯éƒ¨ç½²æ­¥éª¤)
6. [åç«¯éƒ¨ç½²æ­¥éª¤](#åç«¯éƒ¨ç½²æ­¥éª¤)
7. [éªŒè¯éƒ¨ç½²](#éªŒè¯éƒ¨ç½²)
8. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ğŸ—ï¸ éƒ¨ç½²æ¶æ„

### æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Vercel CDN    â”‚  â† å‰ç«¯é™æ€èµ„æº
â”‚  (fenghua-crm)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ API è¯·æ±‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Vercel Functionsâ”‚  â† åç«¯ Serverless Functions
â”‚ (fenghua-backend)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â–º PostgreSQL (å¤–éƒ¨æ•°æ®åº“)
         â””â”€â”€â–º Redis (å¤–éƒ¨RedisæœåŠ¡)
```

### éƒ¨ç½²ç»„ä»¶

1. **å‰ç«¯ (fenghua-frontend)**
   - é™æ€èµ„æºéƒ¨ç½²åˆ° Vercel CDN
   - ä½¿ç”¨ Vite æ„å»º

2. **åç«¯ (fenghua-backend)**
   - éƒ¨ç½²ä¸º Vercel Serverless Functions
   - éœ€è¦é…ç½® `vercel.json` æ–‡ä»¶

3. **å¤–éƒ¨æœåŠ¡**
   - PostgreSQL æ•°æ®åº“ï¼ˆæ¨èï¼šSupabaseã€Neonã€Railwayï¼‰
   - Redis æœåŠ¡ï¼ˆæ¨èï¼šUpstashã€Redis Cloudï¼‰

---

## âœ… å‰ç½®è¦æ±‚

### 1. è´¦æˆ·å’Œå·¥å…·

- âœ… Vercel è´¦æˆ·ï¼ˆå…è´¹ç‰ˆå³å¯ï¼‰
- âœ… GitHub è´¦æˆ·ï¼ˆç”¨äºä»£ç ä»“åº“ï¼‰
- âœ… PostgreSQL æ•°æ®åº“æœåŠ¡
- âœ… Redis æœåŠ¡

### 2. ä»£ç å‡†å¤‡

- âœ… ä»£ç å·²æ¨é€åˆ° GitHub ä»“åº“
- âœ… æ‰€æœ‰ä¾èµ–å·²æ·»åŠ åˆ° `package.json`
- âœ… ä»£ç å·²é€šè¿‡æœ¬åœ°æµ‹è¯•

---

## ğŸ—„ï¸ æ•°æ®åº“å’ŒRedisé…ç½®

### PostgreSQL æ•°æ®åº“

**æ¨èæœåŠ¡å•†ï¼š**

1. **Supabase** (æ¨è)
   - å…è´¹ç‰ˆï¼š500MB æ•°æ®åº“
   - ç½‘å€ï¼šhttps://supabase.com
   - è·å–è¿æ¥å­—ç¬¦ä¸²ï¼š`Settings` â†’ `Database` â†’ `Connection string`

2. **Neon**
   - å…è´¹ç‰ˆï¼š3GB æ•°æ®åº“
   - ç½‘å€ï¼šhttps://neon.tech
   - è·å–è¿æ¥å­—ç¬¦ä¸²ï¼šé¡¹ç›®è®¾ç½®ä¸­

3. **Railway**
   - å…è´¹ç‰ˆï¼š$5 å…è´¹é¢åº¦
   - ç½‘å€ï¼šhttps://railway.app
   - è·å–è¿æ¥å­—ç¬¦ä¸²ï¼šæ•°æ®åº“æœåŠ¡è®¾ç½®ä¸­

**è¿æ¥å­—ç¬¦ä¸²æ ¼å¼ï¼š**
```
postgresql://username:password@host:port/database?sslmode=require
```

### Redis æœåŠ¡

**æ¨èæœåŠ¡å•†ï¼š**

1. **Upstash** (æ¨èï¼Œä¸“ä¸º Serverless è®¾è®¡)
   - å…è´¹ç‰ˆï¼š10,000 å‘½ä»¤/å¤©
   - ç½‘å€ï¼šhttps://upstash.com
   - è·å–è¿æ¥å­—ç¬¦ä¸²ï¼šåˆ›å»ºæ•°æ®åº“åè·å–

2. **Redis Cloud**
   - å…è´¹ç‰ˆï¼š30MB å†…å­˜
   - ç½‘å€ï¼šhttps://redis.com/cloud
   - è·å–è¿æ¥å­—ç¬¦ä¸²ï¼šæ•°æ®åº“é…ç½®ä¸­

**è¿æ¥å­—ç¬¦ä¸²æ ¼å¼ï¼š**
```
redis://default:password@host:port
```

---

## ğŸ” ç¯å¢ƒå˜é‡é…ç½®

### åç«¯ç¯å¢ƒå˜é‡

åœ¨ Vercel é¡¹ç›®è®¾ç½®ä¸­é…ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

#### å¿…éœ€å˜é‡

| å˜é‡å | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|--------|
| `DATABASE_URL` | PostgreSQL è¿æ¥å­—ç¬¦ä¸² | `postgresql://user:pass@host:5432/db?sslmode=require` |
| `REDIS_URL` | Redis è¿æ¥å­—ç¬¦ä¸² | `redis://default:pass@host:6379` |
| `JWT_SECRET` | JWT å¯†é’¥ï¼ˆç”¨äºè®¤è¯ï¼‰ | `your-super-secret-jwt-key-min-32-chars` |
| `DEPLOYMENT_PLATFORM` | éƒ¨ç½²å¹³å°æ ‡è¯† | `vercel` |
| `VERCEL` | Vercel ç¯å¢ƒæ ‡è¯† | `1` |

#### å¯é€‰å˜é‡

| å˜é‡å | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|--------|
| `PORT` | æœåŠ¡ç«¯å£ | `3001` |
| `JWT_EXPIRES_IN` | JWT è¿‡æœŸæ—¶é—´ | `7d` |
| `NODE_ENV` | ç¯å¢ƒæ ‡è¯† | `production` |
| `PG_DATABASE_URL` | PostgreSQL å¤‡ç”¨è¿æ¥å­—ç¬¦ä¸² | åŒ `DATABASE_URL` |

### å‰ç«¯ç¯å¢ƒå˜é‡

åœ¨ Vercel é¡¹ç›®è®¾ç½®ä¸­é…ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

#### å¿…éœ€å˜é‡

| å˜é‡å | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|--------|
| `VITE_BACKEND_URL` | åç«¯ API åœ°å€ | `https://your-backend.vercel.app` |

#### å¯é€‰å˜é‡

| å˜é‡å | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|--------|
| `VITE_API_BASE_URL` | API åŸºç¡€åœ°å€ï¼ˆå¤‡ç”¨ï¼‰ | åŒ `VITE_BACKEND_URL` |

---

## ğŸš€ å‰ç«¯éƒ¨ç½²æ­¥éª¤

### æ­¥éª¤ 1: å‡†å¤‡ Vercel é…ç½®

åœ¨ `fenghua-frontend` ç›®å½•ä¸‹åˆ›å»º `vercel.json`ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰ï¼š

```json
{
  "buildCommand": "npm run build",
  "outputDirectory": "dist",
  "framework": "vite",
  "rewrites": [
    {
      "source": "/(.*)",
      "destination": "/index.html"
    }
  ]
}
```

### æ­¥éª¤ 2: åœ¨ Vercel ä¸­åˆ›å»ºé¡¹ç›®

1. ç™»å½• [Vercel Dashboard](https://vercel.com/dashboard)
2. ç‚¹å‡» **"Add New Project"**
3. é€‰æ‹© GitHub ä»“åº“ï¼š`fenghua-crm`
4. é…ç½®é¡¹ç›®ï¼š
   - **Framework Preset**: `Vite`
   - **Root Directory**: `fenghua-frontend`
   - **Build Command**: `npm run build`
   - **Output Directory**: `dist`
   - **Install Command**: `npm install`

### æ­¥éª¤ 3: é…ç½®ç¯å¢ƒå˜é‡

åœ¨é¡¹ç›®è®¾ç½®ä¸­æ·»åŠ å‰ç«¯ç¯å¢ƒå˜é‡ï¼š
- `VITE_BACKEND_URL`

### æ­¥éª¤ 4: éƒ¨ç½²

1. ç‚¹å‡» **"Deploy"**
2. ç­‰å¾…æ„å»ºå®Œæˆ
3. è·å–éƒ¨ç½² URLï¼ˆä¾‹å¦‚ï¼š`https://fenghua-crm.vercel.app`ï¼‰

---

## ğŸ”§ åç«¯éƒ¨ç½²æ­¥éª¤

### æ­¥éª¤ 1: ä½¿ç”¨é¡¹ç›®è‡ªå¸¦é…ç½®ï¼ˆé›¶é…ç½® NestJSï¼‰

- ä»“åº“å†… **`fenghua-backend/vercel.json`** å·²é…ç½®ï¼ˆä»… `functions` çš„ `maxDuration`ï¼Œæ—  `builds`/`routes`ï¼‰ã€‚
- è¯·**ä¸è¦**åœ¨é¡¹ç›®æ ¹ç›®å½•æ·»åŠ å« `builds` æˆ– `routes` çš„ `vercel.json`ï¼Œå¦åˆ™æ˜“è§¦å‘ `Cannot read properties of undefined (reading 'fsPath')` ç­‰æ„å»ºé”™è¯¯ã€‚
- åç«¯éœ€é€šè¿‡ **Root Directory = fenghua-backend** éƒ¨ç½²ï¼Œç”± Vercel å¯¹ NestJS åšé›¶é…ç½®æ£€æµ‹ã€‚

### æ­¥éª¤ 2: éªŒè¯åç«¯å…¥å£æ–‡ä»¶

`fenghua-backend/src/main.ts` å·²æ”¯æŒ Vercel Serverlessï¼š
- è‡ªåŠ¨æ£€æµ‹ `DEPLOYMENT_PLATFORM=vercel` æˆ– `VERCEL=1`
- å¯¼å‡º `handler` ä¾› Vercel è°ƒç”¨ï¼Œæ— éœ€æ”¹ä»£ç 

### æ­¥éª¤ 3: åœ¨ Vercel ä¸­åˆ›å»ºåç«¯é¡¹ç›®

1. ç™»å½• [Vercel Dashboard](https://vercel.com/dashboard)
2. ç‚¹å‡» **"Add New Project"**
3. é€‰æ‹© GitHub ä»“åº“ï¼š`fenghua-crm`
4. é…ç½®é¡¹ç›®ï¼š
   - **Framework Preset**: `Other`
   - **Root Directory**: `fenghua-backend`ï¼ˆå¿…å¡«ï¼Œå¦åˆ™æ˜“å‡ºç° `fsPath` ç­‰é”™è¯¯ï¼‰
   - **Build Command**: ç•™ç©ºï¼ˆç”± Vercel é›¶é…ç½®æ£€æµ‹ï¼‰ï¼›è‹¥å¤±è´¥å¯è¯• `npm run build`
   - **Output Directory**: ç•™ç©º
   - **Install Command**: `npm install`

### æ­¥éª¤ 4: é…ç½®ç¯å¢ƒå˜é‡

åœ¨é¡¹ç›®è®¾ç½®ä¸­æ·»åŠ æ‰€æœ‰åç«¯ç¯å¢ƒå˜é‡ï¼ˆè§ä¸Šæ–¹ç¯å¢ƒå˜é‡é…ç½®è¡¨ï¼‰

### æ­¥éª¤ 5: é…ç½®å‡½æ•°è®¾ç½®

åœ¨é¡¹ç›®è®¾ç½® â†’ **Functions** ä¸­ï¼š
- **Max Duration**: `60s`ï¼ˆæˆ–æ ¹æ®éœ€æ±‚è°ƒæ•´ï¼›`fenghua-backend/vercel.json` å·²é¢„è®¾ 60ï¼‰
- **Memory**: `1024 MB`ï¼ˆæ¨èï¼‰

### æ­¥éª¤ 6: éƒ¨ç½²

1. ç‚¹å‡» **"Deploy"**
2. ç­‰å¾…æ„å»ºå®Œæˆ
3. è·å–éƒ¨ç½² URLï¼ˆä¾‹å¦‚ï¼š`https://fenghua-backend.vercel.app`ï¼‰

---

## âœ… éªŒè¯éƒ¨ç½²

### 1. éªŒè¯å‰ç«¯

1. è®¿é—®å‰ç«¯ URLï¼š`https://fenghua-crm.vercel.app`
2. æ£€æŸ¥é¡µé¢æ˜¯å¦æ­£å¸¸åŠ è½½
3. å°è¯•ç™»å½•åŠŸèƒ½

### 2. éªŒè¯åç«¯

1. è®¿é—®åç«¯å¥åº·æ£€æŸ¥ç«¯ç‚¹ï¼š
   ```
   GET https://fenghua-backend.vercel.app/health
   ```
2. æ£€æŸ¥ API å“åº”

### 3. éªŒè¯æ•°æ®åº“è¿æ¥

1. ç™»å½•ç³»ç»Ÿ
2. å°è¯•åˆ›å»º/æŸ¥çœ‹æ•°æ®
3. æ£€æŸ¥ Vercel å‡½æ•°æ—¥å¿—ï¼ˆåœ¨ Dashboard â†’ Functions â†’ Logsï¼‰

### 4. éªŒè¯ Redis è¿æ¥

1. æ‰§è¡Œéœ€è¦ç¼“å­˜çš„æ“ä½œï¼ˆå¦‚ä»ªè¡¨ç›˜æŸ¥è¯¢ï¼‰
2. æ£€æŸ¥æ—¥å¿—ç¡®è®¤ Redis è¿æ¥æ­£å¸¸

---

## ğŸ” å¸¸è§é—®é¢˜

### Q1: æ„å»ºæŠ¥é”™ - "Cannot read properties of undefined (reading 'fsPath')"

**è§£å†³æ–¹æ¡ˆï¼š**
- ç¡®è®¤**åç«¯**é¡¹ç›® **Root Directory** ä¸º **fenghua-backend**ï¼Œå‹¿ç”¨ä»“åº“æ ¹
- å‹¿åœ¨æ ¹ç›®å½•æ·»åŠ å« `builds` æˆ– `routes` çš„ `vercel.json`ï¼›ä»…ä½¿ç”¨ `fenghua-backend/vercel.json`
- å¯å°è¯• **Settings â†’ General** ä¸­ **Force no build cache** åé‡æ–°éƒ¨ç½²

### Q2: æ„å»ºå¤±è´¥ - "Cannot find module"

**è§£å†³æ–¹æ¡ˆï¼š**
- æ£€æŸ¥ `package.json` ä¸­æ‰€æœ‰ä¾èµ–æ˜¯å¦å·²æ·»åŠ 
- ç¡®ä¿ `node_modules` å·²æ­£ç¡®å®‰è£…
- æ£€æŸ¥ Vercel æ„å»ºæ—¥å¿—

### Q3: æ•°æ®åº“è¿æ¥å¤±è´¥

**è§£å†³æ–¹æ¡ˆï¼š**
- æ£€æŸ¥ `DATABASE_URL` æ˜¯å¦æ­£ç¡®
- ç¡®è®¤æ•°æ®åº“æœåŠ¡å…è®¸å¤–éƒ¨è¿æ¥
- æ£€æŸ¥ SSL æ¨¡å¼è®¾ç½®ï¼ˆVercel éœ€è¦ `?sslmode=require`ï¼‰

### Q4: Redis è¿æ¥å¤±è´¥

**è§£å†³æ–¹æ¡ˆï¼š**
- æ£€æŸ¥ `REDIS_URL` æ˜¯å¦æ­£ç¡®
- ç¡®è®¤ Redis æœåŠ¡å…è®¸å¤–éƒ¨è¿æ¥
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

### Q5: CORS é”™è¯¯

**è§£å†³æ–¹æ¡ˆï¼š**
- åœ¨ Vercel é¡¹ç›®è®¾ç½®ä¸­æ·»åŠ å‰ç«¯åŸŸååˆ° CORS å…è®¸åˆ—è¡¨
- æ£€æŸ¥åç«¯ CORS é…ç½®

### Q6: å‡½æ•°è¶…æ—¶

**è§£å†³æ–¹æ¡ˆï¼š**
- å¢åŠ å‡½æ•°è¶…æ—¶æ—¶é—´ï¼ˆVercel Pro è®¡åˆ’æ”¯æŒæ›´é•¿è¶…æ—¶ï¼‰
- ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢
- ä½¿ç”¨ Redis ç¼“å­˜å‡å°‘æ•°æ®åº“æŸ¥è¯¢

### Q7: ç¯å¢ƒå˜é‡æœªç”Ÿæ•ˆ

**è§£å†³æ–¹æ¡ˆï¼š**
- ç¡®è®¤ç¯å¢ƒå˜é‡å·²æ·»åŠ åˆ° Vercel é¡¹ç›®è®¾ç½®
- é‡æ–°éƒ¨ç½²é¡¹ç›®ï¼ˆç¯å¢ƒå˜é‡æ›´æ”¹éœ€è¦é‡æ–°éƒ¨ç½²ï¼‰
- æ£€æŸ¥å˜é‡åæ˜¯å¦æ­£ç¡®ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰

### Q8: å‰ç«¯æ— æ³•è¿æ¥åˆ°åç«¯

**è§£å†³æ–¹æ¡ˆï¼š**
- æ£€æŸ¥ `VITE_BACKEND_URL` æ˜¯å¦æ­£ç¡®
- ç¡®è®¤åç«¯ URL å¯è®¿é—®
- æ£€æŸ¥ç½‘ç»œè¯·æ±‚ï¼ˆæµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼‰

---

## ğŸ“ éƒ¨ç½²æ£€æŸ¥æ¸…å•

### éƒ¨ç½²å‰

- [ ] ä»£ç å·²æ¨é€åˆ° GitHub
- [ ] æ‰€æœ‰ä¾èµ–å·²æ·»åŠ åˆ° `package.json`
- [ ] æœ¬åœ°æµ‹è¯•é€šè¿‡
- [ ] æ•°æ®åº“æœåŠ¡å·²åˆ›å»ºå¹¶é…ç½®
- [ ] Redis æœåŠ¡å·²åˆ›å»ºå¹¶é…ç½®

### éƒ¨ç½²æ—¶

- [ ] å‰ç«¯é¡¹ç›®å·²åˆ›å»ºåœ¨ Vercel
- [ ] åç«¯é¡¹ç›®å·²åˆ›å»ºåœ¨ Vercel
- [ ] æ‰€æœ‰ç¯å¢ƒå˜é‡å·²é…ç½®
- [ ] æ„å»ºæˆåŠŸ
- [ ] éƒ¨ç½²æˆåŠŸ

### éƒ¨ç½²å

- [ ] å‰ç«¯é¡µé¢æ­£å¸¸åŠ è½½
- [ ] åç«¯ API æ­£å¸¸å“åº”
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] Redis è¿æ¥æ­£å¸¸
- [ ] ç™»å½•åŠŸèƒ½æ­£å¸¸
- [ ] æ•°æ®æ“ä½œæ­£å¸¸

---

## ğŸ”— ç›¸å…³èµ„æº

- [Vercel æ–‡æ¡£](https://vercel.com/docs)
- [NestJS Serverless éƒ¨ç½²](https://docs.nestjs.com/faq/serverless)
- [Vite éƒ¨ç½²æŒ‡å—](https://vitejs.dev/guide/static-deploy.html)
- [Supabase æ–‡æ¡£](https://supabase.com/docs)
- [Upstash Redis æ–‡æ¡£](https://docs.upstash.com/redis)

---

## ğŸ“ æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š
1. æŸ¥çœ‹ Vercel æ„å»ºæ—¥å¿—
2. æ£€æŸ¥å‡½æ•°æ—¥å¿—
3. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
4. è”ç³»æŠ€æœ¯æ”¯æŒ

---

**éƒ¨ç½²æ–‡æ¡£ç‰ˆæœ¬ï¼š** 1.0  
**æœ€åæ›´æ–°ï¼š** 2026-01-14
