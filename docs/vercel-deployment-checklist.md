# Vercel 部署检查清单

**日期：** 2026-01-14  
**项目：** fenghua-crm

---

## 📋 部署前检查清单

### 1. 代码准备

- [ ] 代码已推送到 GitHub 仓库
- [ ] 所有依赖已添加到 `package.json`
- [ ] 代码已通过本地测试
- [ ] 没有硬编码的敏感信息（API密钥、密码等）
- [ ] `.gitignore` 已正确配置（排除 `.env` 文件）

### 2. 外部服务配置

#### PostgreSQL 数据库

- [ ] 已创建 PostgreSQL 数据库服务（Supabase/Neon/Railway）
- [ ] 已获取数据库连接字符串
- [ ] 已运行数据库迁移脚本（如果需要）
- [ ] 已测试数据库连接

#### Redis 服务

- [ ] 已创建 Redis 服务（Upstash/Redis Cloud）
- [ ] 已获取 Redis 连接字符串
- [ ] 已测试 Redis 连接


### 3. 环境变量准备

#### 后端环境变量

- [ ] `DATABASE_URL` - PostgreSQL 连接字符串
- [ ] `REDIS_URL` - Redis 连接字符串
- [ ] `JWT_SECRET` - JWT 密钥（至少32字符，已生成）
- [ ] `DEPLOYMENT_PLATFORM` - 设置为 `vercel`
- [ ] `VERCEL` - 设置为 `1`

#### 前端环境变量

- [ ] `VITE_BACKEND_URL` - 后端 API 地址（部署后获取）

---

## 🚀 部署步骤检查清单

### 步骤 1: 部署后端

- [ ] 在 Vercel 中创建后端项目
- [ ] 设置 Root Directory 为 `fenghua-backend`
- [ ] 配置所有后端环境变量
- [ ] 设置函数超时时间（60秒）
- [ ] 点击部署
- [ ] 等待构建完成
- [ ] 检查构建日志，确认无错误
- [ ] 获取后端部署 URL

### 步骤 2: 部署前端

- [ ] 在 Vercel 中创建前端项目
- [ ] 设置 Root Directory 为 `fenghua-frontend`
- [ ] 配置所有前端环境变量（包括后端 URL）
- [ ] 点击部署
- [ ] 等待构建完成
- [ ] 检查构建日志，确认无错误
- [ ] 获取前端部署 URL

### 步骤 3: 更新环境变量

- [ ] 更新前端项目中的 `VITE_BACKEND_URL`（使用后端部署 URL）
- [ ] 重新部署前端项目

---

## ✅ 部署后验证检查清单

### 1. 前端验证

- [ ] 访问前端 URL，页面正常加载
- [ ] 检查浏览器控制台，无错误
- [ ] 尝试登录功能
- [ ] 检查 API 请求是否正常

### 2. 后端验证

- [ ] 访问后端健康检查端点（如果存在）
- [ ] 检查 Vercel 函数日志，无错误
- [ ] 测试 API 端点（使用 Postman 或 curl）

### 3. 数据库验证

- [ ] 登录系统
- [ ] 尝试创建/查看数据
- [ ] 检查数据是否正确保存到数据库
- [ ] 检查 Vercel 函数日志，确认数据库连接正常

### 4. Redis 验证

- [ ] 执行需要缓存的操作（如仪表盘查询）
- [ ] 检查 Vercel 函数日志，确认 Redis 连接正常


---

## 🔍 故障排查检查清单

### 如果构建失败

- [ ] 检查构建日志，查找错误信息
- [ ] 确认所有依赖已添加到 `package.json`
- [ ] 检查 Node.js 版本是否兼容
- [ ] 确认代码没有语法错误

### 如果运行时错误

- [ ] 检查 Vercel 函数日志
- [ ] 确认所有环境变量已正确配置
- [ ] 检查环境变量值是否正确（无多余空格、引号等）
- [ ] 确认数据库和 Redis 服务可访问

### 如果数据库连接失败

- [ ] 检查 `DATABASE_URL` 格式是否正确
- [ ] 确认数据库服务允许外部连接
- [ ] 检查 SSL 模式设置（`?sslmode=require`）
- [ ] 确认数据库服务未暂停或限制

### 如果 Redis 连接失败

- [ ] 检查 `REDIS_URL` 格式是否正确
- [ ] 确认 Redis 服务允许外部连接
- [ ] 检查防火墙设置
- [ ] 确认 Redis 服务未暂停或限制

### 如果 CORS 错误

- [ ] 检查前端 URL 是否在后端 CORS 允许列表中
- [ ] 检查 `FRONTEND_URL` 环境变量是否正确
- [ ] 确认前端使用 HTTPS（生产环境）

---

## 📝 部署后维护检查清单

### 定期检查

- [ ] 检查 Vercel 函数日志，查找错误
- [ ] 监控数据库使用量
- [ ] 监控 Redis 使用量
- [ ] 检查 Vercel 使用量（函数调用次数、带宽等）

### 安全检查

- [ ] 定期轮换 JWT_SECRET
- [ ] 定期更换数据库密码
- [ ] 检查 Vercel 项目访问权限
- [ ] 确认环境变量未泄露

### 性能优化

- [ ] 监控函数执行时间
- [ ] 优化数据库查询
- [ ] 使用 Redis 缓存减少数据库查询
- [ ] 考虑升级 Vercel 计划（如果需要更长超时时间）

---

## 🔗 相关文档

- [完整部署指南](./vercel-deployment-guide.md)
- [环境变量配置](./vercel-environment-variables.md)
- [项目 README](../README.md)

---

**检查清单版本：** 1.0  
**最后更新：** 2026-01-14
